(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))e(h);new MutationObserver(h=>{for(const o of h)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&e(l)}).observe(document,{childList:!0,subtree:!0});function s(h){const o={};return h.integrity&&(o.integrity=h.integrity),h.referrerPolicy&&(o.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?o.credentials="include":h.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function e(h){if(h.ep)return;h.ep=!0;const o=s(h);fetch(h.href,o)}})();class G{constructor(){this.down=new Set,this.pressedThisFrame=new Set,window.addEventListener("keydown",t=>{this.down.has(t.code)||this.pressedThisFrame.add(t.code),this.down.add(t.code),["Space","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","KeyW","KeyA","KeyS","KeyD"].includes(t.code)&&t.preventDefault()},{passive:!1}),window.addEventListener("keyup",t=>this.down.delete(t.code))}beginFrame(){this.pressedThisFrame.clear()}endFrame(){}isDown(t){return this.down.has(t)}wasPressed(t){return this.pressedThisFrame.has(t)}getMovementDirection(){return{x:(this.isDown("ArrowRight")?1:0)+(this.isDown("ArrowLeft")?-1:0),y:(this.isDown("ArrowDown")?1:0)+(this.isDown("ArrowUp")?-1:0)}}getWASDHorizontal(){return(this.isDown("KeyD")?1:0)+(this.isDown("KeyA")?-1:0)}}class Y{constructor(t){this.lastTime=0,this.running=!1,this.scene=null,this.loop=e=>{var o,l;if(!this.running||!this.scene)return;const h=Math.min(1/30,(e-this.lastTime)/1e3);this.lastTime=e,this.input.beginFrame(),this.scene.update(h,this),this.scene.render(this.ctx,this),(l=(o=this.input).endFrame)==null||l.call(o),requestAnimationFrame(this.loop)},this.canvas=t;const s=t.getContext("2d");if(!s)throw new Error("2D context not available");this.ctx=s,this.input=new G,this.resizeToDisplay()}resizeToDisplay(){var o,l;const t=Math.max(1,Math.min(window.devicePixelRatio||1,2)),s=this.canvas.getBoundingClientRect(),e=Math.floor(s.width*t)||800,h=Math.floor(s.height*t)||600;(this.canvas.width!==e||this.canvas.height!==h)&&(this.canvas.width=e,this.canvas.height=h),this.ctx.setTransform(1,0,0,1,0,0),(l=(o=this.scene)==null?void 0:o.onResize)==null||l.call(o,this)}setScene(t){this.scene=t,t.init(this),this.running||(this.running=!0,this.lastTime=performance.now(),requestAnimationFrame(this.loop))}}class A{constructor(t=50,s=50,e=28,h=28,o){this.vx=0,this.vy=0,this._score=0,this.hp=3,this.maxHp=3,this.fireCooldown=0,this.x=t,this.y=s,this.width=e,this.height=h}setPosition(t,s){this.x=t,this.y=s}passObstacle(){this._score+=1}update(t){this.x+=this.vx*t,this.y+=this.vy*t,this.fireCooldown>0&&(this.fireCooldown=Math.max(0,this.fireCooldown-t))}get score(){return Math.max(0,this._score)}set score(t){this._score=Math.max(0,t)}}class M{constructor(t,s,e,h,o=120){this.x=t,this.y=s,this.width=e,this.height=h,this.speed=o}update(t){this.x-=this.speed*t}isOffScreen(){return this.x+this.width<0}}class N{render(t,s,e,h,o){t.fillStyle="#e8e8f0",t.font="700 20px system-ui, sans-serif",typeof e=="number"?t.fillText(`P1: ${s}   P2: ${e}`,16,24):t.fillText(`Score: ${s}`,16,24);const l=(a,c,n)=>{if(n!=null)for(let i=0;i<n;i++){t.fillStyle="#ff7b72",t.beginPath();const r=i*18;t.moveTo(a+r+6,c+10),t.arc(a+r+3,c+8,3,0,Math.PI),t.arc(a+r+9,c+8,3,0,Math.PI),t.lineTo(a+r+6,c+14),t.closePath(),t.fill()}};l(16,36,h),o!=null&&l(120,36,o)}}const g=class g{static applyGravity(t,s){t.vy+=g.gravity*s}static jump(t){t.vy=g.jumpVelocity}static checkCollision(t,s){return!(t.x+t.width<s.x||t.x>s.x+s.width||t.y+t.height<s.y||t.y>s.y+s.height)}};g.gravity=900,g.jumpVelocity=-300;let m=g;class F{constructor(t,s){this.canvas=t,this.ctx=s,this.t=0,this.cloudOffset=0}clear(t=0){const{ctx:s}=this,e=this.canvas.width,h=this.canvas.height;this.t+=t,this.cloudOffset=(this.cloudOffset+t*20)%(e+200);const o=s.createLinearGradient(0,0,0,h);o.addColorStop(0,"#0f1630"),o.addColorStop(1,"#0b1022"),s.fillStyle=o,s.fillRect(0,0,e,h);const l=(a,c,n)=>{s.fillStyle="#ffffff14",s.beginPath(),s.roundRect(a,c,120*n,40*n,20*n),s.fill()};for(let a=0;a<4;a++){const c=e-(this.cloudOffset+a*180)%(e+200),n=40+a*45%(h*.5);l(c,n,1)}s.fillStyle="#1a2446",s.fillRect(0,h-20,e,20),s.fillStyle="#111a36";for(let a=0;a<e;a+=16)s.fillRect(a,h-22,8,2)}drawBird(t,s){const{ctx:e}=this,h=Math.min(t.width,t.height)/2,o=t.x+h,l=t.y+h,a=Math.sin(this.t*10)*.6;e.fillStyle=s,e.beginPath(),e.arc(o,l,h,0,Math.PI*2),e.fill(),e.fillStyle="#ffffff88",e.beginPath(),e.arc(o-h*.2,l+h*.1,h*.7,Math.PI*.1,Math.PI*1.2),e.fill(),e.save(),e.translate(o-h*.2,l),e.rotate(-.8+a),e.fillStyle="#00000022",e.beginPath(),e.ellipse(0,0,h*.9,h*.5,0,0,Math.PI*2),e.fill(),e.restore(),e.fillStyle="#ffd166",e.beginPath(),e.moveTo(o+h*.9,l),e.lineTo(o+h*1.4,l-h*.2),e.lineTo(o+h*.9,l+h*.2),e.closePath(),e.fill(),e.fillStyle="#fff",e.beginPath(),e.arc(o+h*.2,l-h*.3,h*.22,0,Math.PI*2),e.fill(),e.fillStyle="#000",e.beginPath(),e.arc(o+h*.25,l-h*.3,h*.1,0,Math.PI*2),e.fill()}drawPlayer(t,s="#58a6ff"){this.drawBird(t,s)}drawObstacle(t){const{ctx:s}=this,e=s.createLinearGradient(t.x,t.y,t.x+t.width,t.y);e.addColorStop(0,"#2bc072"),e.addColorStop(1,"#3be688"),s.fillStyle=e,s.fillRect(t.x,t.y,t.width,t.height),s.fillStyle="#ffffff18",s.fillRect(t.x+6,t.y,6,t.height)}drawHUD(t){this.ctx.fillStyle="#e8e8f0",this.ctx.font="700 24px system-ui, sans-serif",this.ctx.fillText(t,16,32)}drawProjectile(t,s="#ffd166"){const{ctx:e}=this;e.fillStyle=s,e.fillRect(t.x,t.y,t.width,t.height)}drawEnemy(t){const{ctx:s}=this;s.fillStyle="#ff7b72",s.beginPath(),s.ellipse(t.x+t.width/2,t.y+t.height/2,t.width/2,t.height/2,0,0,Math.PI*2),s.fill(),s.fillStyle="#00000055",s.fillRect(t.x+2,t.y+2,t.width-4,3)}drawPowerUp(t){const{ctx:s}=this,e={heal:"#7ee787",rapid:"#f7b84a",shield:"#8b8efb"};s.fillStyle=e[t.type]||"#f7b84a",s.beginPath(),s.roundRect(t.x,t.y,t.width,t.height,4),s.fill()}}class V{constructor(){this.ctx=null,this._muted=!1}get muted(){return this._muted}set muted(t){this._muted=t;try{localStorage.setItem("mute",t?"1":"0")}catch{}}ensure(){this.ctx||(this.ctx=new(window.AudioContext||window.webkitAudioContext))}beep(t,s=.08,e="sine",h=.05){if(this._muted)return;this.ensure();const o=this.ctx,l=o.createOscillator(),a=o.createGain();l.type=e,l.frequency.value=t,a.gain.value=h,l.connect(a).connect(o.destination);const c=o.currentTime;l.start(c),l.stop(c+s)}flap(){this.beep(660,.05,"square",.05)}score(){this.beep(880,.08,"triangle",.06)}hit(){this.beep(120,.15,"sawtooth",.08)}}const y=new V;try{y.muted=localStorage.getItem("mute")==="1"}catch{}class z{constructor(){this.pool=[],this.active=[]}spawn(t,s,e){const h=this.pool.pop()||{x:t,y:s,vx:0,vy:0,life:.5,maxLife:.5,size:3,color:"#fff"};h.x=t,h.y=s,h.vx=(e==null?void 0:e.vx)??Math.random()*80-40,h.vy=(e==null?void 0:e.vy)??Math.random()*-80,h.life=(e==null?void 0:e.life)??.5,h.maxLife=h.life,h.size=(e==null?void 0:e.size)??3,h.color=(e==null?void 0:e.color)??"#ffffff88",h.g=(e==null?void 0:e.g)??200,this.active.push(h)}burst(t,s,e,h){for(let o=0;o<e;o++)this.spawn(t,s,{color:h,size:2+Math.random()*2,life:.4+Math.random()*.3})}update(t){for(let s=this.active.length-1;s>=0;s--){const e=this.active[s];e.vy+=(e.g||0)*t,e.x+=e.vx*t,e.y+=e.vy*t,e.life-=t,e.life<=0&&(this.pool.push(e),this.active.splice(s,1))}}render(t){for(const s of this.active){const e=Math.max(0,s.life/s.maxLife);t.fillStyle=s.color.replace(/\d?\.?\d*\)$/,"")||s.color,t.globalAlpha=e,t.beginPath(),t.arc(s.x,s.y,s.size,0,Math.PI*2),t.fill(),t.globalAlpha=1}}}function X(p){return p===2?"shoot":"flap"}class T{constructor(t,s,e,h,o="player"){this.width=10,this.height=4,this.active=!0,this.x=t,this.y=s,this.vx=e,this.vy=h,this.owner=o}update(t){this.x+=this.vx*t,this.y+=this.vy*t}isOffScreen(t,s){return this.x>t+20||this.x+this.width<-20||this.y>s+20||this.y+this.height<-20}}class q{constructor(t,s,e=-120,h=0){this.width=24,this.height=18,this.health=1,this.x=t,this.y=s,this.vx=e,this.vy=h}update(t){this.x+=this.vx*t,this.y+=this.vy*t}isOffScreen(){return this.x+this.width<-40}}class ${constructor(t,s,e){this.width=16,this.height=16,this.vx=-80,this.vy=0,this.x=t,this.y=s,this.type=e}update(t){this.x+=this.vx*t,this.y+=this.vy*t}isOffScreen(){return this.x+this.width<-40}}const B="scores:v1";function K(){try{const p=localStorage.getItem(B);if(!p)return[];const t=JSON.parse(p);return Array.isArray(t)?t.map(s=>({score:Number(s.score)||0,date:Number(s.date)||Date.now()})).filter(s=>s.score>=0&&Number.isFinite(s.date)):[]}catch{return[]}}function U(p){try{localStorage.setItem(B,JSON.stringify(p))}catch{}}const P={addScore(p,t=Date.now()){const s=K();s.push({score:Math.max(0,Math.floor(p)),date:t}),s.sort((h,o)=>o.score-h.score||o.date-h.date);const e=s.slice(0,10);U(e)},getTop(p=5){const t=K();return t.sort((s,e)=>e.score-s.score||e.date-s.date),t.slice(0,p)},clear(){U([])}};class O{constructor(){this.player=new A(80,150,26,26),this.obstacles=[],this.hud=new N,this.timeToNext=0,this.score=0,this.best=0,this.gameOver=!1,this.paused=!1,this.speed=140,this.particles=new z,this.shakeT=0,this.hintT=4,this.bullets=[],this.enemies=[],this.powerUps=[],this.enemyTimer=0,this.powerTimer=5,this.mobileMoveX=0,this.isTouch="ontouchstart"in window,this.btnLeftDown=!1,this.btnRightDown=!1,this.btnShootDown=!1,this.btnRects=null}init(t){this.renderer=new F(t.canvas,t.ctx),this.obstacles=[],this.score=0,this.timeToNext=0,this.gameOver=!1,this.paused=!1,this.speed=140,this.player.hp=this.player.maxHp=3,this.bullets=[],this.enemies=[],this.powerUps=[],this.enemyTimer=0,this.powerTimer=5,this.hintT=4;const s=()=>{const a=t.canvas.width,c=t.canvas.height,n=Math.max(60,Math.min(120,Math.floor(Math.min(a,c)*.14))),i=24;this.btnRects={left:{x:i,y:c-n-i,w:n,h:n},right:{x:i+n+16,y:c-n-i,w:n,h:n},shoot:{x:a-n-i,y:c-n-i,w:n,h:n}}},e=(a,c,n)=>{if(!this.btnRects)return!1;const i=this.btnRects[a];return c>=i.x&&c<=i.x+i.w&&n>=i.y&&n<=i.y+i.h},h=a=>{s(),this.btnLeftDown=this.btnRightDown=this.btnShootDown=!1;const c=t.canvas.getBoundingClientRect(),n=t.canvas.width/c.width,i=t.canvas.height/c.height;for(let r=0;r<a.touches.length;r++){const d=a.touches.item(r),f=(d.clientX-c.left)*n,u=(d.clientY-c.top)*i;e("left",f,u)?this.btnLeftDown=!0:e("right",f,u)?this.btnRightDown=!0:e("shoot",f,u)&&(this.btnShootDown=!0)}},o=a=>{var i;if(this.gameOver)return;if(a.touches!==void 0){const r=a;if(h(r),this.btnLeftDown||this.btnRightDown||this.btnShootDown){if(this.btnShootDown&&this.player.fireCooldown===0){const f=this.player.x+this.player.width,u=this.player.y+this.player.height*.5-2;this.bullets.push(new T(f,u,360,0,"player")),this.player.fireCooldown=.18,y.beep(980,.05,"square",.05)}return}if((((i=r.touches)==null?void 0:i.length)??0)>=2&&this.player.fireCooldown===0){const f=this.player.x+this.player.width,u=this.player.y+this.player.height*.5-2;this.bullets.push(new T(f,u,360,0,"player")),this.player.fireCooldown=.18,y.beep(980,.05,"square",.05)}else m.jump(this.player),y.flap(),this.particles.burst(this.player.x+this.player.width*.2,this.player.y+this.player.height,8,"#88ccff88");return}const c=a.button??0,n=X(c);if(n==="flap")m.jump(this.player),y.flap();else if(n==="shoot"&&this.player.fireCooldown===0){const r=this.player.x+this.player.width,d=this.player.y+this.player.height*.5-2;this.bullets.push(new T(r,d,360,0,"player")),this.player.fireCooldown=.18,y.beep(980,.05,"square",.05)}};t.canvas.oncontextmenu=a=>{a.preventDefault()},t.canvas.onpointerdown=o;const l=a=>{const c=t.canvas.getBoundingClientRect();let n=0,i=0;for(let r=0;r<a.touches.length;r++){const f=a.touches.item(r).clientX-c.left;f<c.width*.45?n=1:f>c.width*.55&&(i=1)}this.mobileMoveX=i-n};t.canvas.ontouchstart=a=>{l(a),o(a)},t.canvas.ontouchmove=a=>{l(a),h(a)},t.canvas.ontouchend=a=>{l(a),h(a)};try{const a=localStorage.getItem("best");a&&(this.best=parseInt(a,10)||0)}catch{}document.addEventListener("visibilitychange",()=>{document.hidden&&(this.paused=!0)})}update(t,s){var c,n;const e=s.canvas.height;if(s.input.wasPressed("KeyP")&&(this.paused=!this.paused),s.input.wasPressed("KeyR")&&this.init(s),this.paused)return;if((s.input.wasPressed("Space")||s.input.wasPressed("ArrowUp")||s.input.wasPressed("KeyW"))&&(m.jump(this.player),y.flap(),this.particles.burst(this.player.x+this.player.width*.2,this.player.y+this.player.height,8,"#88ccff88")),(s.input.isDown("KeyJ")||s.input.isDown("ControlLeft")||s.input.isDown("ControlRight")||this.btnShootDown)&&this.player.fireCooldown===0){const i=this.player.x+this.player.width,r=this.player.y+this.player.height*.5-2;this.bullets.push(new T(i,r,360,0,"player")),this.player.fireCooldown=.18,y.beep(980,.05,"square",.05)}const h=s.input.getMovementDirection(),o=((n=(c=s.input).getWASDHorizontal)==null?void 0:n.call(c))??(s.input.isDown("KeyD")?1:0)+(s.input.isDown("KeyA")?-1:0),l=(this.btnRightDown?1:0)-(this.btnLeftDown?1:0);if(this.player.vx=(h.x+o+this.mobileMoveX+l)*80,m.applyGravity(this.player,t),this.player.update(t),this.player.y=Math.max(0,Math.min(e-this.player.height,this.player.y)),this.timeToNext-=t,this.timeToNext<=0){this.speed=Math.min(260,this.speed+2);const i=Math.max(120,180-this.score*2);this.timeToNext=Math.max(1,1.6-this.score*.02);const r=i,d=40,f=e-r-40,u=Math.floor(Math.random()*(f-d+1))+d,w=80,b=s.canvas.width+w;this.obstacles.push(new M(b,0,w,u,this.speed)),this.obstacles.push(new M(b,u+r,w,e-(u+r),this.speed))}for(const i of this.obstacles)i.update(t);this.obstacles=this.obstacles.filter(i=>!i.isOffScreen());for(const i of this.obstacles)if(m.checkCollision(this.player,i)&&(this.player.hp-=1,y.hit(),this.particles.burst(this.player.x+this.player.width/2,this.player.y+this.player.height/2,12,"#ff7b72aa"),this.shakeT=.2,this.player.x-=10,this.player.hp<=0)){this.gameOver=!0,this.best=Math.max(this.best,this.score);try{localStorage.setItem("best",String(this.best))}catch{}P.addScore(this.score)}for(let i=0;i<this.obstacles.length;i+=2){const r=this.obstacles[i],d=r.x+r.width/2;!this.gameOver&&d<this.player.x&&r.counted!==!0&&(r.counted=!0,this.score+=1,this.player.passObstacle(),y.score())}if(this.enemyTimer-=t,this.enemyTimer<=0){let i=40,r=e-40;if(this.obstacles.length>=2){let C=0,E=-1/0;for(let S=0;S<this.obstacles.length-1;S+=2){const I=this.obstacles[S];I.x>E&&(E=I.x,C=S)}const W=this.obstacles[C],j=this.obstacles[C+1];i=W.height,r=j.y}const d=12,f=Math.max(0,i+d),u=Math.min(e-20,r-d-18),w=s.canvas.width+40,b=f<u?f+(u-f)*.5:40+Math.random()*(e-120),x=-(120+Math.random()*60+this.score),v=new q(w,b,x,0);v.minY=isFinite(f)?f:20,v.maxY=isFinite(u)?u:e-40,v.phase=Math.random()*Math.PI*2,this.enemies.push(v),this.enemyTimer=1.8-Math.min(1.2,this.score*.01)}if(this.powerTimer-=t,this.powerTimer<=0){const i=["heal","rapid","shield"],r=i[Math.random()*i.length|0];this.powerUps.push(new $(s.canvas.width+20,80+Math.random()*(e-160),r)),this.powerTimer=8+Math.random()*6}for(const i of this.bullets)i.update(t);for(const i of this.enemies){const r=(i.phase??0)+performance.now()/1e3,d=35;i.vy=Math.sin(r)*d,i.update(t);const f=i.minY??20,u=i.maxY??e-40;i.y<f&&(i.y=f),i.y+i.height>u&&(i.y=u-i.height)}for(const i of this.powerUps)i.update(t);this.bullets=this.bullets.filter(i=>!i.isOffScreen(s.canvas.width,e)&&i.active),this.enemies=this.enemies.filter(i=>!i.isOffScreen()),this.powerUps=this.powerUps.filter(i=>!i.isOffScreen());const a=(i,r,d,f,u,w,b,x)=>i<u+b&&i+d>u&&r<w+x&&r+f>w;for(const i of this.bullets)for(const r of this.enemies)i.active&&a(i.x,i.y,i.width,i.height,r.x,r.y,r.width,r.height)&&(i.active=!0,r.health-=1,this.particles.burst(r.x+r.width/2,r.y+r.height/2,8,"#ffd166aa"),r.health<=0&&(r.x=-9999,this.score+=1,y.score()));this.enemies=this.enemies.filter(i=>i.x>-9e3);for(const i of this.enemies)if(a(this.player.x,this.player.y,this.player.width,this.player.height,i.x,i.y,i.width,i.height)&&(this.player.hp-=1,y.hit(),this.particles.burst(i.x+i.width/2,i.y+i.height/2,10,"#ff7b72aa"),i.x=-9999,this.player.hp<=0)){this.gameOver=!0,this.best=Math.max(this.best,this.score);try{localStorage.setItem("best",String(this.best))}catch{}P.addScore(this.score)}for(const i of this.powerUps)a(this.player.x,this.player.y,this.player.width,this.player.height,i.x,i.y,i.width,i.height)&&(i.type==="heal"&&(this.player.hp=Math.min(this.player.maxHp,this.player.hp+1)),i.type==="rapid"&&(this.player.fireCooldown=Math.min(this.player.fireCooldown,.08)),i.type==="shield"&&(this.player.maxHp=Math.min(5,this.player.maxHp+1)),this.player.hp=Math.min(this.player.maxHp,this.player.hp+1),this.particles.burst(i.x+i.width/2,i.y+i.height/2,14,"#7ee787aa"),i.x=-9999);this.particles.update(t),this.shakeT=Math.max(0,this.shakeT-t),this.hintT=Math.max(0,this.hintT-t)}render(t,s){const e=this.shakeT>0?(Math.random()-.5)*8:0;t.save(),t.translate(e,e),this.renderer.clear(1/60);for(const h of this.obstacles)this.renderer.drawObstacle(h);for(const h of this.enemies)this.renderer.drawEnemy(h);for(const h of this.powerUps)this.renderer.drawPowerUp(h);this.renderer.drawPlayer(this.player,"#58a6ff");for(const h of this.bullets)this.renderer.drawProjectile(h);if(this.particles.render(t),this.hud.render(t,this.score,void 0,this.player.hp),this.isTouch){const h=s.canvas.width,o=s.canvas.height,l=Math.max(60,Math.min(120,Math.floor(Math.min(h,o)*.14))),a=24;this.btnRects={left:{x:a,y:o-l-a,w:l,h:l},right:{x:a+l+16,y:o-l-a,w:l,h:l},shoot:{x:h-l-a,y:o-l-a,w:l,h:l}};const c=(n,i,r)=>{t.save(),t.globalAlpha=.5,t.fillStyle=i?"#58a6ff":"#0f172a",t.strokeStyle="#58a6ff88",t.lineWidth=4,t.beginPath(),t.roundRect(n.x,n.y,n.w,n.h,16),t.fill(),t.stroke(),t.fillStyle="#e8e8f0",t.font="700 28px system-ui";const d=r==="L"?"◀":r==="R"?"▶":"●",f=t.measureText(d).width;t.fillText(d,n.x+(n.w-f)/2,n.y+n.h/2+10),t.restore()};c(this.btnRects.left,this.btnLeftDown,"L"),c(this.btnRects.right,this.btnRightDown,"R"),c(this.btnRects.shoot,this.btnShootDown,"S")}if(this.hintT>0){const h=Math.min(.8,this.hintT/4);t.save(),t.globalAlpha=h,t.fillStyle="#00000088",t.fillRect(20,70,520,56),t.fillStyle="#e8e8f0",t.font="600 16px system-ui",t.fillText("Flap: Space/ArrowUp/W or Click • Move: Arrows or A/D • Shoot: Right Click or Ctrl/J (hold)",28,100),t.restore()}t.restore(),this.paused&&(t.fillStyle="#00000088",t.fillRect(0,0,s.canvas.width,s.canvas.height),t.fillStyle="#e8e8f0",t.font="700 28px system-ui",t.fillText("Paused (P). R = Restart, Esc = Title",40,120)),this.gameOver&&(t.fillStyle="#00000088",t.fillRect(0,0,s.canvas.width,s.canvas.height),t.fillStyle="#e8e8f0",t.font="700 28px system-ui",t.fillText(`Game Over — Score ${this.score}  Best ${this.best}`,40,120),t.font="500 18px system-ui",t.fillText("Press R to restart or Esc for Title",40,160))}}class L{constructor(){this.p1=new A(80,140,26,26),this.p2=new A(120,220,26,26),this.obstacles=[],this.hud=new N,this.timeToNext=0,this.s1=0,this.s2=0,this.paused=!1,this.speed=140,this.particles=new z,this.shakeT=0}init(t){this.renderer=new F(t.canvas,t.ctx),this.obstacles=[],this.timeToNext=0,this.s1=0,this.s2=0,this.paused=!1,this.speed=140;const s=()=>{m.jump(this.p1),y.flap()};t.canvas.ontouchstart=s,t.canvas.onpointerdown=s}update(t,s){const e=s.canvas.height;if(s.input.wasPressed("KeyP")&&(this.paused=!this.paused),s.input.wasPressed("KeyR")&&this.init(s),this.paused)return;(s.input.wasPressed("Space")||s.input.wasPressed("ArrowUp"))&&(m.jump(this.p1),y.flap(),this.particles.burst(this.p1.x,this.p1.y+this.p1.height,6,"#88ccff88")),s.input.wasPressed("KeyW")&&(m.jump(this.p2),y.flap(),this.particles.burst(this.p2.x,this.p2.y+this.p2.height,6,"#ffb08888"));const h=s.input.getMovementDirection();if(this.p1.vx=h.x*80,this.p2.vx=0,this.p2.vy+=(s.input.isDown("KeyS")?1:0)*300*t,m.applyGravity(this.p1,t),m.applyGravity(this.p2,t),this.p1.update(t),this.p2.update(t),this.p1.y=Math.max(0,Math.min(e-this.p1.height,this.p1.y)),this.p2.y=Math.max(0,Math.min(e-this.p2.height,this.p2.y)),this.timeToNext-=t,this.timeToNext<=0){this.speed=Math.min(260,this.speed+2);const o=Math.max(130,180-Math.max(this.s1,this.s2)*2);this.timeToNext=Math.max(1,1.7-Math.max(this.s1,this.s2)*.02);const l=40,a=e-o-40,c=Math.floor(Math.random()*(a-l+1))+l,n=80,i=s.canvas.width+n;this.obstacles.push(new M(i,0,n,c,this.speed)),this.obstacles.push(new M(i,c+o,n,e-(c+o),this.speed))}for(const o of this.obstacles)o.update(t);this.obstacles=this.obstacles.filter(o=>!o.isOffScreen());for(const o of this.obstacles)if(m.checkCollision(this.p1,o)||m.checkCollision(this.p2,o)){y.hit(),this.particles.burst((this.p1.x+this.p2.x)/2,(this.p1.y+this.p2.y)/2,16,"#ff7b72aa"),this.shakeT=.25,this.init(s);return}for(let o=0;o<this.obstacles.length;o+=2){const l=this.obstacles[o],a=l.x+l.width/2;a<this.p1.x&&l.p1c!==!0&&(l.p1c=!0,this.s1+=1,this.p1.passObstacle(),y.score()),a<this.p2.x&&l.p2c!==!0&&(l.p2c=!0,this.s2+=1,this.p2.passObstacle(),y.score())}}render(t,s){const e=this.shakeT>0?(Math.random()-.5)*8:0;t.save(),t.translate(e,e),this.renderer.clear(1/60);for(const h of this.obstacles)this.renderer.drawObstacle(h);this.renderer.drawPlayer(this.p1,"#58a6ff"),this.renderer.drawPlayer(this.p2,"#ff7b72"),this.particles.render(t),this.hud.render(t,this.s1,this.s2),t.restore(),this.paused&&(t.fillStyle="#00000088",t.fillRect(0,0,s.canvas.width,s.canvas.height),t.fillStyle="#e8e8f0",t.font="700 28px system-ui",t.fillText("Paused (P). R = Restart, Esc = Title",40,120))}}class J{constructor(){this.t=0}onResize(t){t.ctx.setTransform(1,0,0,1,0,0)}init(t){t.canvas.focus();let s=!1;const e=()=>{t.canvas.onpointerdown=null,t.canvas.ontouchstart=null,t.canvas.onclick=null,document.removeEventListener("touchstart",n),document.removeEventListener("pointerdown",c),document.removeEventListener("click",i)},h=r=>{s||(s=!0,e(),t.setScene(r?new L:new O))},o=r=>h(!1),l=r=>{var f;const d=((f=r.touches)==null?void 0:f.length)??0;h(d>=2)},a=r=>h(!1),c=r=>h(!1),n=r=>{var f;const d=((f=r.touches)==null?void 0:f.length)??0;h(d>=2)},i=r=>h(!1);t.canvas.onpointerdown=o,t.canvas.ontouchstart=l,t.canvas.onclick=a,document.addEventListener("pointerdown",c,{passive:!0}),document.addEventListener("touchstart",n,{passive:!0}),document.addEventListener("click",i,{passive:!0})}update(t,s){this.t+=t,s.input.wasPressed("KeyS")&&s.setScene(new O),s.input.wasPressed("KeyV")&&s.setScene(new L),s.input.wasPressed("KeyM")&&(y.muted=!y.muted),s.input.wasPressed("KeyC")&&P.clear();const{ctx:e}=s,h=s.canvas.width,o=s.canvas.height,l=e.createLinearGradient(0,0,0,o);l.addColorStop(0,"#0b1023"),l.addColorStop(1,"#1a2247"),e.fillStyle=l,e.fillRect(0,0,h,o),e.save(),e.globalAlpha=.2;for(let f=0;f<60;f++){const u=f*91%h,w=f*53%o;e.fillStyle=f%2?"#d0e0ff":"#a0b8ff",e.fillRect(u,w+(Math.sin(this.t+f)*2+2)|0,2,2)}e.restore();const a=Math.sin(this.t*2)*6;e.fillStyle="#e8e8f0",e.font="800 64px system-ui, ui-sans-serif, -apple-system, Segoe UI",e.textBaseline="top",e.fillText("Crappy Bird Extreme",40,80+a),e.strokeStyle="#58a6ff",e.lineWidth=6,e.beginPath(),e.moveTo(40,80+a+64+8),e.lineTo(520,80+a+64+8),e.stroke(),e.font="700 20px system-ui",e.fillStyle="#94a3b8",e.fillText("yoloswag edition",44,80+a+64+18+10),e.fillStyle="#0f172a88";const c=180;e.fillRect(32,c,Math.min(520,h-64),150),e.fillStyle="#cdd9e5",e.font="700 22px system-ui",e.fillText("Play",48,c+16),e.font="500 18px system-ui",e.fillText("S — Singleplayer",48,c+52),e.fillText("V — Versus (Local)",48,c+80);const n=c+170;e.fillStyle="#0f172a88",e.fillRect(32,n,Math.min(620,h-64),160),e.fillStyle="#cdd9e5",e.font="700 20px system-ui",e.fillText("Controls",48,n+16),e.font="500 16px system-ui";let i=n+46;e.fillText("Singleplayer: Flap = Space/ArrowUp/W or Click/Tap • Move = ArrowLeft/Right or A/D • Shoot = Right Click or Ctrl/J (hold)",48,i),i+=28,e.fillText("Versus: P1 = Arrows + Space • P2 = W (flap), S (nudge down)",48,i),i+=28,e.fillText(`Mute = M (${y.muted?"Muted":"Sound on"}) • Esc returns here`,48,i);const r=P.getTop(5);if(r.length){const u=28+r.length*22+16,w=Math.max(h-280-24,24),b=24;e.fillStyle="#0f172acc",e.fillRect(w,b,280,u),e.fillStyle="#cdd9e5",e.font="700 16px system-ui",e.fillText("Top Scores",w+12,b+20),e.font="500 14px system-ui";for(let x=0;x<r.length;x++){const v=r[x];e.fillText(`${x+1}. ${v.score}`,w+12,b+44+x*22)}e.font="400 12px system-ui",e.fillStyle="#94a3b8",e.fillText("Press C to clear",w+12,b+u-10)}const d=.5+.5*Math.sin(this.t*3);e.save(),e.globalAlpha=.6+.4*d,e.fillStyle="#58a6ff",e.font="700 18px system-ui",e.fillText("Tap to start Singleplayer • Two-finger tap for Versus (or press S/V)",40,o-60),e.restore()}render(){}}const k=document.getElementById("gameCanvas");k.style.width="100vw";k.style.height="100vh";const D=new Y(k);let R="title";const H=()=>{R="title",D.setScene(new J)},_=()=>{R="single",D.setScene(new O)},Q=()=>{R="versus",D.setScene(new L)};H();window.addEventListener("keydown",p=>{R==="title"?(p.code==="KeyS"&&_(),p.code==="KeyV"&&Q()):p.code==="Escape"&&H()});window.addEventListener("resize",()=>D.resizeToDisplay());
