(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const u of c.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function r(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerPolicy&&(c.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?c.credentials="include":o.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(o){if(o.ep)return;o.ep=!0;const c=r(o);fetch(o.href,c)}})();class Ne{constructor(){this.down=new Set,this.pressedThisFrame=new Set,window.addEventListener("keydown",t=>{this.down.has(t.code)||this.pressedThisFrame.add(t.code),this.down.add(t.code),["Space","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","KeyW","KeyA","KeyS","KeyD"].includes(t.code)&&t.preventDefault()},{passive:!1}),window.addEventListener("keyup",t=>this.down.delete(t.code))}beginFrame(){this.pressedThisFrame.clear()}endFrame(){}isDown(t){return this.down.has(t)}wasPressed(t){return this.pressedThisFrame.has(t)}getMovementDirection(){return{x:(this.isDown("ArrowRight")?1:0)+(this.isDown("ArrowLeft")?-1:0),y:(this.isDown("ArrowDown")?1:0)+(this.isDown("ArrowUp")?-1:0)}}getWASDHorizontal(){return(this.isDown("KeyD")?1:0)+(this.isDown("KeyA")?-1:0)}}class je{constructor(t){this.lastTime=0,this.running=!1,this.scene=null,this.loop=n=>{if(!this.running||!this.scene)return;const o=Math.min(1/30,(n-this.lastTime)/1e3);this.lastTime=n,this.input.beginFrame(),this.scene.update(o,this),this.scene.render(this.ctx,this),this.input.endFrame(),requestAnimationFrame(this.loop)},this.canvas=t;const r=t.getContext("2d");if(!r)throw new Error("2D context not available");this.ctx=r,this.input=new Ne,this.resizeToDisplay()}resizeToDisplay(){var c,u;const t=Math.max(1,Math.min(window.devicePixelRatio||1,2)),r=this.canvas.getBoundingClientRect(),n=Math.floor(r.width*t)||800,o=Math.floor(r.height*t)||600;(this.canvas.width!==n||this.canvas.height!==o)&&(this.canvas.width=n,this.canvas.height=o),this.ctx.setTransform(1,0,0,1,0,0),(u=(c=this.scene)==null?void 0:c.onResize)==null||u.call(c,this)}setScene(t){this.scene=t,t.init(this),this.running||(this.running=!0,this.lastTime=performance.now(),requestAnimationFrame(this.loop))}}class vt{constructor(t=50,r=50,n=28,o=28,c){this.vx=0,this.vy=0,this._score=0,this.hp=3,this.maxHp=3,this.fireCooldown=0,this.x=t,this.y=r,this.width=n,this.height=o}setPosition(t,r){this.x=t,this.y=r}passObstacle(){this._score+=1}update(t){this.x+=this.vx*t,this.y+=this.vy*t,this.fireCooldown>0&&(this.fireCooldown=Math.max(0,this.fireCooldown-t))}get score(){return Math.max(0,this._score)}set score(t){this._score=Math.max(0,t)}}class At{constructor(t,r,n,o,c=120){this.x=t,this.y=r,this.width=n,this.height=o,this.speed=c}update(t){this.x-=this.speed*t}isOffScreen(){return this.x+this.width<0}}class Vt{render(t,r,n,o,c){t.fillStyle="#e8e8f0",t.font="700 20px system-ui, sans-serif",typeof n=="number"?t.fillText(`P1: ${r}   P2: ${n}`,16,24):t.fillText(`Score: ${r}`,16,24);const u=(l,d,x)=>{if(x!=null)for(let m=0;m<x;m++){t.fillStyle="#ff7b72",t.beginPath();const b=m*18;t.moveTo(l+b+6,d+10),t.arc(l+b+3,d+8,3,0,Math.PI),t.arc(l+b+9,d+8,3,0,Math.PI),t.lineTo(l+b+6,d+14),t.closePath(),t.fill()}};u(16,36,o),c!=null&&u(120,36,c)}}const ft=class ft{static applyGravity(t,r){t.vy+=ft.gravity*r}static jump(t){t.vy=ft.jumpVelocity}static checkCollision(t,r){return!(t.x+t.width<r.x||t.x>r.x+r.width||t.y+t.height<r.y||t.y>r.y+r.height)}};ft.gravity=900,ft.jumpVelocity=-300;let G=ft;class Yt{constructor(t,r){this.canvas=t,this.ctx=r,this.t=0,this.cloudOffset=0}clear(t=0){const{ctx:r}=this,n=this.canvas.width,o=this.canvas.height;this.t+=t,this.cloudOffset=(this.cloudOffset+t*20)%(n+200);const c=r.createLinearGradient(0,0,0,o);c.addColorStop(0,"#0f1630"),c.addColorStop(1,"#0b1022"),r.fillStyle=c,r.fillRect(0,0,n,o);const u=(l,d,x)=>{r.fillStyle="#ffffff14",r.beginPath(),r.roundRect(l,d,120*x,40*x,20*x),r.fill()};for(let l=0;l<4;l++){const d=n-(this.cloudOffset+l*180)%(n+200),x=40+l*45%(o*.5);u(d,x,1)}r.fillStyle="#1a2446",r.fillRect(0,o-20,n,20),r.fillStyle="#111a36";for(let l=0;l<n;l+=16)r.fillRect(l,o-22,8,2)}drawBird(t,r){const{ctx:n}=this,o=Math.min(t.width,t.height)/2,c=t.x+o,u=t.y+o,l=Math.sin(this.t*10)*.6;n.fillStyle=r,n.beginPath(),n.arc(c,u,o,0,Math.PI*2),n.fill(),n.fillStyle="#ffffff88",n.beginPath(),n.arc(c-o*.2,u+o*.1,o*.7,Math.PI*.1,Math.PI*1.2),n.fill(),n.save(),n.translate(c-o*.2,u),n.rotate(-.8+l),n.fillStyle="#00000022",n.beginPath(),n.ellipse(0,0,o*.9,o*.5,0,0,Math.PI*2),n.fill(),n.restore(),n.fillStyle="#ffd166",n.beginPath(),n.moveTo(c+o*.9,u),n.lineTo(c+o*1.4,u-o*.2),n.lineTo(c+o*.9,u+o*.2),n.closePath(),n.fill(),n.fillStyle="#fff",n.beginPath(),n.arc(c+o*.2,u-o*.3,o*.22,0,Math.PI*2),n.fill(),n.fillStyle="#000",n.beginPath(),n.arc(c+o*.25,u-o*.3,o*.1,0,Math.PI*2),n.fill()}drawPlayer(t,r="#58a6ff"){this.drawBird(t,r)}drawObstacle(t){const{ctx:r}=this,n=r.createLinearGradient(t.x,t.y,t.x+t.width,t.y);n.addColorStop(0,"#2bc072"),n.addColorStop(1,"#3be688"),r.fillStyle=n,r.fillRect(t.x,t.y,t.width,t.height),r.fillStyle="#ffffff18",r.fillRect(t.x+6,t.y,6,t.height)}drawHUD(t){this.ctx.fillStyle="#e8e8f0",this.ctx.font="700 24px system-ui, sans-serif",this.ctx.fillText(t,16,32)}drawProjectile(t,r="#ffd166"){const{ctx:n}=this;n.fillStyle=t.color||r,n.fillRect(t.x,t.y,t.width,t.height)}drawEnemy(t){const{ctx:r}=this,n=t.variant||"drone";n==="tank"?(r.fillStyle="#c65353",r.beginPath(),r.roundRect(t.x,t.y,t.width,t.height,4),r.fill(),r.fillStyle="#00000055",r.fillRect(t.x+3,t.y+t.height-6,t.width-6,4)):n==="bee"?(r.fillStyle="#ffd166",r.beginPath(),r.ellipse(t.x+t.width/2,t.y+t.height/2,t.width/2,t.height/2,0,0,Math.PI*2),r.fill(),r.fillStyle="#00000066",r.fillRect(t.x+4,t.y+4,t.width-8,4),r.fillRect(t.x+4,t.y+10,t.width-8,4)):n==="kamikaze"?(r.fillStyle="#ff7b72",r.beginPath(),r.ellipse(t.x+t.width/2,t.y+t.height/2,t.width/2,t.height/2,0,0,Math.PI*2),r.fill(),r.fillStyle="#ffffffaa",r.beginPath(),r.arc(t.x+t.width/2+3,t.y+t.height/2-2,3,0,Math.PI*2),r.fill()):(r.fillStyle="#ff7b72",r.beginPath(),r.ellipse(t.x+t.width/2,t.y+t.height/2,t.width/2,t.height/2,0,0,Math.PI*2),r.fill(),r.fillStyle="#00000055",r.fillRect(t.x+2,t.y+2,t.width-4,3))}drawPowerUp(t){const{ctx:r}=this,n={heal:"#7ee787",rapid:"#f7b84a",shield:"#8b8efb",multishot:"#38bdf8",bigshot:"#fb7185",slowmo:"#a78bfa",magnet:"#f472b6"};r.fillStyle=n[t.type]||"#f7b84a",r.beginPath(),r.roundRect(t.x,t.y,t.width,t.height,4),r.fill(),r.fillStyle="#0f172a",r.font="700 10px system-ui";const o=t.x+t.width/2,c=t.y+t.height/2+3,l={heal:"+",rapid:"R",shield:"S",multishot:"M",bigshot:"B",slowmo:"⌛",magnet:"U"}[t.type]||"?",d=r.measureText(l).width;r.fillText(l,o-d/2,c)}}class Ge{constructor(){this.ctx=null,this._muted=!1}get muted(){return this._muted}set muted(t){this._muted=t;try{localStorage.setItem("mute",t?"1":"0")}catch{}}ensure(){this.ctx||(this.ctx=new(window.AudioContext||window.webkitAudioContext))}beep(t,r=.08,n="sine",o=.05){if(this._muted)return;this.ensure();const c=this.ctx,u=c.createOscillator(),l=c.createGain();u.type=n,u.frequency.value=t,l.gain.value=o,u.connect(l).connect(c.destination);const d=c.currentTime;u.start(d),u.stop(d+r)}flap(){this.beep(660,.05,"square",.05)}score(){this.beep(880,.08,"triangle",.06)}hit(){this.beep(120,.15,"sawtooth",.08)}combo(t){if(this._muted)return;const r=900+Math.min(4,t)*80;this.beep(r,.05,"triangle",.05)}}const U=new Ge;try{U.muted=localStorage.getItem("mute")==="1"}catch{}class me{constructor(){this.pool=[],this.active=[]}spawn(t,r,n){const o=this.pool.pop()||{x:t,y:r,vx:0,vy:0,life:.5,maxLife:.5,size:3,color:"#fff"};o.x=t,o.y=r,o.vx=(n==null?void 0:n.vx)??Math.random()*80-40,o.vy=(n==null?void 0:n.vy)??Math.random()*-80,o.life=(n==null?void 0:n.life)??.5,o.maxLife=o.life,o.size=(n==null?void 0:n.size)??3,o.color=(n==null?void 0:n.color)??"#ffffff88",o.g=(n==null?void 0:n.g)??200,this.active.push(o)}burst(t,r,n,o){for(let c=0;c<n;c++)this.spawn(t,r,{color:o,size:2+Math.random()*2,life:.4+Math.random()*.3})}update(t){for(let r=this.active.length-1;r>=0;r--){const n=this.active[r];n.vy+=(n.g||0)*t,n.x+=n.vx*t,n.y+=n.vy*t,n.life-=t,n.life<=0&&(this.pool.push(n),this.active.splice(r,1))}}render(t){for(const r of this.active){const n=Math.max(0,r.life/r.maxLife);t.fillStyle=r.color.replace(/\d?\.?\d*\)$/,"")||r.color,t.globalAlpha=n,t.beginPath(),t.arc(r.x,r.y,r.size,0,Math.PI*2),t.fill(),t.globalAlpha=1}}}function $e(h){return h===2?"shoot":"flap"}class We{constructor(t,r,n,o,c="player"){this.width=10,this.height=4,this.active=!0,this.damage=1,this.x=t,this.y=r,this.vx=n,this.vy=o,this.owner=c}update(t){this.x+=this.vx*t,this.y+=this.vy*t}isOffScreen(t,r){return this.x>t+20||this.x+this.width<-20||this.y>r+20||this.y+this.height<-20}}class qe{constructor(t,r,n=-120,o=0,c="drone"){this.x=t,this.y=r,this.vx=n,this.vy=o,this.variant=c,c==="tank"?(this.width=34,this.height=26,this.health=3):(this.width=24,this.height=18,this.health=1)}update(t){this.x+=this.vx*t,this.y+=this.vy*t}isOffScreen(){return this.x+this.width<-40}}class Ke{constructor(t,r,n){this.width=16,this.height=16,this.vx=-80,this.vy=0,this.x=t,this.y=r,this.type=n}update(t){this.x+=this.vx*t,this.y+=this.vy*t}isOffScreen(){return this.x+this.width<-40}}const ge="scores:v1",Ut="playerName";function re(){try{const h=localStorage.getItem(ge);if(!h)return[];const t=JSON.parse(h);return Array.isArray(t)?t.map(r=>({score:Number(r.score)||0,date:Number(r.date)||Date.now(),name:typeof r.name=="string"?r.name:void 0})).filter(r=>r.score>=0&&Number.isFinite(r.date)):[]}catch{return[]}}function ne(h){try{localStorage.setItem(ge,JSON.stringify(h))}catch{}}const z={addScore(h,t=Date.now(),r){const n=re(),o=(r??localStorage.getItem(Ut)??"Anon").toString().slice(0,18).trim()||"Anon";n.push({score:Math.max(0,Math.floor(h)),date:t,name:o}),n.sort((u,l)=>l.score-u.score||l.date-u.date);const c=n.slice(0,10);ne(c)},getTop(h=5){const t=re();return t.sort((r,n)=>n.score-r.score||n.date-r.date),t.slice(0,h)},clear(){ne([])},getPlayerName(){try{return localStorage.getItem(Ut)}catch{return null}},setPlayerName(h){try{localStorage.setItem(Ut,(h||"").toString().slice(0,18).trim()||"Anon")}catch{}}},bt=class bt{constructor(){var t;this._reducedMotion=!1,this._usingSystemPreference=!0;try{const r=localStorage.getItem(bt.STORAGE_KEY);if(r!=null)this._reducedMotion=r==="1",this._usingSystemPreference=!1;else if(typeof window<"u"&&"matchMedia"in window){const n=window.matchMedia("(prefers-reduced-motion: reduce)");this._reducedMotion=n.matches,this._usingSystemPreference=!0;try{(t=n.addEventListener)==null||t.call(n,"change",o=>{this._usingSystemPreference&&(this._reducedMotion=o.matches)})}catch{}}}catch{}}get reducedMotion(){return this._reducedMotion}set reducedMotion(t){this._reducedMotion=t,this._usingSystemPreference=!1;try{localStorage.setItem(bt.STORAGE_KEY,t?"1":"0")}catch{}}toggleReducedMotion(){this.reducedMotion=!this.reducedMotion}};bt.STORAGE_KEY="reducedMotion";let Nt=bt;const H=new Nt;function Ve(h,t=Math.random){let r={heal:2.2,shield:1.6,rapid:1.2,multishot:1,bigshot:.9,slowmo:.9,magnet:1};if(h<5)r.multishot*=.3,r.bigshot*=.3,r.slowmo*=.4,r.magnet*=.5,r.heal*=1.3,r.shield*=1.2;else if(h<15){const u=(h-5)/10;r.multishot*=.3+.7*u,r.bigshot*=.3+.7*u,r.slowmo*=.4+.6*u,r.magnet*=.5+.5*u}else r.rapid*=1.1,r.multishot*=1.15,r.bigshot*=1.1;const n=Object.entries(r).filter(([u,l])=>l>0),o=n.reduce((u,[,l])=>u+l,0);let c=t()*o;for(const[u,l]of n)if(c-=l,c<=0)return u;return n[n.length-1][0]}const xt=class xt{constructor(){this.player=new vt(80,150,26,26),this.obstacles=[],this.hud=new Vt,this.timeToNext=0,this.score=0,this.best=0,this.gameOver=!1,this.paused=!1,this.speed=120,this.particles=new me,this.shakeT=0,this.hintT=4,this.bullets=[],this.enemies=[],this.powerUps=[],this.enemyTimer=0,this.powerTimer=5,this.lastGapCenter=null,this.floats=[],this.playerName=null,this.hurtT=0,this.combo=0,this.comboT=0,this.ended=!1,this.multishotT=0,this.bigshotT=0,this.slowmoT=0,this.magnetT=0,this.rapidT=0,this.pickupBadgeT=0,this.mobileMoveX=0,this.isTouch="ontouchstart"in window,this.btnLeftDown=!1,this.btnRightDown=!1,this.btnShootDown=!1,this.btnRects=null,this.restartRect=null}init(t){this.renderer=new Yt(t.canvas,t.ctx),this.obstacles=[],this.score=0,this.timeToNext=0,this.gameOver=!1,this.paused=!1,this.speed=120,this.player.x=80,this.player.y=Math.max(0,(t.canvas.height-this.player.height)*.5),this.player.vx=0,this.player.vy=0,this.player.hp=this.player.maxHp=3,this.player.fireCooldown=0,this.bullets=[],this.enemies=[],this.powerUps=[],this.enemyTimer=2.5,this.powerTimer=5,this.hintT=4,this.shakeT=0,this.floats=[],this.lastGapCenter=null,this.ended=!1,this.btnLeftDown=this.btnRightDown=this.btnShootDown=!1,this.restartRect=null,this.multishotT=0,this.bigshotT=0,this.slowmoT=0,this.magnetT=0,this.rapidT=0;const r=()=>{const d=t.canvas.width,x=t.canvas.height,m=Math.max(60,Math.min(120,Math.floor(Math.min(d,x)*.14))),b=24;this.btnRects={left:{x:b,y:x-m-b,w:m,h:m},right:{x:b+m+16,y:x-m-b,w:m,h:m},shoot:{x:d-m-b,y:x-m-b,w:m,h:m}}},n=()=>{const d=t.canvas.width,x=t.canvas.height,m=Math.max(64,Math.min(120,Math.floor(Math.min(d,x)*.16)));this.restartRect={x:(d-m)/2,y:x*.55,w:m,h:m}},o=(d,x,m)=>{if(!this.btnRects)return!1;const b=this.btnRects[d];return x>=b.x&&x<=b.x+b.w&&m>=b.y&&m<=b.y+b.h},c=d=>{r(),this.btnLeftDown=this.btnRightDown=this.btnShootDown=!1;const x=t.canvas.getBoundingClientRect(),m=t.canvas.width/x.width,b=t.canvas.height/x.height;for(let f=0;f<d.touches.length;f++){const g=d.touches.item(f),_=(g.clientX-x.left)*m,v=(g.clientY-x.top)*b;o("left",_,v)?this.btnLeftDown=!0:o("right",_,v)?this.btnRightDown=!0:o("shoot",_,v)&&(this.btnShootDown=!0)}},u=d=>{var b;if(this.gameOver){if(d.touches!==void 0){n();const f=d,g=t.canvas.getBoundingClientRect(),_=t.canvas.width/g.width,v=t.canvas.height/g.height;for(let E=0;E<f.touches.length;E++){const M=f.touches.item(E),T=(M.clientX-g.left)*_,k=(M.clientY-g.top)*v,L=this.restartRect;if(T>=L.x&&T<=L.x+L.w&&k>=L.y&&k<=L.y+L.h){this.init(t);return}}}else{n();const f=this.restartRect,g=d,_=t.canvas.getBoundingClientRect(),v=t.canvas.width/_.width,E=t.canvas.height/_.height,M=(g.clientX-_.left)*v,T=(g.clientY-_.top)*E;if(M>=f.x&&M<=f.x+f.w&&T>=f.y&&T<=f.y+f.h){this.init(t);return}}return}if(d.touches!==void 0){const f=d;if(c(f),this.btnLeftDown||this.btnRightDown||this.btnShootDown){this.btnShootDown&&this.fireWeapon();return}const g=t.canvas.width,_=t.canvas.height,v=t.canvas.getBoundingClientRect(),E=g/v.width,M=_/v.height;let T=!1;for(let L=0;L<f.touches.length;L++){const D=f.touches.item(L),$=(D.clientX-v.left)*E,N=(D.clientY-v.top)*M;if($>g*.7&&N>_*.6){T=!0;break}}if(T){this.fireWeapon();return}(((b=f.touches)==null?void 0:b.length)??0)>=2?this.fireWeapon():(G.jump(this.player),U.flap(),this.particles.burst(this.player.x+this.player.width*.2,this.player.y+this.player.height,H.reducedMotion?4:8,"#88ccff88"));return}const x=d.button??0,m=$e(x);m==="flap"?(G.jump(this.player),U.flap()):m==="shoot"&&this.fireWeapon()};t.canvas.oncontextmenu=d=>{d.preventDefault()},t.canvas.onpointerdown=u;const l=d=>{const x=t.canvas.getBoundingClientRect();let m=0,b=0;for(let f=0;f<d.touches.length;f++){const _=d.touches.item(f).clientX-x.left;_<x.width*.45?m=1:_>x.width*.55&&(b=1)}this.mobileMoveX=b-m};t.canvas.ontouchstart=d=>{l(d),u(d)},t.canvas.ontouchmove=d=>{l(d),c(d)},t.canvas.ontouchend=d=>{l(d),c(d)};try{const d=localStorage.getItem("best");d&&(this.best=parseInt(d,10)||0)}catch{}try{this.playerName=z.getPlayerName()}catch{this.playerName=null}document.addEventListener("visibilitychange",()=>{document.hidden&&(this.paused=!0)})}fireWeapon(){if(this.player.fireCooldown>0)return;const t=this.player.x+this.player.width,r=this.player.y+this.player.height*.5-2,n=c=>{const l=Math.cos(c)*360,d=Math.sin(c)*360,x=new We(t,r,l,d,"player");return this.bigshotT>0&&(x.width=14,x.damage=2,x.color="#ffa6a6"),x};this.multishotT>0?(this.bullets.push(n(0-.13)),this.bullets.push(n(0)),this.bullets.push(n(0+.13))):this.bullets.push(n(0));let o=this.bigshotT>0?.22:this.multishotT>0?.2:.18;this.rapidT>0&&(o=Math.max(.08,o*.55)),this.player.fireCooldown=o,U.beep(980,.05,"square",.05)}update(t,r){var m,b;const n=r.canvas.height;if(r.input.wasPressed("KeyP")&&(this.paused=!this.paused),r.input.wasPressed("KeyR")&&this.init(r),this.paused)return;const o=this.slowmoT>0?.7:1,c=t*o;(r.input.wasPressed("Space")||r.input.wasPressed("ArrowUp")||r.input.wasPressed("KeyW"))&&(G.jump(this.player),U.flap(),this.particles.burst(this.player.x+this.player.width*.2,this.player.y+this.player.height,H.reducedMotion?4:8,"#88ccff88")),(r.input.isDown("KeyJ")||r.input.isDown("ControlLeft")||r.input.isDown("ControlRight")||this.btnShootDown)&&this.fireWeapon();const u=r.input.getMovementDirection(),l=((b=(m=r.input).getWASDHorizontal)==null?void 0:b.call(m))??(r.input.isDown("KeyD")?1:0)+(r.input.isDown("KeyA")?-1:0),d=(this.btnRightDown?1:0)-(this.btnLeftDown?1:0);if(this.player.vx=(u.x+l+this.mobileMoveX+d)*80,G.applyGravity(this.player,c),this.player.update(c),this.player.y=Math.max(0,Math.min(n-this.player.height,this.player.y)),this.timeToNext-=c,this.timeToNext<=0){const f=Math.min(1,this.score/30);this.speed=Math.min(280,120+f*140);const g=Math.max(150,230-this.score*2.2);this.timeToNext=Math.max(1.1,1.8-this.score*.02);const _=g,v=60,E=v+_/2,M=n-v-_/2,T=this.lastGapCenter??n/2,k=140+Math.min(100,this.score*2),L=Math.max(E,T-k),D=Math.min(M,T+k),$=L<=D?L+Math.random()*(D-L):Math.min(M,Math.max(E,T)),N=Math.floor($-_/2);this.lastGapCenter=$;const W=80,X=r.canvas.width+W;this.obstacles.push(new At(X,0,W,N,this.speed)),this.obstacles.push(new At(X,N+_,W,n-(N+_),this.speed))}for(const f of this.obstacles)f.update(c);this.obstacles=this.obstacles.filter(f=>!f.isOffScreen());for(const f of this.obstacles)G.checkCollision(this.player,f)&&(this.player.hp-=1,U.hit(),this.particles.burst(this.player.x+this.player.width/2,this.player.y+this.player.height/2,H.reducedMotion?6:12,"#ff7b72aa"),this.shakeT=H.reducedMotion?0:.2,this.hurtT=.35,this.combo=0,this.comboT=0,this.player.x-=10,this.player.hp<=0&&this.finalizeGameOver());for(let f=0;f<this.obstacles.length;f+=2){const g=this.obstacles[f],_=g.x+g.width/2;!this.gameOver&&_<this.player.x&&g.counted!==!0&&(g.counted=!0,this.score+=1,this.player.passObstacle(),U.score())}if(this.enemyTimer-=c,this.enemyTimer<=0){let f=40,g=n-40;if(this.obstacles.length>=2){let W=0,X=-1/0;for(let Q=0;Q<this.obstacles.length-1;Q+=2){const ot=this.obstacles[Q];ot.x>X&&(X=ot.x,W=Q)}const st=this.obstacles[W],rt=this.obstacles[W+1];f=st.height,g=rt.y}const _=12,v=Math.max(0,f+_),E=Math.min(n-20,g-_-18),M=r.canvas.width+40,T=v<E?v+(E-v)*(.35+Math.random()*.3):40+Math.random()*(n-120);let k="drone";this.score>6&&Math.random()<.5&&(k="bee"),this.score>15&&Math.random()<.35&&(k="tank"),this.score>25&&Math.random()<.25&&(k="kamikaze");const D=-((k==="tank"?90:120)+Math.random()*60+this.score*1.2),$=new qe(M,T,D,0,k);$.minY=isFinite(v)?v:20,$.maxY=isFinite(E)?E:n-40,$.phase=Math.random()*Math.PI*2,this.enemies.push($);const N=2.4-Math.min(1.2,this.score*.03);this.enemyTimer=Math.max(.8,N+(k==="tank"?.3:0))}if(this.powerTimer-=c,this.powerTimer<=0){const f=Ve(this.score);this.powerUps.push(new Ke(r.canvas.width+20,80+Math.random()*(n-160),f)),this.powerTimer=8+Math.random()*6}for(const f of this.bullets)f.update(c);for(const f of this.enemies){const g=(f.phase??0)+performance.now()/1e3;if(f.variant==="kamikaze"){const M=this.player.y-6-f.y;f.vy=Math.max(-120,Math.min(120,M*2))}else f.variant==="bee"?f.vy=Math.sin(g*1.5)*55:f.variant==="tank"?f.vy=Math.sin(g*.6)*24:f.vy=Math.sin(g)*35;f.update(c);const _=f.minY??20,v=f.maxY??n-40;f.y<_&&(f.y=_),f.y+f.height>v&&(f.y=v-f.height)}for(const f of this.powerUps){if(this.magnetT>0){const g=this.player.x+this.player.width/2,_=this.player.y+this.player.height/2,v=g-(f.x+f.width/2),E=_-(f.y+f.height/2);v*v+E*E<200*200&&(f.vx+=Math.sign(v)*20,f.vy+=Math.sign(E)*20,!H.reducedMotion&&Math.random()<.25&&this.particles.burst(f.x+f.width/2,f.y+f.height/2,1,"#f472b6aa"))}f.update(c)}this.bullets=this.bullets.filter(f=>!f.isOffScreen(r.canvas.width,n)&&f.active),this.enemies=this.enemies.filter(f=>!f.isOffScreen()),this.powerUps=this.powerUps.filter(f=>!f.isOffScreen());const x=(f,g,_,v,E,M,T,k)=>f<E+T&&f+_>E&&g<M+k&&g+v>M;for(const f of this.bullets)for(const g of this.enemies)if(f.active&&x(f.x,f.y,f.width,f.height,g.x,g.y,g.width,g.height)&&(f.active=!1,g.health-=f.damage??1,this.particles.burst(g.x+g.width/2,g.y+g.height/2,H.reducedMotion?6:10,"#ffd166aa"),g.health<=0)){const _=g.x+g.width/2,v=g.y+g.height/2;this.particles.burst(_,v,H.reducedMotion?10:22,"#ffb347aa"),this.particles.burst(_,v,H.reducedMotion?8:14,"#ff7b72aa"),g.x=-9999;const E=g.variant==="tank"?xt.KILL_POINTS+1:xt.KILL_POINTS,M=2.2;this.comboT>0?this.combo++:this.combo=1,this.comboT=M;const T=Math.max(0,this.combo-1);this.score+=E+T,this.floats.push({x:_,y:v,text:`+${E}`,ttl:.9,vy:-32}),T>0&&(this.floats.push({x:_+14,y:v-18,text:`x${this.combo}`,ttl:.8,vy:-26}),U.combo(this.combo)),this.shakeT=H.reducedMotion?0:Math.max(this.shakeT,.12),U.score()}this.enemies=this.enemies.filter(f=>f.x>-9e3);for(const f of this.enemies)x(this.player.x,this.player.y,this.player.width,this.player.height,f.x,f.y,f.width,f.height)&&(this.player.hp-=1,U.hit(),this.particles.burst(f.x+f.width/2,f.y+f.height/2,10,"#ff7b72aa"),f.x=-9999,this.player.hp<=0&&this.finalizeGameOver());for(const f of this.powerUps)x(this.player.x,this.player.y,this.player.width,this.player.height,f.x,f.y,f.width,f.height)&&(f.type==="heal"&&(this.player.hp=Math.min(this.player.maxHp,this.player.hp+1)),f.type==="rapid"&&(this.rapidT=Math.max(this.rapidT,8)),f.type==="shield"&&(this.player.maxHp=Math.min(5,this.player.maxHp+1),this.player.hp=Math.min(this.player.maxHp,this.player.hp+1)),f.type==="multishot"&&(this.multishotT=Math.max(this.multishotT,8)),f.type==="bigshot"&&(this.bigshotT=Math.max(this.bigshotT,8)),f.type==="slowmo"&&(this.slowmoT=Math.max(this.slowmoT,3.5)),f.type==="magnet"&&(this.magnetT=Math.max(this.magnetT,8)),this.particles.burst(f.x+f.width/2,f.y+f.height/2,14,"#7ee787aa"),f.x=-9999,this.pickupBadgeT=1.4);this.particles.update(c),this.shakeT=Math.max(0,this.shakeT-t),this.hurtT=Math.max(0,this.hurtT-t),this.comboT>0&&(this.comboT=Math.max(0,this.comboT-t)),this.slowmoT=Math.max(0,this.slowmoT-t),this.multishotT=Math.max(0,this.multishotT-t),this.bigshotT=Math.max(0,this.bigshotT-t),this.magnetT=Math.max(0,this.magnetT-t),this.rapidT=Math.max(0,this.rapidT-t);for(const f of this.floats)f.ttl-=t,f.y+=f.vy*t;this.floats=this.floats.filter(f=>f.ttl>0),this.hintT=Math.max(0,this.hintT-t)}finalizeGameOver(){if(this.ended)return;this.ended=!0,this.gameOver=!0,this.best=Math.max(this.best,this.score);try{localStorage.setItem("best",String(this.best))}catch{}let t=z.getPlayerName()||"";try{const r=typeof window<"u"?window.prompt("Name for high score?",t||"Anon"):null;r!=null&&(t=r,z.setPlayerName(t))}catch{}z.addScore(this.score,Date.now(),t),this.playerName=t}render(t,r){const n=this.shakeT>0?(Math.random()-.5)*8:0;t.save(),t.translate(n,n),this.renderer.clear(1/60);for(const u of this.obstacles)this.renderer.drawObstacle(u);for(const u of this.enemies)this.renderer.drawEnemy(u);for(const u of this.powerUps)this.renderer.drawPowerUp(u);const o=this.hurtT>0?"#f87171":"#58a6ff";if(this.renderer.drawPlayer(this.player,o),this.playerName){const u=this.playerName.slice(0,18),l=this.player.x+this.player.width/2;let d=this.player.y-6;d<14&&(d=this.player.y+this.player.height+14),t.save(),t.textAlign="center",t.font="600 12px system-ui",t.lineWidth=3,t.strokeStyle="#00000077",t.strokeText(u,l,d),t.fillStyle="#cdd9e5",t.fillText(u,l,d),t.restore()}for(const u of this.bullets)this.renderer.drawProjectile(u);this.particles.render(t),this.hud.render(t,this.score,void 0,this.player.hp);{const u=[{active:this.rapidT>0,color:"#f7b84a",glyph:"R",rem:this.rapidT,dur:8},{active:this.multishotT>0,color:"#38bdf8",glyph:"M",rem:this.multishotT,dur:8},{active:this.bigshotT>0,color:"#fb7185",glyph:"B",rem:this.bigshotT,dur:8},{active:this.slowmoT>0,color:"#a78bfa",glyph:"⌛",rem:this.slowmoT,dur:3.5},{active:this.magnetT>0,color:"#f472b6",glyph:"U",rem:this.magnetT,dur:8}],d=16+(this.player.hp??0)*18+12;let x=d,m=36;const b=12,f=12,g=3,_=6,v=r.canvas.width-16;for(const E of u){if(!E.active)continue;x+b>v&&(x=d,m+=f+6),t.save(),t.globalAlpha=.95,t.fillStyle=E.color,t.beginPath(),t.roundRect(x,m+2,b,f,g),t.fill();const M=Math.max(0,Math.min(1,E.rem/E.dur));t.strokeStyle="#0f172a",t.lineWidth=1.5,t.beginPath(),t.arc(x+b/2,m+2+f/2,6,-Math.PI/2,-Math.PI/2+M*Math.PI*2),t.stroke(),t.fillStyle="#0f172a",t.font="700 9px system-ui";const T=t.measureText(E.glyph).width;t.fillText(E.glyph,x+(b-T)/2,m+11),t.restore(),x+=b+_}}if(this.pickupBadgeT>0){const u=Math.min(1,this.pickupBadgeT/1.4);t.save(),t.globalAlpha=u*.9;const l=[{label:"Rapid",active:this.rapidT>0,color:"#f7b84a"},{label:"Multi",active:this.multishotT>0,color:"#38bdf8"},{label:"Big",active:this.bigshotT>0,color:"#fb7185"},{label:"Slow",active:this.slowmoT>0,color:"#a78bfa"},{label:"Mag",active:this.magnetT>0,color:"#f472b6"}].filter(m=>m.active);let d=16,x=82;for(const m of l)t.fillStyle="#0f172acc",t.beginPath(),t.roundRect(d,x,86,22,8),t.fill(),t.fillStyle=m.color+"dd",t.beginPath(),t.roundRect(d+2,x+2,82,18,6),t.strokeStyle=m.color+"66",t.lineWidth=2,t.stroke(),t.fillStyle="#e8e8f0",t.font="700 12px system-ui",t.fillText(m.label,d+10,x+15),d+=94;t.restore()}if(this.slowmoT>0){const u=Math.min(.25,.15+this.slowmoT/4*.1);t.save(),t.globalAlpha=u,t.fillStyle="#0b1022",t.fillRect(0,0,r.canvas.width,r.canvas.height),t.restore()}const c=[];if(this.rapidT>0&&c.push({label:"Rapid",t:this.rapidT,d:8,color:"#f7b84a"}),this.multishotT>0&&c.push({label:"Multi",t:this.multishotT,d:8,color:"#38bdf8"}),this.bigshotT>0&&c.push({label:"Big",t:this.bigshotT,d:8,color:"#fb7185"}),this.slowmoT>0&&c.push({label:"Slow",t:this.slowmoT,d:4,color:"#a78bfa"}),this.magnetT>0&&c.push({label:"Mag",t:this.magnetT,d:8,color:"#f472b6"}),c.length){let u=16,l=56;for(const d of c){t.save(),t.globalAlpha=.9,t.fillStyle="#0f172acc",t.beginPath(),t.roundRect(u,l,74,20,8),t.fill();const f=Math.max(0,Math.min(1,d.t/d.d));t.fillStyle=d.color+"aa",t.beginPath(),t.roundRect(u+2,l+20-6,70*f,4,3),t.fill(),t.fillStyle="#e8e8f0",t.font="600 12px system-ui",t.fillText(d.label,u+8,l+14),t.restore(),u+=82}}if(this.comboT>0&&this.combo>1&&(t.save(),t.fillStyle="#ffd166",t.font="700 14px system-ui",t.fillText(`Combo x${this.combo}`,16,46),t.restore()),this.floats.length)for(const u of this.floats){const l=Math.max(0,Math.min(1,u.ttl/.9));t.save(),t.globalAlpha=l,t.fillStyle="#ffd166",t.font="700 18px system-ui",t.fillText(u.text,u.x,u.y),t.restore()}if(this.isTouch){const u=r.canvas.width,l=r.canvas.height,d=Math.max(60,Math.min(120,Math.floor(Math.min(u,l)*.14))),x=24;this.btnRects={left:{x,y:l-d-x,w:d,h:d},right:{x:x+d+16,y:l-d-x,w:d,h:d},shoot:{x:u-d-x,y:l-d-x,w:d,h:d}};const m=(b,f,g)=>{t.save(),t.globalAlpha=.5,t.fillStyle=f?"#58a6ff":"#0f172a",t.strokeStyle="#58a6ff88",t.lineWidth=4,t.beginPath(),t.roundRect(b.x,b.y,b.w,b.h,16),t.fill(),t.stroke(),t.fillStyle="#e8e8f0",t.font="700 28px system-ui";const _=g==="L"?"◀":g==="R"?"▶":"●",v=t.measureText(_).width;t.fillText(_,b.x+(b.w-v)/2,b.y+b.h/2+10),t.restore()};m(this.btnRects.left,this.btnLeftDown,"L"),m(this.btnRects.right,this.btnRightDown,"R"),m(this.btnRects.shoot,this.btnShootDown,"S")}if(this.hintT>0){const u=Math.min(.8,this.hintT/4);t.save(),t.globalAlpha=u,t.fillStyle="#00000088",t.fillRect(20,70,520,56),t.fillStyle="#e8e8f0",t.font="600 16px system-ui",t.fillText("Flap: Space/ArrowUp/W or Click • Move: Arrows or A/D • Shoot: Right Click or Ctrl/J (hold)",28,100),t.restore()}if(t.restore(),this.paused&&(t.fillStyle="#00000088",t.fillRect(0,0,r.canvas.width,r.canvas.height),t.fillStyle="#e8e8f0",t.font="700 28px system-ui",t.fillText("Paused (P). R = Restart, Esc = Title",40,120)),this.gameOver){t.fillStyle="#00000088",t.fillRect(0,0,r.canvas.width,r.canvas.height),t.fillStyle="#e8e8f0",t.font="700 28px system-ui",t.fillText(`Game Over — Score ${this.score}  Best ${this.best}`,40,120),t.font="500 18px system-ui",t.fillText("Press R or tap the restart button",40,160);const u=r.canvas.width,l=r.canvas.height,d=Math.max(64,Math.min(120,Math.floor(Math.min(u,l)*.16))),x=(u-d)/2,m=l*.55;this.restartRect={x,y:m,w:d,h:d},t.save(),t.globalAlpha=.9,t.fillStyle="#0f172a",t.strokeStyle="#58a6ff88",t.lineWidth=5,t.beginPath(),t.roundRect(x,m,d,d,18),t.fill(),t.stroke(),t.fillStyle="#e8e8f0",t.font="700 28px system-ui",t.fillText("⟲",x+d/2-10,m+d/2+12),t.restore()}}};xt.KILL_POINTS=2;let _t=xt;class jt{constructor(){this.p1=new vt(80,140,26,26),this.p2=new vt(120,220,26,26),this.obstacles=[],this.hud=new Vt,this.timeToNext=0,this.s1=0,this.s2=0,this.paused=!1,this.speed=140,this.particles=new me,this.shakeT=0}init(t){this.renderer=new Yt(t.canvas,t.ctx),this.obstacles=[],this.timeToNext=0,this.s1=0,this.s2=0,this.paused=!1,this.speed=140;const r=()=>{G.jump(this.p1),U.flap()};t.canvas.ontouchstart=r,t.canvas.onpointerdown=r}update(t,r){const n=r.canvas.height;if(r.input.wasPressed("KeyP")&&(this.paused=!this.paused),r.input.wasPressed("KeyR")&&this.init(r),this.paused)return;(r.input.wasPressed("Space")||r.input.wasPressed("ArrowUp"))&&(G.jump(this.p1),U.flap(),this.particles.burst(this.p1.x,this.p1.y+this.p1.height,6,"#88ccff88")),r.input.wasPressed("KeyW")&&(G.jump(this.p2),U.flap(),this.particles.burst(this.p2.x,this.p2.y+this.p2.height,6,"#ffb08888"));const o=r.input.getMovementDirection();if(this.p1.vx=o.x*80,this.p2.vx=0,this.p2.vy+=(r.input.isDown("KeyS")?1:0)*300*t,G.applyGravity(this.p1,t),G.applyGravity(this.p2,t),this.p1.update(t),this.p2.update(t),this.p1.y=Math.max(0,Math.min(n-this.p1.height,this.p1.y)),this.p2.y=Math.max(0,Math.min(n-this.p2.height,this.p2.y)),this.timeToNext-=t,this.timeToNext<=0){this.speed=Math.min(260,this.speed+2);const c=Math.max(130,180-Math.max(this.s1,this.s2)*2);this.timeToNext=Math.max(1,1.7-Math.max(this.s1,this.s2)*.02);const u=40,l=n-c-40,d=Math.floor(Math.random()*(l-u+1))+u,x=80,m=r.canvas.width+x;this.obstacles.push(new At(m,0,x,d,this.speed)),this.obstacles.push(new At(m,d+c,x,n-(d+c),this.speed))}for(const c of this.obstacles)c.update(t);this.obstacles=this.obstacles.filter(c=>!c.isOffScreen());for(const c of this.obstacles)if(G.checkCollision(this.p1,c)||G.checkCollision(this.p2,c)){U.hit(),this.particles.burst((this.p1.x+this.p2.x)/2,(this.p1.y+this.p2.y)/2,16,"#ff7b72aa"),this.shakeT=.25,this.init(r);return}for(let c=0;c<this.obstacles.length;c+=2){const u=this.obstacles[c],l=u.x+u.width/2;l<this.p1.x&&u.p1c!==!0&&(u.p1c=!0,this.s1+=1,this.p1.passObstacle(),U.score()),l<this.p2.x&&u.p2c!==!0&&(u.p2c=!0,this.s2+=1,this.p2.passObstacle(),U.score())}}render(t,r){const n=this.shakeT>0?(Math.random()-.5)*8:0;t.save(),t.translate(n,n),this.renderer.clear(1/60);for(const o of this.obstacles)this.renderer.drawObstacle(o);this.renderer.drawPlayer(this.p1,"#58a6ff"),this.renderer.drawPlayer(this.p2,"#ff7b72"),this.particles.render(t),this.hud.render(t,this.s1,this.s2),t.restore(),this.paused&&(t.fillStyle="#00000088",t.fillRect(0,0,r.canvas.width,r.canvas.height),t.fillStyle="#e8e8f0",t.font="700 28px system-ui",t.fillText("Paused (P). R = Restart, Esc = Title",40,120))}}class Gt extends Error{constructor(t){super(t),this.name="AbortError"}}function Ye(h,t){const{cleanupBeforeAbort:r,abortSignal:n,abortErrorMsg:o}=t??{};return new Promise((c,u)=>{function l(){u(new Gt(o??"The operation was aborted."))}function d(){n==null||n.removeEventListener("abort",x)}function x(){r==null||r(),d(),l()}if(n!=null&&n.aborted)return l();try{h(m=>{d(),c(m)},m=>{d(),u(m)})}catch(m){u(m)}n==null||n.addEventListener("abort",x)})}const ze="The delay was aborted.";function It(h,t){let r;const{abortSignal:n,abortErrorMsg:o}={};return Ye(c=>{r=setTimeout(c,h)},{cleanupBeforeAbort:()=>clearTimeout(r),abortSignal:n,abortErrorMsg:o??ze})}function Xe(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var zt={exports:{}},pt=typeof Reflect=="object"?Reflect:null,se=pt&&typeof pt.apply=="function"?pt.apply:function(t,r,n){return Function.prototype.apply.call(t,r,n)},Rt;pt&&typeof pt.ownKeys=="function"?Rt=pt.ownKeys:Object.getOwnPropertySymbols?Rt=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Rt=function(t){return Object.getOwnPropertyNames(t)};function He(h){console&&console.warn&&console.warn(h)}var be=Number.isNaN||function(t){return t!==t};function I(){I.init.call(this)}zt.exports=I;zt.exports.once=ti;I.EventEmitter=I;I.prototype._events=void 0;I.prototype._eventsCount=0;I.prototype._maxListeners=void 0;var oe=10;function Bt(h){if(typeof h!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof h)}Object.defineProperty(I,"defaultMaxListeners",{enumerable:!0,get:function(){return oe},set:function(h){if(typeof h!="number"||h<0||be(h))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+h+".");oe=h}});I.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};I.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||be(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function xe(h){return h._maxListeners===void 0?I.defaultMaxListeners:h._maxListeners}I.prototype.getMaxListeners=function(){return xe(this)};I.prototype.emit=function(t){for(var r=[],n=1;n<arguments.length;n++)r.push(arguments[n]);var o=t==="error",c=this._events;if(c!==void 0)o=o&&c.error===void 0;else if(!o)return!1;if(o){var u;if(r.length>0&&(u=r[0]),u instanceof Error)throw u;var l=new Error("Unhandled error."+(u?" ("+u.message+")":""));throw l.context=u,l}var d=c[t];if(d===void 0)return!1;if(typeof d=="function")se(d,this,r);else for(var x=d.length,m=Me(d,x),n=0;n<x;++n)se(m[n],this,r);return!0};function ve(h,t,r,n){var o,c,u;if(Bt(r),c=h._events,c===void 0?(c=h._events=Object.create(null),h._eventsCount=0):(c.newListener!==void 0&&(h.emit("newListener",t,r.listener?r.listener:r),c=h._events),u=c[t]),u===void 0)u=c[t]=r,++h._eventsCount;else if(typeof u=="function"?u=c[t]=n?[r,u]:[u,r]:n?u.unshift(r):u.push(r),o=xe(h),o>0&&u.length>o&&!u.warned){u.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+u.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=h,l.type=t,l.count=u.length,He(l)}return h}I.prototype.addListener=function(t,r){return ve(this,t,r,!1)};I.prototype.on=I.prototype.addListener;I.prototype.prependListener=function(t,r){return ve(this,t,r,!0)};function Je(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _e(h,t,r){var n={fired:!1,wrapFn:void 0,target:h,type:t,listener:r},o=Je.bind(n);return o.listener=r,n.wrapFn=o,o}I.prototype.once=function(t,r){return Bt(r),this.on(t,_e(this,t,r)),this};I.prototype.prependOnceListener=function(t,r){return Bt(r),this.prependListener(t,_e(this,t,r)),this};I.prototype.removeListener=function(t,r){var n,o,c,u,l;if(Bt(r),o=this._events,o===void 0)return this;if(n=o[t],n===void 0)return this;if(n===r||n.listener===r)--this._eventsCount===0?this._events=Object.create(null):(delete o[t],o.removeListener&&this.emit("removeListener",t,n.listener||r));else if(typeof n!="function"){for(c=-1,u=n.length-1;u>=0;u--)if(n[u]===r||n[u].listener===r){l=n[u].listener,c=u;break}if(c<0)return this;c===0?n.shift():Ze(n,c),n.length===1&&(o[t]=n[0]),o.removeListener!==void 0&&this.emit("removeListener",t,l||r)}return this};I.prototype.off=I.prototype.removeListener;I.prototype.removeAllListeners=function(t){var r,n,o;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[t]),this;if(arguments.length===0){var c=Object.keys(n),u;for(o=0;o<c.length;++o)u=c[o],u!=="removeListener"&&this.removeAllListeners(u);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(r=n[t],typeof r=="function")this.removeListener(t,r);else if(r!==void 0)for(o=r.length-1;o>=0;o--)this.removeListener(t,r[o]);return this};function Ee(h,t,r){var n=h._events;if(n===void 0)return[];var o=n[t];return o===void 0?[]:typeof o=="function"?r?[o.listener||o]:[o]:r?Qe(o):Me(o,o.length)}I.prototype.listeners=function(t){return Ee(this,t,!0)};I.prototype.rawListeners=function(t){return Ee(this,t,!1)};I.listenerCount=function(h,t){return typeof h.listenerCount=="function"?h.listenerCount(t):Se.call(h,t)};I.prototype.listenerCount=Se;function Se(h){var t=this._events;if(t!==void 0){var r=t[h];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}I.prototype.eventNames=function(){return this._eventsCount>0?Rt(this._events):[]};function Me(h,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=h[n];return r}function Ze(h,t){for(;t+1<h.length;t++)h[t]=h[t+1];h.pop()}function Qe(h){for(var t=new Array(h.length),r=0;r<t.length;++r)t[r]=h[r].listener||h[r];return t}function ti(h,t){return new Promise(function(r,n){function o(u){h.removeListener(t,c),n(u)}function c(){typeof h.removeListener=="function"&&h.removeListener("error",o),r([].slice.call(arguments))}Te(h,t,c,{once:!0}),t!=="error"&&ei(h,o,{once:!0})})}function ei(h,t,r){typeof h.on=="function"&&Te(h,"error",t,r)}function Te(h,t,r,n){if(typeof h.on=="function")n.once?h.once(t,r):h.on(t,r);else if(typeof h.addEventListener=="function")h.addEventListener(t,function o(c){n.once&&h.removeEventListener(t,o),r(c)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof h)}var ii=zt.exports;const ri=Xe(ii);class Tt extends Error{constructor(t,r){super(t),this.name="SendMessageError",this.ackId=r.ackId,this.errorDetail=r.errorDetail}}function ni(...h){if(h.length>0){const t=String(h[0]);t.includes(":error")?console.error(...h):t.includes(":warning")?console.warn(...h):t.includes(":info")?console.info(...h):t.includes(":verbose")?console.debug(...h):console.debug(...h)}}var ae={};const he=typeof process<"u"&&ae&&ae.DEBUG||void 0;let Ie,$t=[],Wt=[];const kt=[];he&&Xt(he);const ut=Object.assign(h=>Re(h),{enable:Xt,enabled:Ht,disable:si,log:ni});function Xt(h){Ie=h,$t=[],Wt=[];const t=/\*/g,r=h.split(",").map(n=>n.trim().replace(t,".*?"));for(const n of r)n.startsWith("-")?Wt.push(new RegExp(`^${n.substr(1)}$`)):$t.push(new RegExp(`^${n}$`));for(const n of kt)n.enabled=Ht(n.namespace)}function Ht(h){if(h.endsWith("*"))return!0;for(const t of Wt)if(t.test(h))return!1;for(const t of $t)if(t.test(h))return!0;return!1}function si(){const h=Ie||"";return Xt(""),h}function Re(h){const t=Object.assign(r,{enabled:Ht(h),destroy:oi,log:ut.log,namespace:h,extend:ai});function r(...n){t.enabled&&(n.length>0&&(n[0]=`${h} ${n[0]}`),t.log(...n))}return kt.push(t),t}function oi(){const h=kt.indexOf(this);return h>=0?(kt.splice(h,1),!0):!1}function ai(h){const t=Re(`${this.namespace}:${h}`);return t.log=this.log,t}var le={};const qt=["verbose","info","warning","error"],ce={verbose:400,info:300,warning:200,error:100};function ue(h,t){t.log=(...r)=>{h.log(...r)}}function fe(h){return qt.includes(h)}function Ae(h){const t=new Set,r=typeof process<"u"&&le&&le[h.logLevelEnvVarName]||void 0;let n;const o=ut(h.namespace);o.log=(...m)=>{ut.log(...m)};function c(m){if(m&&!fe(m))throw new Error(`Unknown log level '${m}'. Acceptable values: ${qt.join(",")}`);n=m;const b=[];for(const f of t)u(f)&&b.push(f.namespace);ut.enable(b.join(","))}r&&(fe(r)?c(r):console.error(`${h.logLevelEnvVarName} set to unknown log level '${r}'; logging is not enabled. Acceptable values: ${qt.join(", ")}.`));function u(m){return!!(n&&ce[m.level]<=ce[n])}function l(m,b){const f=Object.assign(m.extend(b),{level:b});if(ue(m,f),u(f)){const g=ut.disable();ut.enable(g+","+f.namespace)}return t.add(f),f}function d(){return n}function x(m){const b=o.extend(m);return ue(o,b),{error:l(b,"error"),warning:l(b,"warning"),info:l(b,"info"),verbose:l(b,"verbose")}}return{setLogLevel:c,getLogLevel:d,createClientLogger:x,logger:o}}Ae({logLevelEnvVarName:"TYPESPEC_RUNTIME_LOG_LEVEL",namespace:"typeSpecRuntime"});const hi=Ae({logLevelEnvVarName:"AZURE_LOG_LEVEL",namespace:"azure"});function li(h){return hi.createClientLogger(h)}const j=li("web-pubsub-client");var Jt={},Ct={};Ct.byteLength=fi;Ct.toByteArray=di;Ct.fromByteArray=mi;var Z=[],Y=[],ci=typeof Uint8Array<"u"?Uint8Array:Array,Ot="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var ct=0,ui=Ot.length;ct<ui;++ct)Z[ct]=Ot[ct],Y[Ot.charCodeAt(ct)]=ct;Y[45]=62;Y[95]=63;function ke(h){var t=h.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=h.indexOf("=");r===-1&&(r=t);var n=r===t?0:4-r%4;return[r,n]}function fi(h){var t=ke(h),r=t[0],n=t[1];return(r+n)*3/4-n}function pi(h,t,r){return(t+r)*3/4-r}function di(h){var t,r=ke(h),n=r[0],o=r[1],c=new ci(pi(h,n,o)),u=0,l=o>0?n-4:n,d;for(d=0;d<l;d+=4)t=Y[h.charCodeAt(d)]<<18|Y[h.charCodeAt(d+1)]<<12|Y[h.charCodeAt(d+2)]<<6|Y[h.charCodeAt(d+3)],c[u++]=t>>16&255,c[u++]=t>>8&255,c[u++]=t&255;return o===2&&(t=Y[h.charCodeAt(d)]<<2|Y[h.charCodeAt(d+1)]>>4,c[u++]=t&255),o===1&&(t=Y[h.charCodeAt(d)]<<10|Y[h.charCodeAt(d+1)]<<4|Y[h.charCodeAt(d+2)]>>2,c[u++]=t>>8&255,c[u++]=t&255),c}function yi(h){return Z[h>>18&63]+Z[h>>12&63]+Z[h>>6&63]+Z[h&63]}function wi(h,t,r){for(var n,o=[],c=t;c<r;c+=3)n=(h[c]<<16&16711680)+(h[c+1]<<8&65280)+(h[c+2]&255),o.push(yi(n));return o.join("")}function mi(h){for(var t,r=h.length,n=r%3,o=[],c=16383,u=0,l=r-n;u<l;u+=c)o.push(wi(h,u,u+c>l?l:u+c));return n===1?(t=h[r-1],o.push(Z[t>>2]+Z[t<<4&63]+"==")):n===2&&(t=(h[r-2]<<8)+h[r-1],o.push(Z[t>>10]+Z[t>>4&63]+Z[t<<2&63]+"=")),o.join("")}var Zt={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Zt.read=function(h,t,r,n,o){var c,u,l=o*8-n-1,d=(1<<l)-1,x=d>>1,m=-7,b=r?o-1:0,f=r?-1:1,g=h[t+b];for(b+=f,c=g&(1<<-m)-1,g>>=-m,m+=l;m>0;c=c*256+h[t+b],b+=f,m-=8);for(u=c&(1<<-m)-1,c>>=-m,m+=n;m>0;u=u*256+h[t+b],b+=f,m-=8);if(c===0)c=1-x;else{if(c===d)return u?NaN:(g?-1:1)*(1/0);u=u+Math.pow(2,n),c=c-x}return(g?-1:1)*u*Math.pow(2,c-n)};Zt.write=function(h,t,r,n,o,c){var u,l,d,x=c*8-o-1,m=(1<<x)-1,b=m>>1,f=o===23?Math.pow(2,-24)-Math.pow(2,-77):0,g=n?0:c-1,_=n?1:-1,v=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(l=isNaN(t)?1:0,u=m):(u=Math.floor(Math.log(t)/Math.LN2),t*(d=Math.pow(2,-u))<1&&(u--,d*=2),u+b>=1?t+=f/d:t+=f*Math.pow(2,1-b),t*d>=2&&(u++,d/=2),u+b>=m?(l=0,u=m):u+b>=1?(l=(t*d-1)*Math.pow(2,o),u=u+b):(l=t*Math.pow(2,b-1)*Math.pow(2,o),u=0));o>=8;h[r+g]=l&255,g+=_,l/=256,o-=8);for(u=u<<o|l,x+=o;x>0;h[r+g]=u&255,g+=_,u/=256,x-=8);h[r+g-_]|=v*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(h){const t=Ct,r=Zt,n=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;h.Buffer=l,h.SlowBuffer=T,h.INSPECT_MAX_BYTES=50;const o=2147483647;h.kMaxLength=o,l.TYPED_ARRAY_SUPPORT=c(),!l.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function c(){try{const s=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(s,e),s.foo()===42}catch{return!1}}Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}});function u(s){if(s>o)throw new RangeError('The value "'+s+'" is invalid for option "size"');const e=new Uint8Array(s);return Object.setPrototypeOf(e,l.prototype),e}function l(s,e,i){if(typeof s=="number"){if(typeof e=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return b(s)}return d(s,e,i)}l.poolSize=8192;function d(s,e,i){if(typeof s=="string")return f(s,e);if(ArrayBuffer.isView(s))return _(s);if(s==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof s);if(J(s,ArrayBuffer)||s&&J(s.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(J(s,SharedArrayBuffer)||s&&J(s.buffer,SharedArrayBuffer)))return v(s,e,i);if(typeof s=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const a=s.valueOf&&s.valueOf();if(a!=null&&a!==s)return l.from(a,e,i);const p=E(s);if(p)return p;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof s[Symbol.toPrimitive]=="function")return l.from(s[Symbol.toPrimitive]("string"),e,i);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof s)}l.from=function(s,e,i){return d(s,e,i)},Object.setPrototypeOf(l.prototype,Uint8Array.prototype),Object.setPrototypeOf(l,Uint8Array);function x(s){if(typeof s!="number")throw new TypeError('"size" argument must be of type number');if(s<0)throw new RangeError('The value "'+s+'" is invalid for option "size"')}function m(s,e,i){return x(s),s<=0?u(s):e!==void 0?typeof i=="string"?u(s).fill(e,i):u(s).fill(e):u(s)}l.alloc=function(s,e,i){return m(s,e,i)};function b(s){return x(s),u(s<0?0:M(s)|0)}l.allocUnsafe=function(s){return b(s)},l.allocUnsafeSlow=function(s){return b(s)};function f(s,e){if((typeof e!="string"||e==="")&&(e="utf8"),!l.isEncoding(e))throw new TypeError("Unknown encoding: "+e);const i=k(s,e)|0;let a=u(i);const p=a.write(s,e);return p!==i&&(a=a.slice(0,p)),a}function g(s){const e=s.length<0?0:M(s.length)|0,i=u(e);for(let a=0;a<e;a+=1)i[a]=s[a]&255;return i}function _(s){if(J(s,Uint8Array)){const e=new Uint8Array(s);return v(e.buffer,e.byteOffset,e.byteLength)}return g(s)}function v(s,e,i){if(e<0||s.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(s.byteLength<e+(i||0))throw new RangeError('"length" is outside of buffer bounds');let a;return e===void 0&&i===void 0?a=new Uint8Array(s):i===void 0?a=new Uint8Array(s,e):a=new Uint8Array(s,e,i),Object.setPrototypeOf(a,l.prototype),a}function E(s){if(l.isBuffer(s)){const e=M(s.length)|0,i=u(e);return i.length===0||s.copy(i,0,0,e),i}if(s.length!==void 0)return typeof s.length!="number"||Dt(s.length)?u(0):g(s);if(s.type==="Buffer"&&Array.isArray(s.data))return g(s.data)}function M(s){if(s>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return s|0}function T(s){return+s!=s&&(s=0),l.alloc(+s)}l.isBuffer=function(e){return e!=null&&e._isBuffer===!0&&e!==l.prototype},l.compare=function(e,i){if(J(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),J(i,Uint8Array)&&(i=l.from(i,i.offset,i.byteLength)),!l.isBuffer(e)||!l.isBuffer(i))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===i)return 0;let a=e.length,p=i.length;for(let y=0,w=Math.min(a,p);y<w;++y)if(e[y]!==i[y]){a=e[y],p=i[y];break}return a<p?-1:p<a?1:0},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(e,i){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(e.length===0)return l.alloc(0);let a;if(i===void 0)for(i=0,a=0;a<e.length;++a)i+=e[a].length;const p=l.allocUnsafe(i);let y=0;for(a=0;a<e.length;++a){let w=e[a];if(J(w,Uint8Array))y+w.length>p.length?(l.isBuffer(w)||(w=l.from(w)),w.copy(p,y)):Uint8Array.prototype.set.call(p,w,y);else if(l.isBuffer(w))w.copy(p,y);else throw new TypeError('"list" argument must be an Array of Buffers');y+=w.length}return p};function k(s,e){if(l.isBuffer(s))return s.length;if(ArrayBuffer.isView(s)||J(s,ArrayBuffer))return s.byteLength;if(typeof s!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof s);const i=s.length,a=arguments.length>2&&arguments[2]===!0;if(!a&&i===0)return 0;let p=!1;for(;;)switch(e){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":return Ft(s).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return i*2;case"hex":return i>>>1;case"base64":return ie(s).length;default:if(p)return a?-1:Ft(s).length;e=(""+e).toLowerCase(),p=!0}}l.byteLength=k;function L(s,e,i){let a=!1;if((e===void 0||e<0)&&(e=0),e>this.length||((i===void 0||i>this.length)&&(i=this.length),i<=0)||(i>>>=0,e>>>=0,i<=e))return"";for(s||(s="utf8");;)switch(s){case"hex":return q(this,e,i);case"utf8":case"utf-8":return nt(this,e,i);case"ascii":return Pt(this,e,i);case"latin1":case"binary":return F(this,e,i);case"base64":return ot(this,e,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return K(this,e,i);default:if(a)throw new TypeError("Unknown encoding: "+s);s=(s+"").toLowerCase(),a=!0}}l.prototype._isBuffer=!0;function D(s,e,i){const a=s[e];s[e]=s[i],s[i]=a}l.prototype.swap16=function(){const e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let i=0;i<e;i+=2)D(this,i,i+1);return this},l.prototype.swap32=function(){const e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let i=0;i<e;i+=4)D(this,i,i+3),D(this,i+1,i+2);return this},l.prototype.swap64=function(){const e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let i=0;i<e;i+=8)D(this,i,i+7),D(this,i+1,i+6),D(this,i+2,i+5),D(this,i+3,i+4);return this},l.prototype.toString=function(){const e=this.length;return e===0?"":arguments.length===0?nt(this,0,e):L.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e?!0:l.compare(this,e)===0},l.prototype.inspect=function(){let e="";const i=h.INSPECT_MAX_BYTES;return e=this.toString("hex",0,i).replace(/(.{2})/g,"$1 ").trim(),this.length>i&&(e+=" ... "),"<Buffer "+e+">"},n&&(l.prototype[n]=l.prototype.inspect),l.prototype.compare=function(e,i,a,p,y){if(J(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),!l.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(i===void 0&&(i=0),a===void 0&&(a=e?e.length:0),p===void 0&&(p=0),y===void 0&&(y=this.length),i<0||a>e.length||p<0||y>this.length)throw new RangeError("out of range index");if(p>=y&&i>=a)return 0;if(p>=y)return-1;if(i>=a)return 1;if(i>>>=0,a>>>=0,p>>>=0,y>>>=0,this===e)return 0;let w=y-p,S=a-i;const C=Math.min(w,S),B=this.slice(p,y),P=e.slice(i,a);for(let R=0;R<C;++R)if(B[R]!==P[R]){w=B[R],S=P[R];break}return w<S?-1:S<w?1:0};function $(s,e,i,a,p){if(s.length===0)return-1;if(typeof i=="string"?(a=i,i=0):i>2147483647?i=2147483647:i<-2147483648&&(i=-2147483648),i=+i,Dt(i)&&(i=p?0:s.length-1),i<0&&(i=s.length+i),i>=s.length){if(p)return-1;i=s.length-1}else if(i<0)if(p)i=0;else return-1;if(typeof e=="string"&&(e=l.from(e,a)),l.isBuffer(e))return e.length===0?-1:N(s,e,i,a,p);if(typeof e=="number")return e=e&255,typeof Uint8Array.prototype.indexOf=="function"?p?Uint8Array.prototype.indexOf.call(s,e,i):Uint8Array.prototype.lastIndexOf.call(s,e,i):N(s,[e],i,a,p);throw new TypeError("val must be string, number or Buffer")}function N(s,e,i,a,p){let y=1,w=s.length,S=e.length;if(a!==void 0&&(a=String(a).toLowerCase(),a==="ucs2"||a==="ucs-2"||a==="utf16le"||a==="utf-16le")){if(s.length<2||e.length<2)return-1;y=2,w/=2,S/=2,i/=2}function C(P,R){return y===1?P[R]:P.readUInt16BE(R*y)}let B;if(p){let P=-1;for(B=i;B<w;B++)if(C(s,B)===C(e,P===-1?0:B-P)){if(P===-1&&(P=B),B-P+1===S)return P*y}else P!==-1&&(B-=B-P),P=-1}else for(i+S>w&&(i=w-S),B=i;B>=0;B--){let P=!0;for(let R=0;R<S;R++)if(C(s,B+R)!==C(e,R)){P=!1;break}if(P)return B}return-1}l.prototype.includes=function(e,i,a){return this.indexOf(e,i,a)!==-1},l.prototype.indexOf=function(e,i,a){return $(this,e,i,a,!0)},l.prototype.lastIndexOf=function(e,i,a){return $(this,e,i,a,!1)};function W(s,e,i,a){i=Number(i)||0;const p=s.length-i;a?(a=Number(a),a>p&&(a=p)):a=p;const y=e.length;a>y/2&&(a=y/2);let w;for(w=0;w<a;++w){const S=parseInt(e.substr(w*2,2),16);if(Dt(S))return w;s[i+w]=S}return w}function X(s,e,i,a){return Mt(Ft(e,s.length-i),s,i,a)}function st(s,e,i,a){return Mt(Fe(e),s,i,a)}function rt(s,e,i,a){return Mt(ie(e),s,i,a)}function Q(s,e,i,a){return Mt(De(e,s.length-i),s,i,a)}l.prototype.write=function(e,i,a,p){if(i===void 0)p="utf8",a=this.length,i=0;else if(a===void 0&&typeof i=="string")p=i,a=this.length,i=0;else if(isFinite(i))i=i>>>0,isFinite(a)?(a=a>>>0,p===void 0&&(p="utf8")):(p=a,a=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const y=this.length-i;if((a===void 0||a>y)&&(a=y),e.length>0&&(a<0||i<0)||i>this.length)throw new RangeError("Attempt to write outside buffer bounds");p||(p="utf8");let w=!1;for(;;)switch(p){case"hex":return W(this,e,i,a);case"utf8":case"utf-8":return X(this,e,i,a);case"ascii":case"latin1":case"binary":return st(this,e,i,a);case"base64":return rt(this,e,i,a);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Q(this,e,i,a);default:if(w)throw new TypeError("Unknown encoding: "+p);p=(""+p).toLowerCase(),w=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function ot(s,e,i){return e===0&&i===s.length?t.fromByteArray(s):t.fromByteArray(s.slice(e,i))}function nt(s,e,i){i=Math.min(s.length,i);const a=[];let p=e;for(;p<i;){const y=s[p];let w=null,S=y>239?4:y>223?3:y>191?2:1;if(p+S<=i){let C,B,P,R;switch(S){case 1:y<128&&(w=y);break;case 2:C=s[p+1],(C&192)===128&&(R=(y&31)<<6|C&63,R>127&&(w=R));break;case 3:C=s[p+1],B=s[p+2],(C&192)===128&&(B&192)===128&&(R=(y&15)<<12|(C&63)<<6|B&63,R>2047&&(R<55296||R>57343)&&(w=R));break;case 4:C=s[p+1],B=s[p+2],P=s[p+3],(C&192)===128&&(B&192)===128&&(P&192)===128&&(R=(y&15)<<18|(C&63)<<12|(B&63)<<6|P&63,R>65535&&R<1114112&&(w=R))}}w===null?(w=65533,S=1):w>65535&&(w-=65536,a.push(w>>>10&1023|55296),w=56320|w&1023),a.push(w),p+=S}return St(a)}const Et=4096;function St(s){const e=s.length;if(e<=Et)return String.fromCharCode.apply(String,s);let i="",a=0;for(;a<e;)i+=String.fromCharCode.apply(String,s.slice(a,a+=Et));return i}function Pt(s,e,i){let a="";i=Math.min(s.length,i);for(let p=e;p<i;++p)a+=String.fromCharCode(s[p]&127);return a}function F(s,e,i){let a="";i=Math.min(s.length,i);for(let p=e;p<i;++p)a+=String.fromCharCode(s[p]);return a}function q(s,e,i){const a=s.length;(!e||e<0)&&(e=0),(!i||i<0||i>a)&&(i=a);let p="";for(let y=e;y<i;++y)p+=Ue[s[y]];return p}function K(s,e,i){const a=s.slice(e,i);let p="";for(let y=0;y<a.length-1;y+=2)p+=String.fromCharCode(a[y]+a[y+1]*256);return p}l.prototype.slice=function(e,i){const a=this.length;e=~~e,i=i===void 0?a:~~i,e<0?(e+=a,e<0&&(e=0)):e>a&&(e=a),i<0?(i+=a,i<0&&(i=0)):i>a&&(i=a),i<e&&(i=e);const p=this.subarray(e,i);return Object.setPrototypeOf(p,l.prototype),p};function A(s,e,i){if(s%1!==0||s<0)throw new RangeError("offset is not uint");if(s+e>i)throw new RangeError("Trying to access beyond buffer length")}l.prototype.readUintLE=l.prototype.readUIntLE=function(e,i,a){e=e>>>0,i=i>>>0,a||A(e,i,this.length);let p=this[e],y=1,w=0;for(;++w<i&&(y*=256);)p+=this[e+w]*y;return p},l.prototype.readUintBE=l.prototype.readUIntBE=function(e,i,a){e=e>>>0,i=i>>>0,a||A(e,i,this.length);let p=this[e+--i],y=1;for(;i>0&&(y*=256);)p+=this[e+--i]*y;return p},l.prototype.readUint8=l.prototype.readUInt8=function(e,i){return e=e>>>0,i||A(e,1,this.length),this[e]},l.prototype.readUint16LE=l.prototype.readUInt16LE=function(e,i){return e=e>>>0,i||A(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUint16BE=l.prototype.readUInt16BE=function(e,i){return e=e>>>0,i||A(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUint32LE=l.prototype.readUInt32LE=function(e,i){return e=e>>>0,i||A(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+this[e+3]*16777216},l.prototype.readUint32BE=l.prototype.readUInt32BE=function(e,i){return e=e>>>0,i||A(e,4,this.length),this[e]*16777216+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readBigUInt64LE=it(function(e){e=e>>>0,lt(e,"offset");const i=this[e],a=this[e+7];(i===void 0||a===void 0)&&wt(e,this.length-8);const p=i+this[++e]*2**8+this[++e]*2**16+this[++e]*2**24,y=this[++e]+this[++e]*2**8+this[++e]*2**16+a*2**24;return BigInt(p)+(BigInt(y)<<BigInt(32))}),l.prototype.readBigUInt64BE=it(function(e){e=e>>>0,lt(e,"offset");const i=this[e],a=this[e+7];(i===void 0||a===void 0)&&wt(e,this.length-8);const p=i*2**24+this[++e]*2**16+this[++e]*2**8+this[++e],y=this[++e]*2**24+this[++e]*2**16+this[++e]*2**8+a;return(BigInt(p)<<BigInt(32))+BigInt(y)}),l.prototype.readIntLE=function(e,i,a){e=e>>>0,i=i>>>0,a||A(e,i,this.length);let p=this[e],y=1,w=0;for(;++w<i&&(y*=256);)p+=this[e+w]*y;return y*=128,p>=y&&(p-=Math.pow(2,8*i)),p},l.prototype.readIntBE=function(e,i,a){e=e>>>0,i=i>>>0,a||A(e,i,this.length);let p=i,y=1,w=this[e+--p];for(;p>0&&(y*=256);)w+=this[e+--p]*y;return y*=128,w>=y&&(w-=Math.pow(2,8*i)),w},l.prototype.readInt8=function(e,i){return e=e>>>0,i||A(e,1,this.length),this[e]&128?(255-this[e]+1)*-1:this[e]},l.prototype.readInt16LE=function(e,i){e=e>>>0,i||A(e,2,this.length);const a=this[e]|this[e+1]<<8;return a&32768?a|4294901760:a},l.prototype.readInt16BE=function(e,i){e=e>>>0,i||A(e,2,this.length);const a=this[e+1]|this[e]<<8;return a&32768?a|4294901760:a},l.prototype.readInt32LE=function(e,i){return e=e>>>0,i||A(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,i){return e=e>>>0,i||A(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readBigInt64LE=it(function(e){e=e>>>0,lt(e,"offset");const i=this[e],a=this[e+7];(i===void 0||a===void 0)&&wt(e,this.length-8);const p=this[e+4]+this[e+5]*2**8+this[e+6]*2**16+(a<<24);return(BigInt(p)<<BigInt(32))+BigInt(i+this[++e]*2**8+this[++e]*2**16+this[++e]*2**24)}),l.prototype.readBigInt64BE=it(function(e){e=e>>>0,lt(e,"offset");const i=this[e],a=this[e+7];(i===void 0||a===void 0)&&wt(e,this.length-8);const p=(i<<24)+this[++e]*2**16+this[++e]*2**8+this[++e];return(BigInt(p)<<BigInt(32))+BigInt(this[++e]*2**24+this[++e]*2**16+this[++e]*2**8+a)}),l.prototype.readFloatLE=function(e,i){return e=e>>>0,i||A(e,4,this.length),r.read(this,e,!0,23,4)},l.prototype.readFloatBE=function(e,i){return e=e>>>0,i||A(e,4,this.length),r.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,i){return e=e>>>0,i||A(e,8,this.length),r.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,i){return e=e>>>0,i||A(e,8,this.length),r.read(this,e,!1,52,8)};function O(s,e,i,a,p,y){if(!l.isBuffer(s))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>p||e<y)throw new RangeError('"value" argument is out of bounds');if(i+a>s.length)throw new RangeError("Index out of range")}l.prototype.writeUintLE=l.prototype.writeUIntLE=function(e,i,a,p){if(e=+e,i=i>>>0,a=a>>>0,!p){const S=Math.pow(2,8*a)-1;O(this,e,i,a,S,0)}let y=1,w=0;for(this[i]=e&255;++w<a&&(y*=256);)this[i+w]=e/y&255;return i+a},l.prototype.writeUintBE=l.prototype.writeUIntBE=function(e,i,a,p){if(e=+e,i=i>>>0,a=a>>>0,!p){const S=Math.pow(2,8*a)-1;O(this,e,i,a,S,0)}let y=a-1,w=1;for(this[i+y]=e&255;--y>=0&&(w*=256);)this[i+y]=e/w&255;return i+a},l.prototype.writeUint8=l.prototype.writeUInt8=function(e,i,a){return e=+e,i=i>>>0,a||O(this,e,i,1,255,0),this[i]=e&255,i+1},l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(e,i,a){return e=+e,i=i>>>0,a||O(this,e,i,2,65535,0),this[i]=e&255,this[i+1]=e>>>8,i+2},l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(e,i,a){return e=+e,i=i>>>0,a||O(this,e,i,2,65535,0),this[i]=e>>>8,this[i+1]=e&255,i+2},l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(e,i,a){return e=+e,i=i>>>0,a||O(this,e,i,4,4294967295,0),this[i+3]=e>>>24,this[i+2]=e>>>16,this[i+1]=e>>>8,this[i]=e&255,i+4},l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(e,i,a){return e=+e,i=i>>>0,a||O(this,e,i,4,4294967295,0),this[i]=e>>>24,this[i+1]=e>>>16,this[i+2]=e>>>8,this[i+3]=e&255,i+4};function dt(s,e,i,a,p){ee(e,a,p,s,i,7);let y=Number(e&BigInt(4294967295));s[i++]=y,y=y>>8,s[i++]=y,y=y>>8,s[i++]=y,y=y>>8,s[i++]=y;let w=Number(e>>BigInt(32)&BigInt(4294967295));return s[i++]=w,w=w>>8,s[i++]=w,w=w>>8,s[i++]=w,w=w>>8,s[i++]=w,i}function at(s,e,i,a,p){ee(e,a,p,s,i,7);let y=Number(e&BigInt(4294967295));s[i+7]=y,y=y>>8,s[i+6]=y,y=y>>8,s[i+5]=y,y=y>>8,s[i+4]=y;let w=Number(e>>BigInt(32)&BigInt(4294967295));return s[i+3]=w,w=w>>8,s[i+2]=w,w=w>>8,s[i+1]=w,w=w>>8,s[i]=w,i+8}l.prototype.writeBigUInt64LE=it(function(e,i=0){return dt(this,e,i,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeBigUInt64BE=it(function(e,i=0){return at(this,e,i,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeIntLE=function(e,i,a,p){if(e=+e,i=i>>>0,!p){const C=Math.pow(2,8*a-1);O(this,e,i,a,C-1,-C)}let y=0,w=1,S=0;for(this[i]=e&255;++y<a&&(w*=256);)e<0&&S===0&&this[i+y-1]!==0&&(S=1),this[i+y]=(e/w>>0)-S&255;return i+a},l.prototype.writeIntBE=function(e,i,a,p){if(e=+e,i=i>>>0,!p){const C=Math.pow(2,8*a-1);O(this,e,i,a,C-1,-C)}let y=a-1,w=1,S=0;for(this[i+y]=e&255;--y>=0&&(w*=256);)e<0&&S===0&&this[i+y+1]!==0&&(S=1),this[i+y]=(e/w>>0)-S&255;return i+a},l.prototype.writeInt8=function(e,i,a){return e=+e,i=i>>>0,a||O(this,e,i,1,127,-128),e<0&&(e=255+e+1),this[i]=e&255,i+1},l.prototype.writeInt16LE=function(e,i,a){return e=+e,i=i>>>0,a||O(this,e,i,2,32767,-32768),this[i]=e&255,this[i+1]=e>>>8,i+2},l.prototype.writeInt16BE=function(e,i,a){return e=+e,i=i>>>0,a||O(this,e,i,2,32767,-32768),this[i]=e>>>8,this[i+1]=e&255,i+2},l.prototype.writeInt32LE=function(e,i,a){return e=+e,i=i>>>0,a||O(this,e,i,4,2147483647,-2147483648),this[i]=e&255,this[i+1]=e>>>8,this[i+2]=e>>>16,this[i+3]=e>>>24,i+4},l.prototype.writeInt32BE=function(e,i,a){return e=+e,i=i>>>0,a||O(this,e,i,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[i]=e>>>24,this[i+1]=e>>>16,this[i+2]=e>>>8,this[i+3]=e&255,i+4},l.prototype.writeBigInt64LE=it(function(e,i=0){return dt(this,e,i,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),l.prototype.writeBigInt64BE=it(function(e,i=0){return at(this,e,i,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function ht(s,e,i,a,p,y){if(i+a>s.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function tt(s,e,i,a,p){return e=+e,i=i>>>0,p||ht(s,e,i,4),r.write(s,e,i,a,23,4),i+4}l.prototype.writeFloatLE=function(e,i,a){return tt(this,e,i,!0,a)},l.prototype.writeFloatBE=function(e,i,a){return tt(this,e,i,!1,a)};function yt(s,e,i,a,p){return e=+e,i=i>>>0,p||ht(s,e,i,8),r.write(s,e,i,a,52,8),i+8}l.prototype.writeDoubleLE=function(e,i,a){return yt(this,e,i,!0,a)},l.prototype.writeDoubleBE=function(e,i,a){return yt(this,e,i,!1,a)},l.prototype.copy=function(e,i,a,p){if(!l.isBuffer(e))throw new TypeError("argument should be a Buffer");if(a||(a=0),!p&&p!==0&&(p=this.length),i>=e.length&&(i=e.length),i||(i=0),p>0&&p<a&&(p=a),p===a||e.length===0||this.length===0)return 0;if(i<0)throw new RangeError("targetStart out of bounds");if(a<0||a>=this.length)throw new RangeError("Index out of range");if(p<0)throw new RangeError("sourceEnd out of bounds");p>this.length&&(p=this.length),e.length-i<p-a&&(p=e.length-i+a);const y=p-a;return this===e&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(i,a,p):Uint8Array.prototype.set.call(e,this.subarray(a,p),i),y},l.prototype.fill=function(e,i,a,p){if(typeof e=="string"){if(typeof i=="string"?(p=i,i=0,a=this.length):typeof a=="string"&&(p=a,a=this.length),p!==void 0&&typeof p!="string")throw new TypeError("encoding must be a string");if(typeof p=="string"&&!l.isEncoding(p))throw new TypeError("Unknown encoding: "+p);if(e.length===1){const w=e.charCodeAt(0);(p==="utf8"&&w<128||p==="latin1")&&(e=w)}}else typeof e=="number"?e=e&255:typeof e=="boolean"&&(e=Number(e));if(i<0||this.length<i||this.length<a)throw new RangeError("Out of range index");if(a<=i)return this;i=i>>>0,a=a===void 0?this.length:a>>>0,e||(e=0);let y;if(typeof e=="number")for(y=i;y<a;++y)this[y]=e;else{const w=l.isBuffer(e)?e:l.from(e,p),S=w.length;if(S===0)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(y=0;y<a-i;++y)this[y+i]=w[y%S]}return this};const et={};function Lt(s,e,i){et[s]=class extends i{constructor(){super(),Object.defineProperty(this,"message",{value:e.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${s}]`,this.stack,delete this.name}get code(){return s}set code(p){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:p,writable:!0})}toString(){return`${this.name} [${s}]: ${this.message}`}}}Lt("ERR_BUFFER_OUT_OF_BOUNDS",function(s){return s?`${s} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Lt("ERR_INVALID_ARG_TYPE",function(s,e){return`The "${s}" argument must be of type number. Received type ${typeof e}`},TypeError),Lt("ERR_OUT_OF_RANGE",function(s,e,i){let a=`The value of "${s}" is out of range.`,p=i;return Number.isInteger(i)&&Math.abs(i)>2**32?p=te(String(i)):typeof i=="bigint"&&(p=String(i),(i>BigInt(2)**BigInt(32)||i<-(BigInt(2)**BigInt(32)))&&(p=te(p)),p+="n"),a+=` It must be ${e}. Received ${p}`,a},RangeError);function te(s){let e="",i=s.length;const a=s[0]==="-"?1:0;for(;i>=a+4;i-=3)e=`_${s.slice(i-3,i)}${e}`;return`${s.slice(0,i)}${e}`}function Ce(s,e,i){lt(e,"offset"),(s[e]===void 0||s[e+i]===void 0)&&wt(e,s.length-(i+1))}function ee(s,e,i,a,p,y){if(s>i||s<e){const w=typeof e=="bigint"?"n":"";let S;throw e===0||e===BigInt(0)?S=`>= 0${w} and < 2${w} ** ${(y+1)*8}${w}`:S=`>= -(2${w} ** ${(y+1)*8-1}${w}) and < 2 ** ${(y+1)*8-1}${w}`,new et.ERR_OUT_OF_RANGE("value",S,s)}Ce(a,p,y)}function lt(s,e){if(typeof s!="number")throw new et.ERR_INVALID_ARG_TYPE(e,"number",s)}function wt(s,e,i){throw Math.floor(s)!==s?(lt(s,i),new et.ERR_OUT_OF_RANGE("offset","an integer",s)):e<0?new et.ERR_BUFFER_OUT_OF_BOUNDS:new et.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${e}`,s)}const Pe=/[^+/0-9A-Za-z-_]/g;function Le(s){if(s=s.split("=")[0],s=s.trim().replace(Pe,""),s.length<2)return"";for(;s.length%4!==0;)s=s+"=";return s}function Ft(s,e){e=e||1/0;let i;const a=s.length;let p=null;const y=[];for(let w=0;w<a;++w){if(i=s.charCodeAt(w),i>55295&&i<57344){if(!p){if(i>56319){(e-=3)>-1&&y.push(239,191,189);continue}else if(w+1===a){(e-=3)>-1&&y.push(239,191,189);continue}p=i;continue}if(i<56320){(e-=3)>-1&&y.push(239,191,189),p=i;continue}i=(p-55296<<10|i-56320)+65536}else p&&(e-=3)>-1&&y.push(239,191,189);if(p=null,i<128){if((e-=1)<0)break;y.push(i)}else if(i<2048){if((e-=2)<0)break;y.push(i>>6|192,i&63|128)}else if(i<65536){if((e-=3)<0)break;y.push(i>>12|224,i>>6&63|128,i&63|128)}else if(i<1114112){if((e-=4)<0)break;y.push(i>>18|240,i>>12&63|128,i>>6&63|128,i&63|128)}else throw new Error("Invalid code point")}return y}function Fe(s){const e=[];for(let i=0;i<s.length;++i)e.push(s.charCodeAt(i)&255);return e}function De(s,e){let i,a,p;const y=[];for(let w=0;w<s.length&&!((e-=2)<0);++w)i=s.charCodeAt(w),a=i>>8,p=i%256,y.push(p),y.push(a);return y}function ie(s){return t.toByteArray(Le(s))}function Mt(s,e,i,a){let p;for(p=0;p<a&&!(p+i>=e.length||p>=s.length);++p)e[p+i]=s[p];return p}function J(s,e){return s instanceof e||s!=null&&s.constructor!=null&&s.constructor.name!=null&&s.constructor.name===e.name}function Dt(s){return s!==s}const Ue=function(){const s="0123456789abcdef",e=new Array(256);for(let i=0;i<16;++i){const a=i*16;for(let p=0;p<16;++p)e[a+p]=s[i]+s[p]}return e}();function it(s){return typeof BigInt>"u"?Oe:s}function Oe(){throw new Error("BigInt not supported")}})(Jt);function gi(h){if(typeof h!="string")throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!h)throw new Error("No input");const t=JSON.parse(h),r=t;let n;if(r.type==="system")if(r.event==="connected")n=Object.assign(Object.assign({},t),{kind:"connected"});else if(r.event==="disconnected")n=Object.assign(Object.assign({},t),{kind:"disconnected"});else return null;else if(r.type==="message")if(r.from==="group"){const o=de(t.data,t.dataType);if(o===null)return null;n=Object.assign(Object.assign({},t),{data:o,kind:"groupData"})}else if(r.from==="server"){const o=de(t.data,t.dataType);if(o===null)return null;n=Object.assign(Object.assign({},t),{data:o,kind:"serverData"})}else return null;else if(r.type==="ack")n=Object.assign(Object.assign({},t),{kind:"ack"});else return null;return n}function bi(h){let t;switch(h.kind){case"joinGroup":{t={type:"joinGroup",group:h.group,ackId:h.ackId};break}case"leaveGroup":{t={type:"leaveGroup",group:h.group,ackId:h.ackId};break}case"sendEvent":{t={type:"event",event:h.event,ackId:h.ackId,dataType:h.dataType,data:pe(h.data,h.dataType)};break}case"sendToGroup":{t={type:"sendToGroup",group:h.group,ackId:h.ackId,dataType:h.dataType,data:pe(h.data,h.dataType),noEcho:h.noEcho};break}case"sequenceAck":{t={type:"sequenceAck",sequenceId:h.sequenceId};break}default:throw new Error(`Unsupported type: ${h.kind}`)}return JSON.stringify(t)}function pe(h,t){switch(t){case"text":{if(typeof h!="string")throw new TypeError("Message must be a string.");return h}case"json":return h;case"binary":case"protobuf":{if(h instanceof ArrayBuffer)return Jt.Buffer.from(h).toString("base64");throw new TypeError("Message must be a ArrayBuffer")}}}function de(h,t){if(t==="text"){if(typeof h!="string")throw new TypeError("Message must be a string when dataType is text");return h}else{if(t==="json")return h;if(t==="binary"||t==="protobuf"){const r=Jt.Buffer.from(h,"base64");return r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)}else return null}}class xi{constructor(){this.isReliableSubProtocol=!0,this.name="json.reliable.webpubsub.azure.v1"}parseMessages(t){return gi(t)}writeMessage(t){return bi(t)}}const vi=()=>new xi;class _i{constructor(t,r){this._socket=new WebSocket(t,r),this._socket.binaryType="arraybuffer"}onopen(t){this._socket.onopen=t}onclose(t){this._socket.onclose=r=>t(r.code,r.reason)}onerror(t){this._socket.onerror=r=>t(r)}onmessage(t){this._socket.onmessage=r=>t(r.data)}close(t,r){this._socket.close(t,r)}send(t,r){return new Promise((n,o)=>{try{this._socket.send(t),n()}catch(c){o(c)}})}isOpen(){return this._socket.readyState===WebSocket.OPEN}}class Ei{create(t,r){return new _i(t,r)}}async function Si(h,t){if(t.aborted)throw new Gt("The operation was aborted.");let r;const n=new Promise((o,c)=>{r=()=>{c(new Gt("The operation was aborted."))},t.addEventListener("abort",r)});try{return await Promise.race([h,n])}finally{t.removeEventListener("abort",r)}}var V;(function(h){h.Stopped="Stopped",h.Disconnected="Disconnected",h.Connecting="Connecting",h.Connected="Connected",h.Recovering="Recovering"})(V||(V={}));class Mi{nextAckId(){return this._ackId=this._ackId+1,this._ackId}constructor(t,r){this._quickSequenceAckDiff=300,this._activeTimeoutInMs=2e4,this._emitter=new ri,this._isStopping=!1,this._isInitialConnected=!1,typeof t=="string"?this._credential={getClientAccessUrl:t}:this._credential=t,r==null&&(r={}),this._buildDefaultOptions(r),this._options=r,this._messageRetryPolicy=new ye(this._options.messageRetryOptions),this._reconnectRetryPolicy=new ye(this._options.reconnectRetryOptions),this._protocol=this._options.protocol,this._groupMap=new Map,this._ackMap=new Map,this._sequenceId=new Ri,this._state=V.Stopped,this._ackId=0}async start(t){if(this._isStopping)throw new Error("Can't start a client during stopping");if(this._state!==V.Stopped)throw new Error("Client can be only started when it's Stopped");let r;t&&(r=t.abortSignal),this._activeKeepaliveTask||(this._activeKeepaliveTask=this._getActiveKeepaliveTask());try{await this._startCore(r)}catch(n){throw this._changeState(V.Stopped),this._activeKeepaliveTask&&(this._activeKeepaliveTask.abort(),this._activeKeepaliveTask=void 0),this._isStopping=!1,n}}async _startFromRestarting(t){if(this._state!==V.Disconnected)throw new Error("Client can be only restarted when it's Disconnected");try{j.verbose("Staring reconnecting."),await this._startCore(t)}catch(r){throw this._changeState(V.Disconnected),r}}async _startCore(t){if(this._changeState(V.Connecting),j.info("Staring a new connection"),this._sequenceId.reset(),this._isInitialConnected=!1,this._lastCloseEvent=void 0,this._lastDisconnectedMessage=void 0,this._connectionId=void 0,this._reconnectionToken=void 0,this._uri=void 0,typeof this._credential.getClientAccessUrl=="string"?this._uri=this._credential.getClientAccessUrl:this._uri=await this._credential.getClientAccessUrl({abortSignal:t}),typeof this._uri!="string")throw new Error(`The clientAccessUrl must be a string but currently it's ${typeof this._uri}`);await this._connectCore(this._uri)}stop(){this._state===V.Stopped||this._isStopping||(this._isStopping=!0,this._wsClient&&this._wsClient.isOpen()?this._wsClient.close():this._isStopping=!1,this._activeKeepaliveTask&&(this._activeKeepaliveTask.abort(),this._activeKeepaliveTask=void 0))}on(t,r){this._emitter.on(t,r)}off(t,r){this._emitter.removeListener(t,r)}_emitEvent(t,r){this._emitter.emit(t,r)}async sendEvent(t,r,n,o){return this._operationExecuteWithRetry(()=>this._sendEventAttempt(t,r,n,o),o==null?void 0:o.abortSignal)}async _sendEventAttempt(t,r,n,o){var c;if(!((c=o==null?void 0:o.fireAndForget)!==null&&c!==void 0?c:!1))return this._sendMessageWithAckId(d=>({kind:"sendEvent",dataType:n,data:r,ackId:d,event:t}),o==null?void 0:o.ackId,o==null?void 0:o.abortSignal);const l={kind:"sendEvent",dataType:n,data:r,event:t};return await this._sendMessage(l,o==null?void 0:o.abortSignal),{isDuplicated:!1}}async joinGroup(t,r){return this._operationExecuteWithRetry(()=>this._joinGroupAttempt(t,r),r==null?void 0:r.abortSignal)}async _joinGroupAttempt(t,r){const n=this._getOrAddGroup(t),o=await this._joinGroupCore(t,r);return n.isJoined=!0,o}async _joinGroupCore(t,r){return this._sendMessageWithAckId(n=>({group:t,ackId:n,kind:"joinGroup"}),r==null?void 0:r.ackId,r==null?void 0:r.abortSignal)}async leaveGroup(t,r){return this._operationExecuteWithRetry(()=>this._leaveGroupAttempt(t,r),r==null?void 0:r.abortSignal)}async _leaveGroupAttempt(t,r){const n=this._getOrAddGroup(t),o=await this._sendMessageWithAckId(c=>({group:t,ackId:c,kind:"leaveGroup"}),r==null?void 0:r.ackId,r==null?void 0:r.abortSignal);return n.isJoined=!1,o}async sendToGroup(t,r,n,o){return this._operationExecuteWithRetry(()=>this._sendToGroupAttempt(t,r,n,o),o==null?void 0:o.abortSignal)}async _sendToGroupAttempt(t,r,n,o){var c,u;const l=(c=o==null?void 0:o.fireAndForget)!==null&&c!==void 0?c:!1,d=(u=o==null?void 0:o.noEcho)!==null&&u!==void 0?u:!1;if(!l)return this._sendMessageWithAckId(m=>({kind:"sendToGroup",group:t,dataType:n,data:r,ackId:m,noEcho:d}),o==null?void 0:o.ackId,o==null?void 0:o.abortSignal);const x={kind:"sendToGroup",group:t,dataType:n,data:r,noEcho:d};return await this._sendMessage(x,o==null?void 0:o.abortSignal),{isDuplicated:!1}}_getWebSocketClientFactory(){return new Ei}async _trySendSequenceAck(){if(!this._protocol.isReliableSubProtocol)return;const[t,r]=this._sequenceId.tryGetSequenceId();if(t&&r!==null&&r!==void 0){const n={kind:"sequenceAck",sequenceId:r};try{await this._sendMessage(n)}catch{this._sequenceId.tryUpdate(r)}}}_connectCore(t){if(this._isStopping)throw new Error("Can't start a client during stopping");return new Promise((r,n)=>{const o=this._wsClient=this._getWebSocketClientFactory().create(t,this._protocol.name);o.onopen(()=>{if(this._isStopping){try{o.close()}catch{}n(new Error("The client is stopped"))}j.verbose("WebSocket connection has opened"),this._changeState(V.Connected),this._protocol.isReliableSubProtocol&&(this._sequenceAckTask!=null&&this._sequenceAckTask.abort(),this._sequenceAckTask=new we(async()=>{await this._trySendSequenceAck()},1e3)),r()}),o.onerror(c=>{this._sequenceAckTask!=null&&this._sequenceAckTask.abort(),n(c)}),o.onclose((c,u)=>{this._state===V.Connected?(j.verbose("WebSocket closed after open"),this._sequenceAckTask!=null&&this._sequenceAckTask.abort(),j.info(`WebSocket connection closed. Code: ${c}, Reason: ${u}`),this._lastCloseEvent={code:c,reason:u},this._handleConnectionClose.call(this)):(j.verbose("WebSocket closed before open"),n(new Error(`Failed to start WebSocket: ${c}`)))}),o.onmessage(c=>{const u=f=>{if(this._ackMap.has(f.ackId)){const g=this._ackMap.get(f.ackId);this._ackMap.delete(f.ackId);const _=f.error!=null&&f.error.name==="Duplicate";f.success||_?g.resolve({ackId:f.ackId,isDuplicated:_}):g.reject(new Tt("Failed to send message.",{ackId:f.ackId,errorDetail:f.error}))}},l=async f=>{if(this._connectionId=f.connectionId,this._reconnectionToken=f.reconnectionToken,!this._isInitialConnected){if(this._isInitialConnected=!0,this._options.autoRejoinGroups){const g=[];this._groupMap.forEach(_=>{_.isJoined&&g.push((async()=>{try{await this._joinGroupCore(_.name)}catch(v){this._safeEmitRejoinGroupFailed(_.name,v)}})())}),await Promise.all(g).catch(()=>{})}this._safeEmitConnected(f.connectionId,f.userId)}},d=f=>{this._lastDisconnectedMessage=f},x=f=>{if(f.sequenceId!=null){const g=this._sequenceId.tryUpdate(f.sequenceId);if(g===0)return;g>this._quickSequenceAckDiff&&this._trySendSequenceAck()}this._safeEmitGroupMessage(f)},m=f=>{if(f.sequenceId!=null){const g=this._sequenceId.tryUpdate(f.sequenceId);if(g===0)return;g>this._quickSequenceAckDiff&&this._trySendSequenceAck()}this._safeEmitServerMessage(f)};let b;try{let f;if(Array.isArray(c)?f=Buffer.concat(c):f=c,b=this._protocol.parseMessages(f),b===null)return}catch(f){throw j.warning("An error occurred while parsing the message from service",f),f}Array.isArray(b)||(b=[b]),b.forEach(f=>{try{switch(f.kind){case"ack":{u(f);break}case"connected":{l(f);break}case"disconnected":{d(f);break}case"groupData":{x(f);break}case"serverData":{m(f);break}}}catch(g){j.warning(`An error occurred while handling the message with kind: ${f.kind} from service`,g)}})})})}async _handleConnectionCloseAndNoRecovery(){this._state=V.Disconnected,this._safeEmitDisconnected(this._connectionId,this._lastDisconnectedMessage),this._options.autoReconnect?await this._autoReconnect():await this._handleConnectionStopped()}async _autoReconnect(){let t=!1,r=0;try{for(;!this._isStopping;)try{await this._startFromRestarting(),t=!0;break}catch(n){j.warning("An attempt to reconnect connection failed.",n),r++;const o=this._reconnectRetryPolicy.nextRetryDelayInMs(r);if(o==null)break;j.verbose(`Delay time for reconnect attempt ${r}: ${o}`),await It(o).catch(()=>{})}}finally{t||this._handleConnectionStopped()}}_handleConnectionStopped(){this._isStopping=!1,this._state=V.Stopped,this._safeEmitStopped()}_getActiveKeepaliveTask(){return new we(async()=>{this._sequenceId.tryUpdate(0)},this._activeTimeoutInMs)}async _sendMessage(t,r){if(!this._wsClient||!this._wsClient.isOpen())throw new Error("The connection is not connected.");const n=this._protocol.writeMessage(t);await this._wsClient.send(n,r)}async _sendMessageWithAckId(t,r,n){r==null&&(r=this.nextAckId());const o=t(r);this._ackMap.has(r)||this._ackMap.set(r,new Ii(r));const c=this._ackMap.get(r);try{await this._sendMessage(o,n)}catch(u){this._ackMap.delete(r);let l="";throw u instanceof Error&&(l=u.message),new Tt(l,{ackId:r})}if(n)try{return await Si(c.promise(),n)}catch(u){throw u instanceof Error&&u.name==="AbortError"?new Tt("Cancelled by abortSignal",{ackId:r}):u}return c.promise()}async _handleConnectionClose(){if(this._ackMap.forEach((o,c)=>{this._ackMap.delete(c)&&o.reject(new Tt("Connection is disconnected before receive ack from the service",{ackId:o.ackId}))}),this._isStopping){j.warning("The client is stopping state. Stop recovery."),this._handleConnectionCloseAndNoRecovery();return}if(this._lastCloseEvent&&this._lastCloseEvent.code===1008){j.warning("The websocket close with status code 1008. Stop recovery."),this._handleConnectionCloseAndNoRecovery();return}if(!this._protocol.isReliableSubProtocol){j.warning("The protocol is not reliable, recovery is not applicable"),this._handleConnectionCloseAndNoRecovery();return}const t=this._buildRecoveryUri();if(!t){j.warning("Connection id or reconnection token is not available"),this._handleConnectionCloseAndNoRecovery();return}let r=!1;this._state=V.Recovering;const n=AbortSignal.timeout(30*1e3);try{for(;!n.aborted||this._isStopping;)try{await this._connectCore.call(this,t),r=!0;return}catch{await It(1e3)}}finally{r||(j.warning("Recovery attempts failed more then 30 seconds or the client is stopping"),this._handleConnectionCloseAndNoRecovery())}}_safeEmitConnected(t,r){this._emitEvent("connected",{connectionId:t,userId:r})}_safeEmitDisconnected(t,r){this._emitEvent("disconnected",{connectionId:t,message:r})}_safeEmitGroupMessage(t){this._emitEvent("group-message",{message:t})}_safeEmitServerMessage(t){this._emitEvent("server-message",{message:t})}_safeEmitStopped(){this._emitEvent("stopped",{})}_safeEmitRejoinGroupFailed(t,r){this._emitEvent("rejoin-group-failed",{group:t,error:r})}_buildDefaultOptions(t){return t.autoReconnect==null&&(t.autoReconnect=!0),t.autoRejoinGroups==null&&(t.autoRejoinGroups=!0),t.protocol==null&&(t.protocol=vi()),this._buildMessageRetryOptions(t),this._buildReconnectRetryOptions(t),t}_buildMessageRetryOptions(t){t.messageRetryOptions||(t.messageRetryOptions={}),(t.messageRetryOptions.maxRetries==null||t.messageRetryOptions.maxRetries<0)&&(t.messageRetryOptions.maxRetries=3),(t.messageRetryOptions.retryDelayInMs==null||t.messageRetryOptions.retryDelayInMs<0)&&(t.messageRetryOptions.retryDelayInMs=1e3),(t.messageRetryOptions.maxRetryDelayInMs==null||t.messageRetryOptions.maxRetryDelayInMs<0)&&(t.messageRetryOptions.maxRetryDelayInMs=3e4),t.messageRetryOptions.mode==null&&(t.messageRetryOptions.mode="Fixed")}_buildReconnectRetryOptions(t){t.reconnectRetryOptions||(t.reconnectRetryOptions={}),(t.reconnectRetryOptions.maxRetries==null||t.reconnectRetryOptions.maxRetries<0)&&(t.reconnectRetryOptions.maxRetries=Number.MAX_VALUE),(t.reconnectRetryOptions.retryDelayInMs==null||t.reconnectRetryOptions.retryDelayInMs<0)&&(t.reconnectRetryOptions.retryDelayInMs=1e3),(t.reconnectRetryOptions.maxRetryDelayInMs==null||t.reconnectRetryOptions.maxRetryDelayInMs<0)&&(t.reconnectRetryOptions.maxRetryDelayInMs=3e4),t.reconnectRetryOptions.mode==null&&(t.reconnectRetryOptions.mode="Fixed")}_buildRecoveryUri(){if(this._connectionId&&this._reconnectionToken&&this._uri){const t=new URL(this._uri);return t.searchParams.append("awps_connection_id",this._connectionId),t.searchParams.append("awps_reconnection_token",this._reconnectionToken),t.toString()}return null}_getOrAddGroup(t){return this._groupMap.has(t)||this._groupMap.set(t,new Ti(t)),this._groupMap.get(t)}_changeState(t){j.verbose(`The client state transfer from ${this._state.toString()} to ${t.toString()}`),this._state=t}async _operationExecuteWithRetry(t,r){let n=0;for(;;)try{return await t.call(this)}catch(o){n++;const c=this._messageRetryPolicy.nextRetryDelayInMs(n);if(c==null||(await It(c),r!=null&&r.aborted))throw o}}}class ye{constructor(t){this._retryOptions=t,this._maxRetriesToGetMaxDelay=Math.ceil(Math.log2(this._retryOptions.maxRetryDelayInMs)-Math.log2(this._retryOptions.retryDelayInMs)+1)}nextRetryDelayInMs(t){return t>this._retryOptions.maxRetries?null:this._retryOptions.mode==="Fixed"?this._retryOptions.retryDelayInMs:this._calculateExponentialDelay(t)}_calculateExponentialDelay(t){return t>=this._maxRetriesToGetMaxDelay?this._retryOptions.maxRetryDelayInMs:(1<<t-1)*this._retryOptions.retryDelayInMs}}class Ti{constructor(t){this.isJoined=!1,this.name=t}}class Ii{constructor(t){this._promise=new Promise((r,n)=>{this._resolve=r,this._reject=n}),this.ackId=t}promise(){return this._promise}resolve(t){this._resolve(t)}reject(t){this._reject(t)}}class Ri{constructor(){this._sequenceId=0,this._isUpdate=!1}tryUpdate(t){if(this._isUpdate=!0,t>this._sequenceId){const r=t-this._sequenceId;return this._sequenceId=t,r}return 0}tryGetSequenceId(){return this._isUpdate?(this._isUpdate=!1,[!0,this._sequenceId]):[!1,null]}reset(){this._sequenceId=0,this._isUpdate=!1}}class we{constructor(t,r,n){this._func=t,this._abortController=new AbortController,this._interval=r,this._obj=n,this._start()}abort(){try{this._abortController.abort()}catch{}}async _start(){const t=this._abortController.signal;for(;!t.aborted;)try{await this._func(this._obj)}catch{}finally{await It(this._interval)}}}class Ai{constructor(t){this.negotiateUrl=t,this.client=null,this.group=null,this.connected=!1}async connect(t){const r=await fetch(this.negotiateUrl,{credentials:"include"});if(!r.ok)throw new Error("negotiate failed");const{url:n}=await r.json(),o=new Mi(n);this.client=o,this.group=`room:${t}`,await o.start(),await o.joinGroup(this.group),this.connected=!0}onMessage(t){var r;(r=this.client)==null||r.on("group-message",({message:n})=>{try{t(JSON.parse(String(n.data)))}catch{}})}async send(t){!this.client||!this.connected||!this.group||await this.client.sendToGroup(this.group,JSON.stringify(t),"text")}}class Kt{constructor(t,r){this.p1=new vt(80,140,26,26),this.p2=new vt(120,220,26,26),this.obstacles=[],this.hud=new Vt,this.s1=0,this.s2=0,this.speed=140,this.timeToNext=0,this.paused=!1,this.rt=null,this.roomId=t,this.name=r}async init(t){this.renderer=new Yt(t.canvas,t.ctx);const r="/api/negotiate";this.rt=new Ai(r),await this.rt.connect(this.roomId),this.rt.onMessage(n=>{n.type==="state"&&(this.p2.x=n.x,this.p2.y=n.y,this.p2.vy=n.vy,this.s2=n.score)})}update(t,r){if(this.paused)return;(r.input.wasPressed("Space")||r.input.wasPressed("ArrowUp"))&&(G.jump(this.p1),U.flap());const n=r.input.getMovementDirection();if(this.p1.vx=n.x*80,G.applyGravity(this.p1,t),this.p1.update(t),this.rt){const o={type:"state",t:performance.now(),x:this.p1.x,y:this.p1.y,vy:this.p1.vy,score:this.s1,hp:this.p1.hp};this.rt.send(o)}}render(t,r){this.renderer.clear(1/60),this.renderer.drawPlayer(this.p1,"#58a6ff"),this.renderer.drawPlayer(this.p2,"#ff7b72"),this.hud.render(t,this.s1,this.s2)}}class ki{constructor(){this.t=0,this.btnS=null,this.btnV=null,this.btnVO=null,this.btnEditName=null}onResize(t){t.ctx.setTransform(1,0,0,1,0,0)}init(t){t.canvas.focus();let r=!1;const n=()=>{t.canvas.onpointerdown=null,t.canvas.ontouchstart=null,t.canvas.onclick=null,document.removeEventListener("touchstart",x),document.removeEventListener("pointerdown",d),document.removeEventListener("click",m)},o=(b,f=!1)=>{if(!r)if(r=!0,n(),b&&f){const g=z.getPlayerName()||"Anon",_=typeof window<"u"&&window.prompt("Your name",g)||g;z.setPlayerName(_);const v=Math.random().toString(36).slice(2,6),E=typeof window<"u"&&window.prompt("Room code (share with friend)",v)||v;t.setScene(new Kt(E,_))}else t.setScene(b?new jt:new _t)},c=b=>{if(this.btnS||this.btnV||this.btnEditName){const f=t.canvas.getBoundingClientRect(),g=t.canvas.width/f.width,_=t.canvas.height/f.height,v=(b.clientX-f.left)*g,E=(b.clientY-f.top)*_;if(this.btnS&&v>=this.btnS.x&&v<=this.btnS.x+this.btnS.w&&E>=this.btnS.y&&E<=this.btnS.y+this.btnS.h)return o(!1);if(this.btnV&&v>=this.btnV.x&&v<=this.btnV.x+this.btnV.w&&E>=this.btnV.y&&E<=this.btnV.y+this.btnV.h)return o(!0);if(this.btnVO&&v>=this.btnVO.x&&v<=this.btnVO.x+this.btnVO.w&&E>=this.btnVO.y&&E<=this.btnVO.y+this.btnVO.h)return o(!0,!0);if(this.btnEditName&&v>=this.btnEditName.x&&v<=this.btnEditName.x+this.btnEditName.w&&E>=this.btnEditName.y&&E<=this.btnEditName.y+this.btnEditName.h){try{const M=z.getPlayerName()||"Anon",T=typeof window<"u"?window.prompt("Your name",M):null;T!=null&&z.setPlayerName(T)}catch{}return}}o(!1)},u=b=>{var g;const f=((g=b.touches)==null?void 0:g.length)??0;o(f>=2)},l=b=>o(!1),d=b=>o(!1),x=b=>{var g;const f=((g=b.touches)==null?void 0:g.length)??0;o(f>=2)},m=b=>o(!1);t.canvas.onpointerdown=c,t.canvas.ontouchstart=u,t.canvas.onclick=l,document.addEventListener("pointerdown",d,{passive:!0}),document.addEventListener("touchstart",x,{passive:!0}),document.addEventListener("click",m,{passive:!0})}update(t,r){if(this.t+=t,r.input.wasPressed("KeyS")&&r.setScene(new _t),r.input.wasPressed("KeyV")&&r.setScene(new jt),r.input.wasPressed("KeyO")){const F=z.getPlayerName()||"Anon",q=typeof window<"u"&&window.prompt("Your name",F)||F;z.setPlayerName(q);const K=Math.random().toString(36).slice(2,6),A=typeof window<"u"&&window.prompt("Room code (share with friend)",K)||K;r.setScene(new Kt(A,q))}r.input.wasPressed("KeyM")&&(U.muted=!U.muted),r.input.wasPressed("KeyR")&&H.toggleReducedMotion(),r.input.wasPressed("KeyC")&&z.clear();const{ctx:n}=r,o=r.canvas.width,c=r.canvas.height,u=n.createLinearGradient(0,0,0,c);u.addColorStop(0,"#0b1023"),u.addColorStop(1,"#1a2247"),n.fillStyle=u,n.fillRect(0,0,o,c),n.save(),n.globalAlpha=.2;for(let F=0;F<60;F++){const q=F*91%o,K=F*53%c;n.fillStyle=F%2?"#d0e0ff":"#a0b8ff",n.fillRect(q,K+(Math.sin(this.t+F)*2+2)|0,2,2)}n.restore();const l=Math.sin(this.t*2)*6;n.fillStyle="#e8e8f0",n.textBaseline="top";const d="Crappy Bird Extreme";n.font="800 64px system-ui, ui-sans-serif, -apple-system, Segoe UI";const x=n.measureText(d).width,m=Math.max(24,(o-x)/2),b=60+l;n.fillText(d,m,b),n.strokeStyle="#58a6ff",n.lineWidth=6,n.beginPath(),n.moveTo(m,b+64+8),n.lineTo(m+Math.min(520,x*.6),b+64+8),n.stroke(),n.font="700 20px system-ui",n.fillStyle="#94a3b8",n.fillText("yoloswag edition",m+4,b+64+28);const f=Math.min(560,o-64),g=170,_=(o-f)/2;n.fillStyle="#0f172acc",n.beginPath(),n.roundRect(_,g,f,150,14),n.fill(),n.fillStyle="#cdd9e5",n.font="700 22px system-ui",n.fillText("Play",_+16,g+16);const v=180,E=44,M=18,T=_+16,k=g+56,L=(F,q,K)=>{n.fillStyle="#15223f",n.strokeStyle="#58a6ff88",n.lineWidth=3,n.beginPath(),n.roundRect(F,q,v,E,10),n.fill(),n.stroke(),n.fillStyle="#e8e8f0",n.font="600 18px system-ui",n.fillText(K,F+14,q+28)};L(T,k,"S — Singleplayer"),L(T+v+M,k,"V — Versus (Local)"),L(T+(v+M)*2,k,"O — Versus (Online)"),this.btnS={x:T,y:k,w:v,h:E},this.btnV={x:T+v+M,y:k,w:v,h:E},this.btnVO={x:T+(v+M)*2,y:k,w:v,h:E};const D=g+170,$=Math.min(760,o-64),N=(o-$)/2;n.fillStyle="#0f172acc",n.beginPath(),n.roundRect(N,D,$,160,14),n.fill(),n.fillStyle="#cdd9e5",n.font="700 20px system-ui",n.fillText("Controls",N+16,D+16),n.font="500 16px system-ui";let W=D+46;n.fillText("Singleplayer: Flap = Space/ArrowUp/W or Click/Tap • Move = ArrowLeft/Right or A/D • Shoot = Right Click or Ctrl/J (hold)",N+16,W),W+=28,n.fillText("Versus (Local): P1 = Arrows + Space • P2 = W (flap), S (nudge down)",N+16,W),W+=28,n.fillText(`Online: O — enter room code and share it • Mute = M (${U.muted?"Muted":"Sound on"}) • Reduced motion = R (${H.reducedMotion?"On":"Off"}) • Esc returns here`,N+16,W);const X=D+170,st=Math.min(760,o-64),rt=(o-st)/2;n.fillStyle="#0f172acc",n.beginPath(),n.roundRect(rt,X,st,130,14),n.fill(),n.fillStyle="#cdd9e5",n.font="700 20px system-ui",n.fillText("Power-ups",rt+16,X+16),n.font="500 14px system-ui";let Q=X+44;const ot=[["+ Heal","gain 1 heart"],["R Rapid","shorter cooldown"],["S Shield","+1 max heart and heal"],["M Multishot","fires 3 bullets"],["B Bigshot","bigger bullets, +1 dmg"],["⌛ Slowmo","world slows briefly"],["U Magnet","pulls pickups nearby"]];for(const[F,q]of ot)n.fillText(`${F} — ${q}`,rt+16,Q),Q+=20;const nt=z.getTop(5);if(nt.length){const F=Math.min(420,o-40),q=28+nt.length*22+20,K=(o-F)/2,A=c-q-80;n.fillStyle="#0f172acc",n.beginPath(),n.roundRect(K,A,F,q,10),n.fill(),n.fillStyle="#cdd9e5",n.font="700 16px system-ui",n.fillText("Top Scores",K+12,A+20),n.font="500 14px system-ui";for(let tt=0;tt<nt.length;tt++){const yt=nt[tt],et=`${tt+1}. ${(yt.name||"Anon").slice(0,18)} — ${yt.score}`;n.fillText(et,K+12,A+44+tt*22)}n.font="400 12px system-ui",n.fillStyle="#94a3b8",n.fillText("Press C to clear • Name is saved locally",K+12,A+q-10);const O=92,dt=22,at=K+F-O-10,ht=A+10;n.fillStyle="#15223f",n.strokeStyle="#58a6ff88",n.lineWidth=2,n.beginPath(),n.roundRect(at,ht,O,dt,6),n.fill(),n.stroke(),n.fillStyle="#e8e8f0",n.font="600 12px system-ui",n.fillText("Edit name",at+12,ht+15),this.btnEditName={x:at,y:ht,w:O,h:dt}}const Et=.5+.5*Math.sin(this.t*3);n.save(),n.globalAlpha=.6+.4*Et,n.fillStyle="#58a6ff",n.font="700 18px system-ui";const St="Tap to start • Starts easy: wider gaps, slower pipes; difficulty ramps up. Two-finger tap for Versus (S/V)",Pt=n.measureText(St).width;n.fillText(St,Math.max(20,(o-Pt)/2),c-60),n.restore()}render(){}}const Qt=document.getElementById("gameCanvas");Qt.style.width="100vw";Qt.style.height="100vh";const mt=new je(Qt);let Be="title";const gt=h=>{switch(Be=h,h){case"title":mt.setScene(new ki);break;case"single":mt.setScene(new _t);break;case"versus":mt.setScene(new jt);break;case"versusOnline":{const t="Anon",r="test";mt.setScene(new Kt(r,t));break}}};gt("title");window.addEventListener("keydown",h=>{Be==="title"?(h.code==="KeyS"&&gt("single"),h.code==="KeyV"&&gt("versus"),h.code==="KeyO"&&gt("versusOnline")):h.code==="Escape"&&gt("title")});window.addEventListener("resize",()=>mt.resizeToDisplay());
