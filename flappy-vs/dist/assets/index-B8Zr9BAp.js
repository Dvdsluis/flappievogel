(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))e(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&e(a)}).observe(document,{childList:!0,subtree:!0});function s(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function e(i){if(i.ep)return;i.ep=!0;const r=s(i);fetch(i.href,r)}})();class G{constructor(){this.down=new Set,this.pressedThisFrame=new Set,window.addEventListener("keydown",t=>{this.down.has(t.code)||this.pressedThisFrame.add(t.code),this.down.add(t.code),["Space","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","KeyW","KeyA","KeyS","KeyD"].includes(t.code)&&t.preventDefault()},{passive:!1}),window.addEventListener("keyup",t=>this.down.delete(t.code))}beginFrame(){this.pressedThisFrame.clear()}endFrame(){}isDown(t){return this.down.has(t)}wasPressed(t){return this.pressedThisFrame.has(t)}getMovementDirection(){return{x:(this.isDown("ArrowRight")?1:0)+(this.isDown("ArrowLeft")?-1:0),y:(this.isDown("ArrowDown")?1:0)+(this.isDown("ArrowUp")?-1:0)}}getWASDHorizontal(){return(this.isDown("KeyD")?1:0)+(this.isDown("KeyA")?-1:0)}}class V{constructor(t){this.lastTime=0,this.running=!1,this.scene=null,this.loop=e=>{var r,a;if(!this.running||!this.scene)return;const i=Math.min(1/30,(e-this.lastTime)/1e3);this.lastTime=e,this.input.beginFrame(),this.scene.update(i,this),this.scene.render(this.ctx,this),(a=(r=this.input).endFrame)==null||a.call(r),requestAnimationFrame(this.loop)},this.canvas=t;const s=t.getContext("2d");if(!s)throw new Error("2D context not available");this.ctx=s,this.input=new G,this.resizeToDisplay()}resizeToDisplay(){var r,a;const t=Math.max(1,Math.min(window.devicePixelRatio||1,2)),s=this.canvas.getBoundingClientRect(),e=Math.floor(s.width*t)||800,i=Math.floor(s.height*t)||600;(this.canvas.width!==e||this.canvas.height!==i)&&(this.canvas.width=e,this.canvas.height=i),this.ctx.setTransform(1,0,0,1,0,0),(a=(r=this.scene)==null?void 0:r.onResize)==null||a.call(r,this)}setScene(t){this.scene=t,t.init(this),this.running||(this.running=!0,this.lastTime=performance.now(),requestAnimationFrame(this.loop))}}class R{constructor(t=50,s=50,e=28,i=28,r){this.vx=0,this.vy=0,this._score=0,this.hp=3,this.maxHp=3,this.fireCooldown=0,this.x=t,this.y=s,this.width=e,this.height=i}setPosition(t,s){this.x=t,this.y=s}passObstacle(){this._score+=1}update(t){this.x+=this.vx*t,this.y+=this.vy*t,this.fireCooldown>0&&(this.fireCooldown=Math.max(0,this.fireCooldown-t))}get score(){return Math.max(0,this._score)}set score(t){this._score=Math.max(0,t)}}class T{constructor(t,s,e,i,r=120){this.x=t,this.y=s,this.width=e,this.height=i,this.speed=r}update(t){this.x-=this.speed*t}isOffScreen(){return this.x+this.width<0}}class U{render(t,s,e,i,r){t.fillStyle="#e8e8f0",t.font="700 20px system-ui, sans-serif",typeof e=="number"?t.fillText(`P1: ${s}   P2: ${e}`,16,24):t.fillText(`Score: ${s}`,16,24);const a=(l,n,h)=>{if(h!=null)for(let o=0;o<h;o++){t.fillStyle="#ff7b72",t.beginPath();const f=o*18;t.moveTo(l+f+6,n+10),t.arc(l+f+3,n+8,3,0,Math.PI),t.arc(l+f+9,n+8,3,0,Math.PI),t.lineTo(l+f+6,n+14),t.closePath(),t.fill()}};a(16,36,i),r!=null&&a(120,36,r)}}const v=class v{static applyGravity(t,s){t.vy+=v.gravity*s}static jump(t){t.vy=v.jumpVelocity}static checkCollision(t,s){return!(t.x+t.width<s.x||t.x>s.x+s.width||t.y+t.height<s.y||t.y>s.y+s.height)}};v.gravity=900,v.jumpVelocity=-300;let u=v;class k{constructor(t,s){this.canvas=t,this.ctx=s,this.t=0,this.cloudOffset=0}clear(t=0){const{ctx:s}=this,e=this.canvas.width,i=this.canvas.height;this.t+=t,this.cloudOffset=(this.cloudOffset+t*20)%(e+200);const r=s.createLinearGradient(0,0,0,i);r.addColorStop(0,"#0f1630"),r.addColorStop(1,"#0b1022"),s.fillStyle=r,s.fillRect(0,0,e,i);const a=(l,n,h)=>{s.fillStyle="#ffffff14",s.beginPath(),s.roundRect(l,n,120*h,40*h,20*h),s.fill()};for(let l=0;l<4;l++){const n=e-(this.cloudOffset+l*180)%(e+200),h=40+l*45%(i*.5);a(n,h,1)}s.fillStyle="#1a2446",s.fillRect(0,i-20,e,20),s.fillStyle="#111a36";for(let l=0;l<e;l+=16)s.fillRect(l,i-22,8,2)}drawBird(t,s){const{ctx:e}=this,i=Math.min(t.width,t.height)/2,r=t.x+i,a=t.y+i,l=Math.sin(this.t*10)*.6;e.fillStyle=s,e.beginPath(),e.arc(r,a,i,0,Math.PI*2),e.fill(),e.fillStyle="#ffffff88",e.beginPath(),e.arc(r-i*.2,a+i*.1,i*.7,Math.PI*.1,Math.PI*1.2),e.fill(),e.save(),e.translate(r-i*.2,a),e.rotate(-.8+l),e.fillStyle="#00000022",e.beginPath(),e.ellipse(0,0,i*.9,i*.5,0,0,Math.PI*2),e.fill(),e.restore(),e.fillStyle="#ffd166",e.beginPath(),e.moveTo(r+i*.9,a),e.lineTo(r+i*1.4,a-i*.2),e.lineTo(r+i*.9,a+i*.2),e.closePath(),e.fill(),e.fillStyle="#fff",e.beginPath(),e.arc(r+i*.2,a-i*.3,i*.22,0,Math.PI*2),e.fill(),e.fillStyle="#000",e.beginPath(),e.arc(r+i*.25,a-i*.3,i*.1,0,Math.PI*2),e.fill()}drawPlayer(t,s="#58a6ff"){this.drawBird(t,s)}drawObstacle(t){const{ctx:s}=this,e=s.createLinearGradient(t.x,t.y,t.x+t.width,t.y);e.addColorStop(0,"#2bc072"),e.addColorStop(1,"#3be688"),s.fillStyle=e,s.fillRect(t.x,t.y,t.width,t.height),s.fillStyle="#ffffff18",s.fillRect(t.x+6,t.y,6,t.height)}drawHUD(t){this.ctx.fillStyle="#e8e8f0",this.ctx.font="700 24px system-ui, sans-serif",this.ctx.fillText(t,16,32)}drawProjectile(t,s="#ffd166"){const{ctx:e}=this;e.fillStyle=s,e.fillRect(t.x,t.y,t.width,t.height)}drawEnemy(t){const{ctx:s}=this;s.fillStyle="#ff7b72",s.beginPath(),s.ellipse(t.x+t.width/2,t.y+t.height/2,t.width/2,t.height/2,0,0,Math.PI*2),s.fill(),s.fillStyle="#00000055",s.fillRect(t.x+2,t.y+2,t.width-4,3)}drawPowerUp(t){const{ctx:s}=this,e={heal:"#7ee787",rapid:"#f7b84a",shield:"#8b8efb"};s.fillStyle=e[t.type]||"#f7b84a",s.beginPath(),s.roundRect(t.x,t.y,t.width,t.height,4),s.fill()}}class Y{constructor(){this.ctx=null,this._muted=!1}get muted(){return this._muted}set muted(t){this._muted=t;try{localStorage.setItem("mute",t?"1":"0")}catch{}}ensure(){this.ctx||(this.ctx=new(window.AudioContext||window.webkitAudioContext))}beep(t,s=.08,e="sine",i=.05){if(this._muted)return;this.ensure();const r=this.ctx,a=r.createOscillator(),l=r.createGain();a.type=e,a.frequency.value=t,l.gain.value=i,a.connect(l).connect(r.destination);const n=r.currentTime;a.start(n),a.stop(n+s)}flap(){this.beep(660,.05,"square",.05)}score(){this.beep(880,.08,"triangle",.06)}hit(){this.beep(120,.15,"sawtooth",.08)}}const d=new Y;try{d.muted=localStorage.getItem("mute")==="1"}catch{}class E{constructor(){this.pool=[],this.active=[]}spawn(t,s,e){const i=this.pool.pop()||{x:t,y:s,vx:0,vy:0,life:.5,maxLife:.5,size:3,color:"#fff"};i.x=t,i.y=s,i.vx=(e==null?void 0:e.vx)??Math.random()*80-40,i.vy=(e==null?void 0:e.vy)??Math.random()*-80,i.life=(e==null?void 0:e.life)??.5,i.maxLife=i.life,i.size=(e==null?void 0:e.size)??3,i.color=(e==null?void 0:e.color)??"#ffffff88",i.g=(e==null?void 0:e.g)??200,this.active.push(i)}burst(t,s,e,i){for(let r=0;r<e;r++)this.spawn(t,s,{color:i,size:2+Math.random()*2,life:.4+Math.random()*.3})}update(t){for(let s=this.active.length-1;s>=0;s--){const e=this.active[s];e.vy+=(e.g||0)*t,e.x+=e.vx*t,e.y+=e.vy*t,e.life-=t,e.life<=0&&(this.pool.push(e),this.active.splice(s,1))}}render(t){for(const s of this.active){const e=Math.max(0,s.life/s.maxLife);t.fillStyle=s.color.replace(/\d?\.?\d*\)$/,"")||s.color,t.globalAlpha=e,t.beginPath(),t.arc(s.x,s.y,s.size,0,Math.PI*2),t.fill(),t.globalAlpha=1}}}function B(c){return c===2?"shoot":"flap"}class O{constructor(t,s,e,i,r="player"){this.width=10,this.height=4,this.active=!0,this.x=t,this.y=s,this.vx=e,this.vy=i,this.owner=r}update(t){this.x+=this.vx*t,this.y+=this.vy*t}isOffScreen(t,s){return this.x>t+20||this.x+this.width<-20||this.y>s+20||this.y+this.height<-20}}class ${constructor(t,s,e=-120,i=0){this.width=24,this.height=18,this.health=1,this.x=t,this.y=s,this.vx=e,this.vy=i}update(t){this.x+=this.vx*t,this.y+=this.vy*t}isOffScreen(){return this.x+this.width<-40}}class q{constructor(t,s,e){this.width=16,this.height=16,this.vx=-80,this.vy=0,this.x=t,this.y=s,this.type=e}update(t){this.x+=this.vx*t,this.y+=this.vy*t}isOffScreen(){return this.x+this.width<-40}}const N="scores:v1";function K(){try{const c=localStorage.getItem(N);if(!c)return[];const t=JSON.parse(c);return Array.isArray(t)?t.map(s=>({score:Number(s.score)||0,date:Number(s.date)||Date.now()})).filter(s=>s.score>=0&&Number.isFinite(s.date)):[]}catch{return[]}}function L(c){try{localStorage.setItem(N,JSON.stringify(c))}catch{}}const M={addScore(c,t=Date.now()){const s=K();s.push({score:Math.max(0,Math.floor(c)),date:t}),s.sort((i,r)=>r.score-i.score||r.date-i.date);const e=s.slice(0,10);L(e)},getTop(c=5){const t=K();return t.sort((s,e)=>e.score-s.score||e.date-s.date),t.slice(0,c)},clear(){L([])}};class F{constructor(){this.player=new R(80,150,26,26),this.obstacles=[],this.hud=new U,this.timeToNext=0,this.score=0,this.best=0,this.gameOver=!1,this.paused=!1,this.speed=140,this.particles=new E,this.shakeT=0,this.hintT=4,this.bullets=[],this.enemies=[],this.powerUps=[],this.enemyTimer=0,this.powerTimer=5,this.mobileMoveX=0}init(t){this.renderer=new k(t.canvas,t.ctx),this.obstacles=[],this.score=0,this.timeToNext=0,this.gameOver=!1,this.paused=!1,this.speed=140,this.player.hp=this.player.maxHp=3,this.bullets=[],this.enemies=[],this.powerUps=[],this.enemyTimer=0,this.powerTimer=5,this.hintT=4;const s=i=>{var l;if(this.gameOver)return;if(i.touches!==void 0){if((((l=i.touches)==null?void 0:l.length)??0)>=2&&this.player.fireCooldown===0){const o=this.player.x+this.player.width,f=this.player.y+this.player.height*.5-2;this.bullets.push(new O(o,f,360,0,"player")),this.player.fireCooldown=.18,d.beep(980,.05,"square",.05)}else u.jump(this.player),d.flap(),this.particles.burst(this.player.x+this.player.width*.2,this.player.y+this.player.height,8,"#88ccff88");return}const r=i.button??0,a=B(r);if(a==="flap")u.jump(this.player),d.flap();else if(a==="shoot"&&this.player.fireCooldown===0){const n=this.player.x+this.player.width,h=this.player.y+this.player.height*.5-2;this.bullets.push(new O(n,h,360,0,"player")),this.player.fireCooldown=.18,d.beep(980,.05,"square",.05)}};t.canvas.oncontextmenu=i=>{i.preventDefault()},t.canvas.onpointerdown=s;const e=i=>{const r=t.canvas.getBoundingClientRect();let a=0,l=0;for(let n=0;n<i.touches.length;n++){const o=i.touches.item(n).clientX-r.left;o<r.width*.45?a=1:o>r.width*.55&&(l=1)}this.mobileMoveX=l-a};t.canvas.ontouchstart=i=>{e(i),s(i)},t.canvas.ontouchmove=i=>{e(i)},t.canvas.ontouchend=i=>{e(i)};try{const i=localStorage.getItem("best");i&&(this.best=parseInt(i,10)||0)}catch{}document.addEventListener("visibilitychange",()=>{document.hidden&&(this.paused=!0)})}update(t,s){var l,n;const e=s.canvas.height;if(s.input.wasPressed("KeyP")&&(this.paused=!this.paused),s.input.wasPressed("KeyR")&&this.init(s),this.paused)return;if((s.input.wasPressed("Space")||s.input.wasPressed("ArrowUp")||s.input.wasPressed("KeyW"))&&(u.jump(this.player),d.flap(),this.particles.burst(this.player.x+this.player.width*.2,this.player.y+this.player.height,8,"#88ccff88")),(s.input.isDown("KeyJ")||s.input.isDown("ControlLeft")||s.input.isDown("ControlRight"))&&this.player.fireCooldown===0){const h=this.player.x+this.player.width,o=this.player.y+this.player.height*.5-2;this.bullets.push(new O(h,o,360,0,"player")),this.player.fireCooldown=.18,d.beep(980,.05,"square",.05)}const i=s.input.getMovementDirection(),r=((n=(l=s.input).getWASDHorizontal)==null?void 0:n.call(l))??(s.input.isDown("KeyD")?1:0)+(s.input.isDown("KeyA")?-1:0);if(this.player.vx=(i.x+r+this.mobileMoveX)*80,u.applyGravity(this.player,t),this.player.update(t),this.player.y=Math.max(0,Math.min(e-this.player.height,this.player.y)),this.timeToNext-=t,this.timeToNext<=0){this.speed=Math.min(260,this.speed+2);const h=Math.max(120,180-this.score*2);this.timeToNext=Math.max(1,1.6-this.score*.02);const o=h,f=40,y=e-o-40,p=Math.floor(Math.random()*(y-f+1))+f,m=80,w=s.canvas.width+m;this.obstacles.push(new T(w,0,m,p,this.speed)),this.obstacles.push(new T(w,p+o,m,e-(p+o),this.speed))}for(const h of this.obstacles)h.update(t);this.obstacles=this.obstacles.filter(h=>!h.isOffScreen());for(const h of this.obstacles)if(u.checkCollision(this.player,h)&&(this.player.hp-=1,d.hit(),this.particles.burst(this.player.x+this.player.width/2,this.player.y+this.player.height/2,12,"#ff7b72aa"),this.shakeT=.2,this.player.x-=10,this.player.hp<=0)){this.gameOver=!0,this.best=Math.max(this.best,this.score);try{localStorage.setItem("best",String(this.best))}catch{}M.addScore(this.score)}for(let h=0;h<this.obstacles.length;h+=2){const o=this.obstacles[h],f=o.x+o.width/2;!this.gameOver&&f<this.player.x&&o.counted!==!0&&(o.counted=!0,this.score+=1,this.player.passObstacle(),d.score())}if(this.enemyTimer-=t,this.enemyTimer<=0){let h=40,o=e-40;if(this.obstacles.length>=2){let g=0,D=-1/0;for(let S=0;S<this.obstacles.length-1;S+=2){const I=this.obstacles[S];I.x>D&&(D=I.x,g=S)}const W=this.obstacles[g],j=this.obstacles[g+1];h=W.height,o=j.y}const f=12,y=Math.max(0,h+f),p=Math.min(e-20,o-f-18),m=s.canvas.width+40,w=y<p?y+(p-y)*.5:40+Math.random()*(e-120),b=-(120+Math.random()*60+this.score),x=new $(m,w,b,0);x.minY=isFinite(y)?y:20,x.maxY=isFinite(p)?p:e-40,x.phase=Math.random()*Math.PI*2,this.enemies.push(x),this.enemyTimer=1.8-Math.min(1.2,this.score*.01)}if(this.powerTimer-=t,this.powerTimer<=0){const h=["heal","rapid","shield"],o=h[Math.random()*h.length|0];this.powerUps.push(new q(s.canvas.width+20,80+Math.random()*(e-160),o)),this.powerTimer=8+Math.random()*6}for(const h of this.bullets)h.update(t);for(const h of this.enemies){const o=(h.phase??0)+performance.now()/1e3,f=35;h.vy=Math.sin(o)*f,h.update(t);const y=h.minY??20,p=h.maxY??e-40;h.y<y&&(h.y=y),h.y+h.height>p&&(h.y=p-h.height)}for(const h of this.powerUps)h.update(t);this.bullets=this.bullets.filter(h=>!h.isOffScreen(s.canvas.width,e)&&h.active),this.enemies=this.enemies.filter(h=>!h.isOffScreen()),this.powerUps=this.powerUps.filter(h=>!h.isOffScreen());const a=(h,o,f,y,p,m,w,b)=>h<p+w&&h+f>p&&o<m+b&&o+y>m;for(const h of this.bullets)for(const o of this.enemies)h.active&&a(h.x,h.y,h.width,h.height,o.x,o.y,o.width,o.height)&&(h.active=!0,o.health-=1,this.particles.burst(o.x+o.width/2,o.y+o.height/2,8,"#ffd166aa"),o.health<=0&&(o.x=-9999,this.score+=1,d.score()));this.enemies=this.enemies.filter(h=>h.x>-9e3);for(const h of this.enemies)if(a(this.player.x,this.player.y,this.player.width,this.player.height,h.x,h.y,h.width,h.height)&&(this.player.hp-=1,d.hit(),this.particles.burst(h.x+h.width/2,h.y+h.height/2,10,"#ff7b72aa"),h.x=-9999,this.player.hp<=0)){this.gameOver=!0,this.best=Math.max(this.best,this.score);try{localStorage.setItem("best",String(this.best))}catch{}M.addScore(this.score)}for(const h of this.powerUps)a(this.player.x,this.player.y,this.player.width,this.player.height,h.x,h.y,h.width,h.height)&&(h.type==="heal"&&(this.player.hp=Math.min(this.player.maxHp,this.player.hp+1)),h.type==="rapid"&&(this.player.fireCooldown=Math.min(this.player.fireCooldown,.08)),h.type==="shield"&&(this.player.maxHp=Math.min(5,this.player.maxHp+1)),this.player.hp=Math.min(this.player.maxHp,this.player.hp+1),this.particles.burst(h.x+h.width/2,h.y+h.height/2,14,"#7ee787aa"),h.x=-9999);this.particles.update(t),this.shakeT=Math.max(0,this.shakeT-t),this.hintT=Math.max(0,this.hintT-t)}render(t,s){const e=this.shakeT>0?(Math.random()-.5)*8:0;t.save(),t.translate(e,e),this.renderer.clear(1/60);for(const i of this.obstacles)this.renderer.drawObstacle(i);for(const i of this.enemies)this.renderer.drawEnemy(i);for(const i of this.powerUps)this.renderer.drawPowerUp(i);this.renderer.drawPlayer(this.player,"#58a6ff");for(const i of this.bullets)this.renderer.drawProjectile(i);if(this.particles.render(t),this.hud.render(t,this.score,void 0,this.player.hp),this.hintT>0){const i=Math.min(.8,this.hintT/4);t.save(),t.globalAlpha=i,t.fillStyle="#00000088",t.fillRect(20,70,520,56),t.fillStyle="#e8e8f0",t.font="600 16px system-ui",t.fillText("Flap: Space/ArrowUp/W or Click • Move: Arrows or A/D • Shoot: Right Click or Ctrl/J (hold)",28,100),t.restore()}t.restore(),this.paused&&(t.fillStyle="#00000088",t.fillRect(0,0,s.canvas.width,s.canvas.height),t.fillStyle="#e8e8f0",t.font="700 28px system-ui",t.fillText("Paused (P). R = Restart, Esc = Title",40,120)),this.gameOver&&(t.fillStyle="#00000088",t.fillRect(0,0,s.canvas.width,s.canvas.height),t.fillStyle="#e8e8f0",t.font="700 28px system-ui",t.fillText(`Game Over — Score ${this.score}  Best ${this.best}`,40,120),t.font="500 18px system-ui",t.fillText("Press R to restart or Esc for Title",40,160))}}class H{constructor(){this.p1=new R(80,140,26,26),this.p2=new R(120,220,26,26),this.obstacles=[],this.hud=new U,this.timeToNext=0,this.s1=0,this.s2=0,this.paused=!1,this.speed=140,this.particles=new E,this.shakeT=0}init(t){this.renderer=new k(t.canvas,t.ctx),this.obstacles=[],this.timeToNext=0,this.s1=0,this.s2=0,this.paused=!1,this.speed=140;const s=()=>{u.jump(this.p1),d.flap()};t.canvas.ontouchstart=s,t.canvas.onpointerdown=s}update(t,s){const e=s.canvas.height;if(s.input.wasPressed("KeyP")&&(this.paused=!this.paused),s.input.wasPressed("KeyR")&&this.init(s),this.paused)return;(s.input.wasPressed("Space")||s.input.wasPressed("ArrowUp"))&&(u.jump(this.p1),d.flap(),this.particles.burst(this.p1.x,this.p1.y+this.p1.height,6,"#88ccff88")),s.input.wasPressed("KeyW")&&(u.jump(this.p2),d.flap(),this.particles.burst(this.p2.x,this.p2.y+this.p2.height,6,"#ffb08888"));const i=s.input.getMovementDirection();if(this.p1.vx=i.x*80,this.p2.vx=0,this.p2.vy+=(s.input.isDown("KeyS")?1:0)*300*t,u.applyGravity(this.p1,t),u.applyGravity(this.p2,t),this.p1.update(t),this.p2.update(t),this.p1.y=Math.max(0,Math.min(e-this.p1.height,this.p1.y)),this.p2.y=Math.max(0,Math.min(e-this.p2.height,this.p2.y)),this.timeToNext-=t,this.timeToNext<=0){this.speed=Math.min(260,this.speed+2);const r=Math.max(130,180-Math.max(this.s1,this.s2)*2);this.timeToNext=Math.max(1,1.7-Math.max(this.s1,this.s2)*.02);const a=40,l=e-r-40,n=Math.floor(Math.random()*(l-a+1))+a,h=80,o=s.canvas.width+h;this.obstacles.push(new T(o,0,h,n,this.speed)),this.obstacles.push(new T(o,n+r,h,e-(n+r),this.speed))}for(const r of this.obstacles)r.update(t);this.obstacles=this.obstacles.filter(r=>!r.isOffScreen());for(const r of this.obstacles)if(u.checkCollision(this.p1,r)||u.checkCollision(this.p2,r)){d.hit(),this.particles.burst((this.p1.x+this.p2.x)/2,(this.p1.y+this.p2.y)/2,16,"#ff7b72aa"),this.shakeT=.25,this.init(s);return}for(let r=0;r<this.obstacles.length;r+=2){const a=this.obstacles[r],l=a.x+a.width/2;l<this.p1.x&&a.p1c!==!0&&(a.p1c=!0,this.s1+=1,this.p1.passObstacle(),d.score()),l<this.p2.x&&a.p2c!==!0&&(a.p2c=!0,this.s2+=1,this.p2.passObstacle(),d.score())}}render(t,s){const e=this.shakeT>0?(Math.random()-.5)*8:0;t.save(),t.translate(e,e),this.renderer.clear(1/60);for(const i of this.obstacles)this.renderer.drawObstacle(i);this.renderer.drawPlayer(this.p1,"#58a6ff"),this.renderer.drawPlayer(this.p2,"#ff7b72"),this.particles.render(t),this.hud.render(t,this.s1,this.s2),t.restore(),this.paused&&(t.fillStyle="#00000088",t.fillRect(0,0,s.canvas.width,s.canvas.height),t.fillStyle="#e8e8f0",t.font="700 28px system-ui",t.fillText("Paused (P). R = Restart, Esc = Title",40,120))}}class X{constructor(){this.t=0}onResize(t){t.ctx.setTransform(1,0,0,1,0,0)}init(t){t.canvas.focus()}update(t,s){this.t+=t,s.input.wasPressed("KeyS")&&s.setScene(new F),s.input.wasPressed("KeyV")&&s.setScene(new H),s.input.wasPressed("KeyM")&&(d.muted=!d.muted),s.input.wasPressed("KeyC")&&M.clear();const{ctx:e}=s,i=s.canvas.width,r=s.canvas.height,a=e.createLinearGradient(0,0,0,r);a.addColorStop(0,"#0b1023"),a.addColorStop(1,"#1a2247"),e.fillStyle=a,e.fillRect(0,0,i,r),e.save(),e.globalAlpha=.2;for(let p=0;p<60;p++){const m=p*91%i,w=p*53%r;e.fillStyle=p%2?"#d0e0ff":"#a0b8ff",e.fillRect(m,w+(Math.sin(this.t+p)*2+2)|0,2,2)}e.restore();const l=Math.sin(this.t*2)*6;e.fillStyle="#e8e8f0",e.font="800 64px system-ui, ui-sans-serif, -apple-system, Segoe UI",e.textBaseline="top",e.fillText("Flappy VS",40,80+l),e.strokeStyle="#58a6ff",e.lineWidth=6,e.beginPath(),e.moveTo(40,80+l+64+8),e.lineTo(280,80+l+64+8),e.stroke(),e.fillStyle="#0f172a88";const n=180;e.fillRect(32,n,Math.min(520,i-64),150),e.fillStyle="#cdd9e5",e.font="700 22px system-ui",e.fillText("Play",48,n+16),e.font="500 18px system-ui",e.fillText("S — Singleplayer",48,n+52),e.fillText("V — Versus (Local)",48,n+80);const h=n+170;e.fillStyle="#0f172a88",e.fillRect(32,h,Math.min(620,i-64),160),e.fillStyle="#cdd9e5",e.font="700 20px system-ui",e.fillText("Controls",48,h+16),e.font="500 16px system-ui";let o=h+46;e.fillText("Singleplayer: Flap = Space/ArrowUp/W or Click/Tap • Move = ArrowLeft/Right or A/D • Shoot = Right Click or Ctrl/J (hold)",48,o),o+=28,e.fillText("Versus: P1 = Arrows + Space • P2 = W (flap), S (nudge down)",48,o),o+=28,e.fillText(`Mute = M (${d.muted?"Muted":"Sound on"}) • Esc returns here`,48,o);const f=M.getTop(5);if(f.length){const m=28+f.length*22+16,w=Math.max(i-280-24,24),b=24;e.fillStyle="#0f172acc",e.fillRect(w,b,280,m),e.fillStyle="#cdd9e5",e.font="700 16px system-ui",e.fillText("Top Scores",w+12,b+20),e.font="500 14px system-ui";for(let x=0;x<f.length;x++){const g=f[x];e.fillText(`${x+1}. ${g.score}`,w+12,b+44+x*22)}e.font="400 12px system-ui",e.fillStyle="#94a3b8",e.fillText("Press C to clear",w+12,b+m-10)}const y=.5+.5*Math.sin(this.t*3);e.save(),e.globalAlpha=.6+.4*y,e.fillStyle="#58a6ff",e.font="700 18px system-ui",e.fillText("Press S or V to start — Tap to flap, two-finger tap to shoot",40,r-60),e.restore()}render(){}}const A=document.getElementById("gameCanvas");A.style.width="100vw";A.style.height="100vh";const P=new V(A);let C="title";const z=()=>{C="title",P.setScene(new X)},J=()=>{C="single",P.setScene(new F)},_=()=>{C="versus",P.setScene(new H)};z();window.addEventListener("keydown",c=>{C==="title"?(c.code==="KeyS"&&J(),c.code==="KeyV"&&_()):c.code==="Escape"&&z()});window.addEventListener("resize",()=>P.resizeToDisplay());
