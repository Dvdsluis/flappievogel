(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const h of i)if(h.type==="childList")for(const a of h.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function e(i){const h={};return i.integrity&&(h.integrity=i.integrity),i.referrerPolicy&&(h.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?h.credentials="include":i.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function s(i){if(i.ep)return;i.ep=!0;const h=e(i);fetch(i.href,h)}})();class O{constructor(){this.down=new Set,this.pressedThisFrame=new Set,window.addEventListener("keydown",t=>{this.down.has(t.code)||this.pressedThisFrame.add(t.code),this.down.add(t.code),["Space","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(t.code)&&t.preventDefault()},{passive:!1}),window.addEventListener("keyup",t=>this.down.delete(t.code))}beginFrame(){this.pressedThisFrame.clear()}endFrame(){}isDown(t){return this.down.has(t)}wasPressed(t){return this.pressedThisFrame.has(t)}getMovementDirection(){return{x:(this.isDown("ArrowRight")?1:0)+(this.isDown("ArrowLeft")?-1:0),y:(this.isDown("ArrowDown")?1:0)+(this.isDown("ArrowUp")?-1:0)}}}class R{constructor(t){this.lastTime=0,this.running=!1,this.scene=null,this.loop=s=>{var h,a;if(!this.running||!this.scene)return;const i=Math.min(1/30,(s-this.lastTime)/1e3);this.lastTime=s,this.input.beginFrame(),this.scene.update(i,this),this.scene.render(this.ctx,this),(a=(h=this.input).endFrame)==null||a.call(h),requestAnimationFrame(this.loop)},this.canvas=t;const e=t.getContext("2d");if(!e)throw new Error("2D context not available");this.ctx=e,this.input=new O,this.resizeToDisplay()}resizeToDisplay(){var h,a;const t=Math.max(1,Math.min(window.devicePixelRatio||1,2)),e=this.canvas.getBoundingClientRect(),s=Math.floor(e.width*t)||800,i=Math.floor(e.height*t)||600;(this.canvas.width!==s||this.canvas.height!==i)&&(this.canvas.width=s,this.canvas.height=i),this.ctx.setTransform(1,0,0,1,0,0),(a=(h=this.scene)==null?void 0:h.onResize)==null||a.call(h,this)}setScene(t){this.scene=t,t.init(this),this.running||(this.running=!0,this.lastTime=performance.now(),requestAnimationFrame(this.loop))}}class w{constructor(t=50,e=50,s=28,i=28,h){this.vx=0,this.vy=0,this._score=0,this.x=t,this.y=e,this.width=s,this.height=i}setPosition(t,e){this.x=t,this.y=e}passObstacle(){this._score+=1}update(t){this.x+=this.vx*t,this.y+=this.vy*t}get score(){return Math.max(0,this._score)}set score(t){this._score=Math.max(0,t)}}class u{constructor(t,e,s,i,h=120){this.x=t,this.y=e,this.width=s,this.height=i,this.speed=h}update(t){this.x-=this.speed*t}isOffScreen(){return this.x+this.width<0}}class b{render(t,e,s){t.fillStyle="#e8e8f0",t.font="700 20px system-ui, sans-serif",typeof s=="number"?t.fillText(`P1: ${e}   P2: ${s}`,16,24):t.fillText(`Score: ${e}`,16,24)}}const p=class p{static applyGravity(t,e){t.vy+=p.gravity*e}static jump(t){t.vy=p.jumpVelocity}static checkCollision(t,e){return!(t.x+t.width<e.x||t.x>e.x+e.width||t.y+t.height<e.y||t.y>e.y+e.height)}};p.gravity=900,p.jumpVelocity=-300;let c=p;class g{constructor(t,e){this.canvas=t,this.ctx=e,this.t=0,this.cloudOffset=0}clear(t=0){const{ctx:e}=this,s=this.canvas.width,i=this.canvas.height;this.t+=t,this.cloudOffset=(this.cloudOffset+t*20)%(s+200);const h=e.createLinearGradient(0,0,0,i);h.addColorStop(0,"#0f1630"),h.addColorStop(1,"#0b1022"),e.fillStyle=h,e.fillRect(0,0,s,i);const a=(r,f,n)=>{e.fillStyle="#ffffff14",e.beginPath(),e.roundRect(r,f,120*n,40*n,20*n),e.fill()};for(let r=0;r<4;r++){const f=s-(this.cloudOffset+r*180)%(s+200),n=40+r*45%(i*.5);a(f,n,1)}e.fillStyle="#1a2446",e.fillRect(0,i-20,s,20),e.fillStyle="#111a36";for(let r=0;r<s;r+=16)e.fillRect(r,i-22,8,2)}drawBird(t,e){const{ctx:s}=this,i=Math.min(t.width,t.height)/2,h=t.x+i,a=t.y+i,r=Math.sin(this.t*10)*.6;s.fillStyle=e,s.beginPath(),s.arc(h,a,i,0,Math.PI*2),s.fill(),s.fillStyle="#ffffff88",s.beginPath(),s.arc(h-i*.2,a+i*.1,i*.7,Math.PI*.1,Math.PI*1.2),s.fill(),s.save(),s.translate(h-i*.2,a),s.rotate(-.8+r),s.fillStyle="#00000022",s.beginPath(),s.ellipse(0,0,i*.9,i*.5,0,0,Math.PI*2),s.fill(),s.restore(),s.fillStyle="#ffd166",s.beginPath(),s.moveTo(h+i*.9,a),s.lineTo(h+i*1.4,a-i*.2),s.lineTo(h+i*.9,a+i*.2),s.closePath(),s.fill(),s.fillStyle="#fff",s.beginPath(),s.arc(h+i*.2,a-i*.3,i*.22,0,Math.PI*2),s.fill(),s.fillStyle="#000",s.beginPath(),s.arc(h+i*.25,a-i*.3,i*.1,0,Math.PI*2),s.fill()}drawPlayer(t,e="#58a6ff"){this.drawBird(t,e)}drawObstacle(t){const{ctx:e}=this,s=e.createLinearGradient(t.x,t.y,t.x+t.width,t.y);s.addColorStop(0,"#2bc072"),s.addColorStop(1,"#3be688"),e.fillStyle=s,e.fillRect(t.x,t.y,t.width,t.height),e.fillStyle="#ffffff18",e.fillRect(t.x+6,t.y,6,t.height)}drawHUD(t){this.ctx.fillStyle="#e8e8f0",this.ctx.font="700 24px system-ui, sans-serif",this.ctx.fillText(t,16,32)}}class A{constructor(){this.ctx=null,this._muted=!1}get muted(){return this._muted}set muted(t){this._muted=t;try{localStorage.setItem("mute",t?"1":"0")}catch{}}ensure(){this.ctx||(this.ctx=new(window.AudioContext||window.webkitAudioContext))}beep(t,e=.08,s="sine",i=.05){if(this._muted)return;this.ensure();const h=this.ctx,a=h.createOscillator(),r=h.createGain();a.type=s,a.frequency.value=t,r.gain.value=i,a.connect(r).connect(h.destination);const f=h.currentTime;a.start(f),a.stop(f+e)}flap(){this.beep(660,.05,"square",.05)}score(){this.beep(880,.08,"triangle",.06)}hit(){this.beep(120,.15,"sawtooth",.08)}}const l=new A;try{l.muted=localStorage.getItem("mute")==="1"}catch{}class S{constructor(){this.pool=[],this.active=[]}spawn(t,e,s){const i=this.pool.pop()||{x:t,y:e,vx:0,vy:0,life:.5,maxLife:.5,size:3,color:"#fff"};i.x=t,i.y=e,i.vx=(s==null?void 0:s.vx)??Math.random()*80-40,i.vy=(s==null?void 0:s.vy)??Math.random()*-80,i.life=(s==null?void 0:s.life)??.5,i.maxLife=i.life,i.size=(s==null?void 0:s.size)??3,i.color=(s==null?void 0:s.color)??"#ffffff88",i.g=(s==null?void 0:s.g)??200,this.active.push(i)}burst(t,e,s,i){for(let h=0;h<s;h++)this.spawn(t,e,{color:i,size:2+Math.random()*2,life:.4+Math.random()*.3})}update(t){for(let e=this.active.length-1;e>=0;e--){const s=this.active[e];s.vy+=(s.g||0)*t,s.x+=s.vx*t,s.y+=s.vy*t,s.life-=t,s.life<=0&&(this.pool.push(s),this.active.splice(e,1))}}render(t){for(const e of this.active){const s=Math.max(0,e.life/e.maxLife);t.fillStyle=e.color.replace(/\d?\.?\d*\)$/,"")||e.color,t.globalAlpha=s,t.beginPath(),t.arc(e.x,e.y,e.size,0,Math.PI*2),t.fill(),t.globalAlpha=1}}}class T{constructor(){this.player=new w(80,150,26,26),this.obstacles=[],this.hud=new b,this.timeToNext=0,this.score=0,this.best=0,this.gameOver=!1,this.paused=!1,this.speed=140,this.particles=new S,this.shakeT=0}init(t){this.renderer=new g(t.canvas,t.ctx),this.obstacles=[],this.score=0,this.timeToNext=0,this.gameOver=!1,this.paused=!1,this.speed=140;const e=()=>{this.gameOver||(c.jump(this.player),l.flap())};t.canvas.ontouchstart=e,t.canvas.onpointerdown=e;try{const s=localStorage.getItem("best");s&&(this.best=parseInt(s,10)||0)}catch{}document.addEventListener("visibilitychange",()=>{document.hidden&&(this.paused=!0)})}update(t,e){const s=e.canvas.height;if(e.input.wasPressed("KeyP")&&(this.paused=!this.paused),e.input.wasPressed("KeyR")&&this.init(e),this.paused)return;(e.input.wasPressed("Space")||e.input.wasPressed("ArrowUp"))&&(c.jump(this.player),l.flap(),this.particles.burst(this.player.x+this.player.width*.2,this.player.y+this.player.height,8,"#88ccff88"));const i=e.input.getMovementDirection();if(this.player.vx=i.x*80,c.applyGravity(this.player,t),this.player.update(t),this.player.y=Math.max(0,Math.min(s-this.player.height,this.player.y)),this.timeToNext-=t,this.timeToNext<=0){this.speed=Math.min(260,this.speed+2);const h=Math.max(120,180-this.score*2);this.timeToNext=Math.max(1,1.6-this.score*.02);const a=h,r=40,f=s-a-40,n=Math.floor(Math.random()*(f-r+1))+r,d=80,x=e.canvas.width+d;this.obstacles.push(new u(x,0,d,n,this.speed)),this.obstacles.push(new u(x,n+a,d,s-(n+a),this.speed))}for(const h of this.obstacles)h.update(t);this.obstacles=this.obstacles.filter(h=>!h.isOffScreen());for(const h of this.obstacles)if(c.checkCollision(this.player,h)){this.gameOver=!0,this.best=Math.max(this.best,this.score);try{localStorage.setItem("best",String(this.best))}catch{}l.hit(),this.particles.burst(this.player.x+this.player.width/2,this.player.y+this.player.height/2,16,"#ff7b72aa"),this.shakeT=.3}for(let h=0;h<this.obstacles.length;h+=2){const a=this.obstacles[h],r=a.x+a.width/2;!this.gameOver&&r<this.player.x&&a.counted!==!0&&(a.counted=!0,this.score+=1,this.player.passObstacle(),l.score())}this.particles.update(t),this.shakeT=Math.max(0,this.shakeT-t)}render(t,e){const s=this.shakeT>0?(Math.random()-.5)*8:0;t.save(),t.translate(s,s),this.renderer.clear(1/60);for(const i of this.obstacles)this.renderer.drawObstacle(i);this.renderer.drawPlayer(this.player,"#58a6ff"),this.particles.render(t),this.hud.render(t,this.score),t.restore(),this.paused&&(t.fillStyle="#00000088",t.fillRect(0,0,e.canvas.width,e.canvas.height),t.fillStyle="#e8e8f0",t.font="700 28px system-ui",t.fillText("Paused (P). R = Restart, Esc = Title",40,120)),this.gameOver&&(t.fillStyle="#00000088",t.fillRect(0,0,e.canvas.width,e.canvas.height),t.fillStyle="#e8e8f0",t.font="700 28px system-ui",t.fillText(`Game Over â€” Score ${this.score}  Best ${this.best}`,40,120),t.font="500 18px system-ui",t.fillText("Press R to restart or Esc for Title",40,160))}}class P{constructor(){this.p1=new w(80,140,26,26),this.p2=new w(120,220,26,26),this.obstacles=[],this.hud=new b,this.timeToNext=0,this.s1=0,this.s2=0,this.paused=!1,this.speed=140,this.particles=new S,this.shakeT=0}init(t){this.renderer=new g(t.canvas,t.ctx),this.obstacles=[],this.timeToNext=0,this.s1=0,this.s2=0,this.paused=!1,this.speed=140;const e=()=>{c.jump(this.p1),l.flap()};t.canvas.ontouchstart=e,t.canvas.onpointerdown=e}update(t,e){const s=e.canvas.height;if(e.input.wasPressed("KeyP")&&(this.paused=!this.paused),e.input.wasPressed("KeyR")&&this.init(e),this.paused)return;(e.input.wasPressed("Space")||e.input.wasPressed("ArrowUp"))&&(c.jump(this.p1),l.flap(),this.particles.burst(this.p1.x,this.p1.y+this.p1.height,6,"#88ccff88")),e.input.wasPressed("KeyW")&&(c.jump(this.p2),l.flap(),this.particles.burst(this.p2.x,this.p2.y+this.p2.height,6,"#ffb08888"));const i=e.input.getMovementDirection();if(this.p1.vx=i.x*80,this.p2.vx=0,this.p2.vy+=(e.input.isDown("KeyS")?1:0)*300*t,c.applyGravity(this.p1,t),c.applyGravity(this.p2,t),this.p1.update(t),this.p2.update(t),this.p1.y=Math.max(0,Math.min(s-this.p1.height,this.p1.y)),this.p2.y=Math.max(0,Math.min(s-this.p2.height,this.p2.y)),this.timeToNext-=t,this.timeToNext<=0){this.speed=Math.min(260,this.speed+2);const h=Math.max(130,180-Math.max(this.s1,this.s2)*2);this.timeToNext=Math.max(1,1.7-Math.max(this.s1,this.s2)*.02);const a=40,r=s-h-40,f=Math.floor(Math.random()*(r-a+1))+a,n=80,d=e.canvas.width+n;this.obstacles.push(new u(d,0,n,f,this.speed)),this.obstacles.push(new u(d,f+h,n,s-(f+h),this.speed))}for(const h of this.obstacles)h.update(t);this.obstacles=this.obstacles.filter(h=>!h.isOffScreen());for(const h of this.obstacles)if(c.checkCollision(this.p1,h)||c.checkCollision(this.p2,h)){l.hit(),this.particles.burst((this.p1.x+this.p2.x)/2,(this.p1.y+this.p2.y)/2,16,"#ff7b72aa"),this.shakeT=.25,this.init(e);return}for(let h=0;h<this.obstacles.length;h+=2){const a=this.obstacles[h],r=a.x+a.width/2;r<this.p1.x&&a.p1c!==!0&&(a.p1c=!0,this.s1+=1,this.p1.passObstacle(),l.score()),r<this.p2.x&&a.p2c!==!0&&(a.p2c=!0,this.s2+=1,this.p2.passObstacle(),l.score())}}render(t,e){const s=this.shakeT>0?(Math.random()-.5)*8:0;t.save(),t.translate(s,s),this.renderer.clear(1/60);for(const i of this.obstacles)this.renderer.drawObstacle(i);this.renderer.drawPlayer(this.p1,"#58a6ff"),this.renderer.drawPlayer(this.p2,"#ff7b72"),this.particles.render(t),this.hud.render(t,this.s1,this.s2),t.restore(),this.paused&&(t.fillStyle="#00000088",t.fillRect(0,0,e.canvas.width,e.canvas.height),t.fillStyle="#e8e8f0",t.font="700 28px system-ui",t.fillText("Paused (P). R = Restart, Esc = Title",40,120))}}class D{init(t){t.canvas.focus()}update(t,e){e.input.wasPressed("KeyS")&&e.setScene(new T),e.input.wasPressed("KeyV")&&e.setScene(new P),e.input.wasPressed("KeyM")&&(l.muted=!l.muted);const s=e.ctx;s.fillStyle="#0f1220",s.fillRect(0,0,e.canvas.width,e.canvas.height),s.fillStyle="#e8e8f0",s.font="700 42px system-ui, sans-serif",s.fillText("Flappy VS",40,100),s.font="500 20px system-ui, sans-serif",s.fillText("Press [S] for Singleplayer",40,180),s.fillText("Press [V] for Versus (Local)",40,210),s.fillText("Controls: Arrow keys (P1), WASD (P2 up/down)",40,250),s.fillText(`M to ${l.muted?"Unmute":"Mute"} â€¢ Esc returns here`,40,280)}render(){}}const v=document.getElementById("gameCanvas");v.style.width="100vw";v.style.height="100vh";const y=new R(v);let m="title";const M=()=>{m="title",y.setScene(new D)},L=()=>{m="single",y.setScene(new T)},C=()=>{m="versus",y.setScene(new P)};M();window.addEventListener("keydown",o=>{m==="title"?(o.code==="KeyS"&&L(),o.code==="KeyV"&&C()):o.code==="Escape"&&M()});window.addEventListener("resize",()=>y.resizeToDisplay());
