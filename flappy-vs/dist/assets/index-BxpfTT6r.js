(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))e(h);new MutationObserver(h=>{for(const o of h)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&e(r)}).observe(document,{childList:!0,subtree:!0});function s(h){const o={};return h.integrity&&(o.integrity=h.integrity),h.referrerPolicy&&(o.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?o.credentials="include":h.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function e(h){if(h.ep)return;h.ep=!0;const o=s(h);fetch(h.href,o)}})();class V{constructor(){this.down=new Set,this.pressedThisFrame=new Set,window.addEventListener("keydown",t=>{this.down.has(t.code)||this.pressedThisFrame.add(t.code),this.down.add(t.code),["Space","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","KeyW","KeyA","KeyS","KeyD"].includes(t.code)&&t.preventDefault()},{passive:!1}),window.addEventListener("keyup",t=>this.down.delete(t.code))}beginFrame(){this.pressedThisFrame.clear()}endFrame(){}isDown(t){return this.down.has(t)}wasPressed(t){return this.pressedThisFrame.has(t)}getMovementDirection(){return{x:(this.isDown("ArrowRight")?1:0)+(this.isDown("ArrowLeft")?-1:0),y:(this.isDown("ArrowDown")?1:0)+(this.isDown("ArrowUp")?-1:0)}}getWASDHorizontal(){return(this.isDown("KeyD")?1:0)+(this.isDown("KeyA")?-1:0)}}class ${constructor(t){this.lastTime=0,this.running=!1,this.scene=null,this.loop=e=>{var o,r;if(!this.running||!this.scene)return;const h=Math.min(1/30,(e-this.lastTime)/1e3);this.lastTime=e,this.input.beginFrame(),this.scene.update(h,this),this.scene.render(this.ctx,this),(r=(o=this.input).endFrame)==null||r.call(o),requestAnimationFrame(this.loop)},this.canvas=t;const s=t.getContext("2d");if(!s)throw new Error("2D context not available");this.ctx=s,this.input=new V,this.resizeToDisplay()}resizeToDisplay(){var o,r;const t=Math.max(1,Math.min(window.devicePixelRatio||1,2)),s=this.canvas.getBoundingClientRect(),e=Math.floor(s.width*t)||800,h=Math.floor(s.height*t)||600;(this.canvas.width!==e||this.canvas.height!==h)&&(this.canvas.width=e,this.canvas.height=h),this.ctx.setTransform(1,0,0,1,0,0),(r=(o=this.scene)==null?void 0:o.onResize)==null||r.call(o,this)}setScene(t){this.scene=t,t.init(this),this.running||(this.running=!0,this.lastTime=performance.now(),requestAnimationFrame(this.loop))}}class E{constructor(t=50,s=50,e=28,h=28,o){this.vx=0,this.vy=0,this._score=0,this.hp=3,this.maxHp=3,this.fireCooldown=0,this.x=t,this.y=s,this.width=e,this.height=h}setPosition(t,s){this.x=t,this.y=s}passObstacle(){this._score+=1}update(t){this.x+=this.vx*t,this.y+=this.vy*t,this.fireCooldown>0&&(this.fireCooldown=Math.max(0,this.fireCooldown-t))}get score(){return Math.max(0,this._score)}set score(t){this._score=Math.max(0,t)}}class L{constructor(t,s,e,h,o=120){this.x=t,this.y=s,this.width=e,this.height=h,this.speed=o}update(t){this.x-=this.speed*t}isOffScreen(){return this.x+this.width<0}}class H{render(t,s,e,h,o){t.fillStyle="#e8e8f0",t.font="700 20px system-ui, sans-serif",typeof e=="number"?t.fillText(`P1: ${s}   P2: ${e}`,16,24):t.fillText(`Score: ${s}`,16,24);const r=(c,n,l)=>{if(l!=null)for(let i=0;i<l;i++){t.fillStyle="#ff7b72",t.beginPath();const a=i*18;t.moveTo(c+a+6,n+10),t.arc(c+a+3,n+8,3,0,Math.PI),t.arc(c+a+9,n+8,3,0,Math.PI),t.lineTo(c+a+6,n+14),t.closePath(),t.fill()}};r(16,36,h),o!=null&&r(120,36,o)}}const R=class R{static applyGravity(t,s){t.vy+=R.gravity*s}static jump(t){t.vy=R.jumpVelocity}static checkCollision(t,s){return!(t.x+t.width<s.x||t.x>s.x+s.width||t.y+t.height<s.y||t.y>s.y+s.height)}};R.gravity=900,R.jumpVelocity=-300;let g=R;class W{constructor(t,s){this.canvas=t,this.ctx=s,this.t=0,this.cloudOffset=0}clear(t=0){const{ctx:s}=this,e=this.canvas.width,h=this.canvas.height;this.t+=t,this.cloudOffset=(this.cloudOffset+t*20)%(e+200);const o=s.createLinearGradient(0,0,0,h);o.addColorStop(0,"#0f1630"),o.addColorStop(1,"#0b1022"),s.fillStyle=o,s.fillRect(0,0,e,h);const r=(c,n,l)=>{s.fillStyle="#ffffff14",s.beginPath(),s.roundRect(c,n,120*l,40*l,20*l),s.fill()};for(let c=0;c<4;c++){const n=e-(this.cloudOffset+c*180)%(e+200),l=40+c*45%(h*.5);r(n,l,1)}s.fillStyle="#1a2446",s.fillRect(0,h-20,e,20),s.fillStyle="#111a36";for(let c=0;c<e;c+=16)s.fillRect(c,h-22,8,2)}drawBird(t,s){const{ctx:e}=this,h=Math.min(t.width,t.height)/2,o=t.x+h,r=t.y+h,c=Math.sin(this.t*10)*.6;e.fillStyle=s,e.beginPath(),e.arc(o,r,h,0,Math.PI*2),e.fill(),e.fillStyle="#ffffff88",e.beginPath(),e.arc(o-h*.2,r+h*.1,h*.7,Math.PI*.1,Math.PI*1.2),e.fill(),e.save(),e.translate(o-h*.2,r),e.rotate(-.8+c),e.fillStyle="#00000022",e.beginPath(),e.ellipse(0,0,h*.9,h*.5,0,0,Math.PI*2),e.fill(),e.restore(),e.fillStyle="#ffd166",e.beginPath(),e.moveTo(o+h*.9,r),e.lineTo(o+h*1.4,r-h*.2),e.lineTo(o+h*.9,r+h*.2),e.closePath(),e.fill(),e.fillStyle="#fff",e.beginPath(),e.arc(o+h*.2,r-h*.3,h*.22,0,Math.PI*2),e.fill(),e.fillStyle="#000",e.beginPath(),e.arc(o+h*.25,r-h*.3,h*.1,0,Math.PI*2),e.fill()}drawPlayer(t,s="#58a6ff"){this.drawBird(t,s)}drawObstacle(t){const{ctx:s}=this,e=s.createLinearGradient(t.x,t.y,t.x+t.width,t.y);e.addColorStop(0,"#2bc072"),e.addColorStop(1,"#3be688"),s.fillStyle=e,s.fillRect(t.x,t.y,t.width,t.height),s.fillStyle="#ffffff18",s.fillRect(t.x+6,t.y,6,t.height)}drawHUD(t){this.ctx.fillStyle="#e8e8f0",this.ctx.font="700 24px system-ui, sans-serif",this.ctx.fillText(t,16,32)}drawProjectile(t,s="#ffd166"){const{ctx:e}=this;e.fillStyle=s,e.fillRect(t.x,t.y,t.width,t.height)}drawEnemy(t){const{ctx:s}=this;s.fillStyle="#ff7b72",s.beginPath(),s.ellipse(t.x+t.width/2,t.y+t.height/2,t.width/2,t.height/2,0,0,Math.PI*2),s.fill(),s.fillStyle="#00000055",s.fillRect(t.x+2,t.y+2,t.width-4,3)}drawPowerUp(t){const{ctx:s}=this,e={heal:"#7ee787",rapid:"#f7b84a",shield:"#8b8efb"};s.fillStyle=e[t.type]||"#f7b84a",s.beginPath(),s.roundRect(t.x,t.y,t.width,t.height,4),s.fill()}}class q{constructor(){this.ctx=null,this._muted=!1}get muted(){return this._muted}set muted(t){this._muted=t;try{localStorage.setItem("mute",t?"1":"0")}catch{}}ensure(){this.ctx||(this.ctx=new(window.AudioContext||window.webkitAudioContext))}beep(t,s=.08,e="sine",h=.05){if(this._muted)return;this.ensure();const o=this.ctx,r=o.createOscillator(),c=o.createGain();r.type=e,r.frequency.value=t,c.gain.value=h,r.connect(c).connect(o.destination);const n=o.currentTime;r.start(n),r.stop(n+s)}flap(){this.beep(660,.05,"square",.05)}score(){this.beep(880,.08,"triangle",.06)}hit(){this.beep(120,.15,"sawtooth",.08)}}const w=new q;try{w.muted=localStorage.getItem("mute")==="1"}catch{}class Y{constructor(){this.pool=[],this.active=[]}spawn(t,s,e){const h=this.pool.pop()||{x:t,y:s,vx:0,vy:0,life:.5,maxLife:.5,size:3,color:"#fff"};h.x=t,h.y=s,h.vx=(e==null?void 0:e.vx)??Math.random()*80-40,h.vy=(e==null?void 0:e.vy)??Math.random()*-80,h.life=(e==null?void 0:e.life)??.5,h.maxLife=h.life,h.size=(e==null?void 0:e.size)??3,h.color=(e==null?void 0:e.color)??"#ffffff88",h.g=(e==null?void 0:e.g)??200,this.active.push(h)}burst(t,s,e,h){for(let o=0;o<e;o++)this.spawn(t,s,{color:h,size:2+Math.random()*2,life:.4+Math.random()*.3})}update(t){for(let s=this.active.length-1;s>=0;s--){const e=this.active[s];e.vy+=(e.g||0)*t,e.x+=e.vx*t,e.y+=e.vy*t,e.life-=t,e.life<=0&&(this.pool.push(e),this.active.splice(s,1))}}render(t){for(const s of this.active){const e=Math.max(0,s.life/s.maxLife);t.fillStyle=s.color.replace(/\d?\.?\d*\)$/,"")||s.color,t.globalAlpha=e,t.beginPath(),t.arc(s.x,s.y,s.size,0,Math.PI*2),t.fill(),t.globalAlpha=1}}}function G(u){return u===2?"shoot":"flap"}class D{constructor(t,s,e,h,o="player"){this.width=10,this.height=4,this.active=!0,this.x=t,this.y=s,this.vx=e,this.vy=h,this.owner=o}update(t){this.x+=this.vx*t,this.y+=this.vy*t}isOffScreen(t,s){return this.x>t+20||this.x+this.width<-20||this.y>s+20||this.y+this.height<-20}}class _{constructor(t,s,e=-120,h=0){this.width=24,this.height=18,this.health=1,this.x=t,this.y=s,this.vx=e,this.vy=h}update(t){this.x+=this.vx*t,this.y+=this.vy*t}isOffScreen(){return this.x+this.width<-40}}class J{constructor(t,s,e){this.width=16,this.height=16,this.vx=-80,this.vy=0,this.x=t,this.y=s,this.type=e}update(t){this.x+=this.vx*t,this.y+=this.vy*t}isOffScreen(){return this.x+this.width<-40}}const X="scores:v1";function z(){try{const u=localStorage.getItem(X);if(!u)return[];const t=JSON.parse(u);return Array.isArray(t)?t.map(s=>({score:Number(s.score)||0,date:Number(s.date)||Date.now()})).filter(s=>s.score>=0&&Number.isFinite(s.date)):[]}catch{return[]}}function F(u){try{localStorage.setItem(X,JSON.stringify(u))}catch{}}const A={addScore(u,t=Date.now()){const s=z();s.push({score:Math.max(0,Math.floor(u)),date:t}),s.sort((h,o)=>o.score-h.score||o.date-h.date);const e=s.slice(0,10);F(e)},getTop(u=5){const t=z();return t.sort((s,e)=>e.score-s.score||e.date-s.date),t.slice(0,u)},clear(){F([])}};class Q{constructor(){this._reducedMotion=!1;try{const t=localStorage.getItem("reducedMotion");t!=null?this._reducedMotion=t==="1":typeof window<"u"&&"matchMedia"in window&&(this._reducedMotion=window.matchMedia("(prefers-reduced-motion: reduce)").matches)}catch{}}get reducedMotion(){return this._reducedMotion}set reducedMotion(t){this._reducedMotion=t;try{localStorage.setItem("reducedMotion",t?"1":"0")}catch{}}toggleReducedMotion(){this.reducedMotion=!this.reducedMotion}}const S=new Q,C=class C{constructor(){this.player=new E(80,150,26,26),this.obstacles=[],this.hud=new H,this.timeToNext=0,this.score=0,this.best=0,this.gameOver=!1,this.paused=!1,this.speed=140,this.particles=new Y,this.shakeT=0,this.hintT=4,this.bullets=[],this.enemies=[],this.powerUps=[],this.enemyTimer=0,this.powerTimer=5,this.floats=[],this.mobileMoveX=0,this.isTouch="ontouchstart"in window,this.btnLeftDown=!1,this.btnRightDown=!1,this.btnShootDown=!1,this.btnRects=null,this.restartRect=null}init(t){this.renderer=new W(t.canvas,t.ctx),this.obstacles=[],this.score=0,this.timeToNext=0,this.gameOver=!1,this.paused=!1,this.speed=140,this.player.hp=this.player.maxHp=3,this.bullets=[],this.enemies=[],this.powerUps=[],this.enemyTimer=0,this.powerTimer=5,this.hintT=4;const s=()=>{const n=t.canvas.width,l=t.canvas.height,i=Math.max(60,Math.min(120,Math.floor(Math.min(n,l)*.14))),a=24;this.btnRects={left:{x:a,y:l-i-a,w:i,h:i},right:{x:a+i+16,y:l-i-a,w:i,h:i},shoot:{x:n-i-a,y:l-i-a,w:i,h:i}}},e=()=>{const n=t.canvas.width,l=t.canvas.height,i=Math.max(64,Math.min(120,Math.floor(Math.min(n,l)*.16)));this.restartRect={x:(n-i)/2,y:l*.55,w:i,h:i}},h=(n,l,i)=>{if(!this.btnRects)return!1;const a=this.btnRects[n];return l>=a.x&&l<=a.x+a.w&&i>=a.y&&i<=a.y+a.h},o=n=>{s(),this.btnLeftDown=this.btnRightDown=this.btnShootDown=!1;const l=t.canvas.getBoundingClientRect(),i=t.canvas.width/l.width,a=t.canvas.height/l.height;for(let f=0;f<n.touches.length;f++){const p=n.touches.item(f),d=(p.clientX-l.left)*i,y=(p.clientY-l.top)*a;h("left",d,y)?this.btnLeftDown=!0:h("right",d,y)?this.btnRightDown=!0:h("shoot",d,y)&&(this.btnShootDown=!0)}},r=n=>{var a;if(this.gameOver){if(n.touches!==void 0){e();const f=n,p=t.canvas.getBoundingClientRect(),d=t.canvas.width/p.width,y=t.canvas.height/p.height;for(let m=0;m<f.touches.length;m++){const v=f.touches.item(m),x=(v.clientX-p.left)*d,T=(v.clientY-p.top)*y,b=this.restartRect;if(x>=b.x&&x<=b.x+b.w&&T>=b.y&&T<=b.y+b.h){this.init(t);return}}}else{e();const f=this.restartRect,p=n,d=t.canvas.getBoundingClientRect(),y=t.canvas.width/d.width,m=t.canvas.height/d.height,v=(p.clientX-d.left)*y,x=(p.clientY-d.top)*m;if(v>=f.x&&v<=f.x+f.w&&x>=f.y&&x<=f.y+f.h){this.init(t);return}}return}if(n.touches!==void 0){const f=n;if(o(f),this.btnLeftDown||this.btnRightDown||this.btnShootDown){if(this.btnShootDown&&this.player.fireCooldown===0){const b=this.player.x+this.player.width,M=this.player.y+this.player.height*.5-2;this.bullets.push(new D(b,M,360,0,"player")),this.player.fireCooldown=.18,w.beep(980,.05,"square",.05)}return}const p=t.canvas.width,d=t.canvas.height,y=t.canvas.getBoundingClientRect(),m=p/y.width,v=d/y.height;let x=!1;for(let b=0;b<f.touches.length;b++){const M=f.touches.item(b),K=(M.clientX-y.left)*m,P=(M.clientY-y.top)*v;if(K>p*.7&&P>d*.6){x=!0;break}}if(x&&this.player.fireCooldown===0){const b=this.player.x+this.player.width,M=this.player.y+this.player.height*.5-2;this.bullets.push(new D(b,M,360,0,"player")),this.player.fireCooldown=.18,w.beep(980,.05,"square",.05);return}if((((a=f.touches)==null?void 0:a.length)??0)>=2&&this.player.fireCooldown===0){const b=this.player.x+this.player.width,M=this.player.y+this.player.height*.5-2;this.bullets.push(new D(b,M,360,0,"player")),this.player.fireCooldown=.18,w.beep(980,.05,"square",.05)}else g.jump(this.player),w.flap(),this.particles.burst(this.player.x+this.player.width*.2,this.player.y+this.player.height,S.reducedMotion?4:8,"#88ccff88");return}const l=n.button??0,i=G(l);if(i==="flap")g.jump(this.player),w.flap();else if(i==="shoot"&&this.player.fireCooldown===0){const f=this.player.x+this.player.width,p=this.player.y+this.player.height*.5-2;this.bullets.push(new D(f,p,360,0,"player")),this.player.fireCooldown=.18,w.beep(980,.05,"square",.05)}};t.canvas.oncontextmenu=n=>{n.preventDefault()},t.canvas.onpointerdown=r;const c=n=>{const l=t.canvas.getBoundingClientRect();let i=0,a=0;for(let f=0;f<n.touches.length;f++){const d=n.touches.item(f).clientX-l.left;d<l.width*.45?i=1:d>l.width*.55&&(a=1)}this.mobileMoveX=a-i};t.canvas.ontouchstart=n=>{c(n),r(n)},t.canvas.ontouchmove=n=>{c(n),o(n)},t.canvas.ontouchend=n=>{c(n),o(n)};try{const n=localStorage.getItem("best");n&&(this.best=parseInt(n,10)||0)}catch{}document.addEventListener("visibilitychange",()=>{document.hidden&&(this.paused=!0)})}update(t,s){var n,l;const e=s.canvas.height;if(s.input.wasPressed("KeyP")&&(this.paused=!this.paused),s.input.wasPressed("KeyR")&&this.init(s),this.paused)return;if((s.input.wasPressed("Space")||s.input.wasPressed("ArrowUp")||s.input.wasPressed("KeyW"))&&(g.jump(this.player),w.flap(),this.particles.burst(this.player.x+this.player.width*.2,this.player.y+this.player.height,S.reducedMotion?4:8,"#88ccff88")),(s.input.isDown("KeyJ")||s.input.isDown("ControlLeft")||s.input.isDown("ControlRight")||this.btnShootDown)&&this.player.fireCooldown===0){const i=this.player.x+this.player.width,a=this.player.y+this.player.height*.5-2;this.bullets.push(new D(i,a,360,0,"player")),this.player.fireCooldown=.18,w.beep(980,.05,"square",.05)}const h=s.input.getMovementDirection(),o=((l=(n=s.input).getWASDHorizontal)==null?void 0:l.call(n))??(s.input.isDown("KeyD")?1:0)+(s.input.isDown("KeyA")?-1:0),r=(this.btnRightDown?1:0)-(this.btnLeftDown?1:0);if(this.player.vx=(h.x+o+this.mobileMoveX+r)*80,g.applyGravity(this.player,t),this.player.update(t),this.player.y=Math.max(0,Math.min(e-this.player.height,this.player.y)),this.timeToNext-=t,this.timeToNext<=0){this.speed=Math.min(260,this.speed+2);const i=Math.max(120,180-this.score*2);this.timeToNext=Math.max(1,1.6-this.score*.02);const a=i,f=40,p=e-a-40,d=Math.floor(Math.random()*(p-f+1))+f,y=80,m=s.canvas.width+y;this.obstacles.push(new L(m,0,y,d,this.speed)),this.obstacles.push(new L(m,d+a,y,e-(d+a),this.speed))}for(const i of this.obstacles)i.update(t);this.obstacles=this.obstacles.filter(i=>!i.isOffScreen());for(const i of this.obstacles)if(g.checkCollision(this.player,i)&&(this.player.hp-=1,w.hit(),this.particles.burst(this.player.x+this.player.width/2,this.player.y+this.player.height/2,S.reducedMotion?6:12,"#ff7b72aa"),this.shakeT=S.reducedMotion?0:.2,this.player.x-=10,this.player.hp<=0)){this.gameOver=!0,this.best=Math.max(this.best,this.score);try{localStorage.setItem("best",String(this.best))}catch{}A.addScore(this.score)}for(let i=0;i<this.obstacles.length;i+=2){const a=this.obstacles[i],f=a.x+a.width/2;!this.gameOver&&f<this.player.x&&a.counted!==!0&&(a.counted=!0,this.score+=1,this.player.passObstacle(),w.score())}if(this.enemyTimer-=t,this.enemyTimer<=0){let i=40,a=e-40;if(this.obstacles.length>=2){let T=0,b=-1/0;for(let P=0;P<this.obstacles.length-1;P+=2){const B=this.obstacles[P];B.x>b&&(b=B.x,T=P)}const M=this.obstacles[T],K=this.obstacles[T+1];i=M.height,a=K.y}const f=12,p=Math.max(0,i+f),d=Math.min(e-20,a-f-18),y=s.canvas.width+40,m=p<d?p+(d-p)*.5:40+Math.random()*(e-120),v=-(120+Math.random()*60+this.score),x=new _(y,m,v,0);x.minY=isFinite(p)?p:20,x.maxY=isFinite(d)?d:e-40,x.phase=Math.random()*Math.PI*2,this.enemies.push(x),this.enemyTimer=1.8-Math.min(1.2,this.score*.01)}if(this.powerTimer-=t,this.powerTimer<=0){const i=["heal","rapid","shield"],a=i[Math.random()*i.length|0];this.powerUps.push(new J(s.canvas.width+20,80+Math.random()*(e-160),a)),this.powerTimer=8+Math.random()*6}for(const i of this.bullets)i.update(t);for(const i of this.enemies){const a=(i.phase??0)+performance.now()/1e3,f=35;i.vy=Math.sin(a)*f,i.update(t);const p=i.minY??20,d=i.maxY??e-40;i.y<p&&(i.y=p),i.y+i.height>d&&(i.y=d-i.height)}for(const i of this.powerUps)i.update(t);this.bullets=this.bullets.filter(i=>!i.isOffScreen(s.canvas.width,e)&&i.active),this.enemies=this.enemies.filter(i=>!i.isOffScreen()),this.powerUps=this.powerUps.filter(i=>!i.isOffScreen());const c=(i,a,f,p,d,y,m,v)=>i<d+m&&i+f>d&&a<y+v&&a+p>y;for(const i of this.bullets)for(const a of this.enemies)if(i.active&&c(i.x,i.y,i.width,i.height,a.x,a.y,a.width,a.height)&&(i.active=!1,a.health-=1,this.particles.burst(a.x+a.width/2,a.y+a.height/2,S.reducedMotion?6:10,"#ffd166aa"),a.health<=0)){const f=a.x+a.width/2,p=a.y+a.height/2;this.particles.burst(f,p,S.reducedMotion?10:22,"#ffb347aa"),this.particles.burst(f,p,S.reducedMotion?8:14,"#ff7b72aa"),a.x=-9999,this.score+=C.KILL_POINTS,this.floats.push({x:f,y:p,text:`+${C.KILL_POINTS}`,ttl:.9,vy:-32}),this.shakeT=S.reducedMotion?0:Math.max(this.shakeT,.12),w.score()}this.enemies=this.enemies.filter(i=>i.x>-9e3);for(const i of this.enemies)if(c(this.player.x,this.player.y,this.player.width,this.player.height,i.x,i.y,i.width,i.height)&&(this.player.hp-=1,w.hit(),this.particles.burst(i.x+i.width/2,i.y+i.height/2,10,"#ff7b72aa"),i.x=-9999,this.player.hp<=0)){this.gameOver=!0,this.best=Math.max(this.best,this.score);try{localStorage.setItem("best",String(this.best))}catch{}A.addScore(this.score)}for(const i of this.powerUps)c(this.player.x,this.player.y,this.player.width,this.player.height,i.x,i.y,i.width,i.height)&&(i.type==="heal"&&(this.player.hp=Math.min(this.player.maxHp,this.player.hp+1)),i.type==="rapid"&&(this.player.fireCooldown=Math.min(this.player.fireCooldown,.08)),i.type==="shield"&&(this.player.maxHp=Math.min(5,this.player.maxHp+1)),this.player.hp=Math.min(this.player.maxHp,this.player.hp+1),this.particles.burst(i.x+i.width/2,i.y+i.height/2,14,"#7ee787aa"),i.x=-9999);this.particles.update(t),this.shakeT=Math.max(0,this.shakeT-t);for(const i of this.floats)i.ttl-=t,i.y+=i.vy*t;this.floats=this.floats.filter(i=>i.ttl>0),this.hintT=Math.max(0,this.hintT-t)}render(t,s){const e=this.shakeT>0?(Math.random()-.5)*8:0;t.save(),t.translate(e,e),this.renderer.clear(1/60);for(const h of this.obstacles)this.renderer.drawObstacle(h);for(const h of this.enemies)this.renderer.drawEnemy(h);for(const h of this.powerUps)this.renderer.drawPowerUp(h);this.renderer.drawPlayer(this.player,"#58a6ff");for(const h of this.bullets)this.renderer.drawProjectile(h);if(this.particles.render(t),this.hud.render(t,this.score,void 0,this.player.hp),this.floats.length)for(const h of this.floats){const o=Math.max(0,Math.min(1,h.ttl/.9));t.save(),t.globalAlpha=o,t.fillStyle="#ffd166",t.font="700 18px system-ui",t.fillText(h.text,h.x,h.y),t.restore()}if(this.isTouch){const h=s.canvas.width,o=s.canvas.height,r=Math.max(60,Math.min(120,Math.floor(Math.min(h,o)*.14))),c=24;this.btnRects={left:{x:c,y:o-r-c,w:r,h:r},right:{x:c+r+16,y:o-r-c,w:r,h:r},shoot:{x:h-r-c,y:o-r-c,w:r,h:r}};const n=(l,i,a)=>{t.save(),t.globalAlpha=.5,t.fillStyle=i?"#58a6ff":"#0f172a",t.strokeStyle="#58a6ff88",t.lineWidth=4,t.beginPath(),t.roundRect(l.x,l.y,l.w,l.h,16),t.fill(),t.stroke(),t.fillStyle="#e8e8f0",t.font="700 28px system-ui";const f=a==="L"?"◀":a==="R"?"▶":"●",p=t.measureText(f).width;t.fillText(f,l.x+(l.w-p)/2,l.y+l.h/2+10),t.restore()};n(this.btnRects.left,this.btnLeftDown,"L"),n(this.btnRects.right,this.btnRightDown,"R"),n(this.btnRects.shoot,this.btnShootDown,"S")}if(this.hintT>0){const h=Math.min(.8,this.hintT/4);t.save(),t.globalAlpha=h,t.fillStyle="#00000088",t.fillRect(20,70,520,56),t.fillStyle="#e8e8f0",t.font="600 16px system-ui",t.fillText("Flap: Space/ArrowUp/W or Click • Move: Arrows or A/D • Shoot: Right Click or Ctrl/J (hold)",28,100),t.restore()}if(t.restore(),this.paused&&(t.fillStyle="#00000088",t.fillRect(0,0,s.canvas.width,s.canvas.height),t.fillStyle="#e8e8f0",t.font="700 28px system-ui",t.fillText("Paused (P). R = Restart, Esc = Title",40,120)),this.gameOver){t.fillStyle="#00000088",t.fillRect(0,0,s.canvas.width,s.canvas.height),t.fillStyle="#e8e8f0",t.font="700 28px system-ui",t.fillText(`Game Over — Score ${this.score}  Best ${this.best}`,40,120),t.font="500 18px system-ui",t.fillText("Press R or tap the restart button",40,160);const h=s.canvas.width,o=s.canvas.height,r=Math.max(64,Math.min(120,Math.floor(Math.min(h,o)*.16))),c=(h-r)/2,n=o*.55;this.restartRect={x:c,y:n,w:r,h:r},t.save(),t.globalAlpha=.9,t.fillStyle="#0f172a",t.strokeStyle="#58a6ff88",t.lineWidth=5,t.beginPath(),t.roundRect(c,n,r,r,18),t.fill(),t.stroke(),t.fillStyle="#e8e8f0",t.font="700 28px system-ui",t.fillText("⟲",c+r/2-10,n+r/2+12),t.restore()}}};C.KILL_POINTS=2;let O=C;class N{constructor(){this.p1=new E(80,140,26,26),this.p2=new E(120,220,26,26),this.obstacles=[],this.hud=new H,this.timeToNext=0,this.s1=0,this.s2=0,this.paused=!1,this.speed=140,this.particles=new Y,this.shakeT=0}init(t){this.renderer=new W(t.canvas,t.ctx),this.obstacles=[],this.timeToNext=0,this.s1=0,this.s2=0,this.paused=!1,this.speed=140;const s=()=>{g.jump(this.p1),w.flap()};t.canvas.ontouchstart=s,t.canvas.onpointerdown=s}update(t,s){const e=s.canvas.height;if(s.input.wasPressed("KeyP")&&(this.paused=!this.paused),s.input.wasPressed("KeyR")&&this.init(s),this.paused)return;(s.input.wasPressed("Space")||s.input.wasPressed("ArrowUp"))&&(g.jump(this.p1),w.flap(),this.particles.burst(this.p1.x,this.p1.y+this.p1.height,6,"#88ccff88")),s.input.wasPressed("KeyW")&&(g.jump(this.p2),w.flap(),this.particles.burst(this.p2.x,this.p2.y+this.p2.height,6,"#ffb08888"));const h=s.input.getMovementDirection();if(this.p1.vx=h.x*80,this.p2.vx=0,this.p2.vy+=(s.input.isDown("KeyS")?1:0)*300*t,g.applyGravity(this.p1,t),g.applyGravity(this.p2,t),this.p1.update(t),this.p2.update(t),this.p1.y=Math.max(0,Math.min(e-this.p1.height,this.p1.y)),this.p2.y=Math.max(0,Math.min(e-this.p2.height,this.p2.y)),this.timeToNext-=t,this.timeToNext<=0){this.speed=Math.min(260,this.speed+2);const o=Math.max(130,180-Math.max(this.s1,this.s2)*2);this.timeToNext=Math.max(1,1.7-Math.max(this.s1,this.s2)*.02);const r=40,c=e-o-40,n=Math.floor(Math.random()*(c-r+1))+r,l=80,i=s.canvas.width+l;this.obstacles.push(new L(i,0,l,n,this.speed)),this.obstacles.push(new L(i,n+o,l,e-(n+o),this.speed))}for(const o of this.obstacles)o.update(t);this.obstacles=this.obstacles.filter(o=>!o.isOffScreen());for(const o of this.obstacles)if(g.checkCollision(this.p1,o)||g.checkCollision(this.p2,o)){w.hit(),this.particles.burst((this.p1.x+this.p2.x)/2,(this.p1.y+this.p2.y)/2,16,"#ff7b72aa"),this.shakeT=.25,this.init(s);return}for(let o=0;o<this.obstacles.length;o+=2){const r=this.obstacles[o],c=r.x+r.width/2;c<this.p1.x&&r.p1c!==!0&&(r.p1c=!0,this.s1+=1,this.p1.passObstacle(),w.score()),c<this.p2.x&&r.p2c!==!0&&(r.p2c=!0,this.s2+=1,this.p2.passObstacle(),w.score())}}render(t,s){const e=this.shakeT>0?(Math.random()-.5)*8:0;t.save(),t.translate(e,e),this.renderer.clear(1/60);for(const h of this.obstacles)this.renderer.drawObstacle(h);this.renderer.drawPlayer(this.p1,"#58a6ff"),this.renderer.drawPlayer(this.p2,"#ff7b72"),this.particles.render(t),this.hud.render(t,this.s1,this.s2),t.restore(),this.paused&&(t.fillStyle="#00000088",t.fillRect(0,0,s.canvas.width,s.canvas.height),t.fillStyle="#e8e8f0",t.font="700 28px system-ui",t.fillText("Paused (P). R = Restart, Esc = Title",40,120))}}class Z{constructor(){this.t=0}onResize(t){t.ctx.setTransform(1,0,0,1,0,0)}init(t){t.canvas.focus();let s=!1;const e=()=>{t.canvas.onpointerdown=null,t.canvas.ontouchstart=null,t.canvas.onclick=null,document.removeEventListener("touchstart",l),document.removeEventListener("pointerdown",n),document.removeEventListener("click",i)},h=a=>{s||(s=!0,e(),t.setScene(a?new N:new O))},o=a=>h(!1),r=a=>{var p;const f=((p=a.touches)==null?void 0:p.length)??0;h(f>=2)},c=a=>h(!1),n=a=>h(!1),l=a=>{var p;const f=((p=a.touches)==null?void 0:p.length)??0;h(f>=2)},i=a=>h(!1);t.canvas.onpointerdown=o,t.canvas.ontouchstart=r,t.canvas.onclick=c,document.addEventListener("pointerdown",n,{passive:!0}),document.addEventListener("touchstart",l,{passive:!0}),document.addEventListener("click",i,{passive:!0})}update(t,s){this.t+=t,s.input.wasPressed("KeyS")&&s.setScene(new O),s.input.wasPressed("KeyV")&&s.setScene(new N),s.input.wasPressed("KeyM")&&(w.muted=!w.muted),s.input.wasPressed("KeyR")&&S.toggleReducedMotion(),s.input.wasPressed("KeyC")&&A.clear();const{ctx:e}=s,h=s.canvas.width,o=s.canvas.height,r=e.createLinearGradient(0,0,0,o);r.addColorStop(0,"#0b1023"),r.addColorStop(1,"#1a2247"),e.fillStyle=r,e.fillRect(0,0,h,o),e.save(),e.globalAlpha=.2;for(let p=0;p<60;p++){const d=p*91%h,y=p*53%o;e.fillStyle=p%2?"#d0e0ff":"#a0b8ff",e.fillRect(d,y+(Math.sin(this.t+p)*2+2)|0,2,2)}e.restore();const c=Math.sin(this.t*2)*6;e.fillStyle="#e8e8f0",e.font="800 64px system-ui, ui-sans-serif, -apple-system, Segoe UI",e.textBaseline="top",e.fillText("Crappy Bird Extreme",40,80+c),e.strokeStyle="#58a6ff",e.lineWidth=6,e.beginPath(),e.moveTo(40,80+c+64+8),e.lineTo(520,80+c+64+8),e.stroke(),e.font="700 20px system-ui",e.fillStyle="#94a3b8",e.fillText("yoloswag edition",44,80+c+64+18+10),e.fillStyle="#0f172a88";const n=180;e.fillRect(32,n,Math.min(520,h-64),150),e.fillStyle="#cdd9e5",e.font="700 22px system-ui",e.fillText("Play",48,n+16),e.font="500 18px system-ui",e.fillText("S — Singleplayer",48,n+52),e.fillText("V — Versus (Local)",48,n+80);const l=n+170;e.fillStyle="#0f172a88",e.fillRect(32,l,Math.min(620,h-64),160),e.fillStyle="#cdd9e5",e.font="700 20px system-ui",e.fillText("Controls",48,l+16),e.font="500 16px system-ui";let i=l+46;e.fillText("Singleplayer: Flap = Space/ArrowUp/W or Click/Tap • Move = ArrowLeft/Right or A/D • Shoot = Right Click or Ctrl/J (hold)",48,i),i+=28,e.fillText("Versus: P1 = Arrows + Space • P2 = W (flap), S (nudge down)",48,i),i+=28,e.fillText(`Mute = M (${w.muted?"Muted":"Sound on"}) • Reduced motion = R (${S.reducedMotion?"On":"Off"}) • Esc returns here`,48,i);const a=A.getTop(5);if(a.length){const d=28+a.length*22+16,y=Math.max(h-280-24,24),m=24;e.fillStyle="#0f172acc",e.fillRect(y,m,280,d),e.fillStyle="#cdd9e5",e.font="700 16px system-ui",e.fillText("Top Scores",y+12,m+20),e.font="500 14px system-ui";for(let v=0;v<a.length;v++){const x=a[v];e.fillText(`${v+1}. ${x.score}`,y+12,m+44+v*22)}e.font="400 12px system-ui",e.fillStyle="#94a3b8",e.fillText("Press C to clear",y+12,m+d-10)}const f=.5+.5*Math.sin(this.t*3);e.save(),e.globalAlpha=.6+.4*f,e.fillStyle="#58a6ff",e.font="700 18px system-ui",e.fillText("Tap to start Singleplayer • Two-finger tap for Versus (or press S/V)",40,o-60),e.restore()}render(){}}const U=document.getElementById("gameCanvas");U.style.width="100vw";U.style.height="100vh";const I=new $(U);let k="title";const j=()=>{k="title",I.setScene(new Z)},tt=()=>{k="single",I.setScene(new O)},et=()=>{k="versus",I.setScene(new N)};j();window.addEventListener("keydown",u=>{k==="title"?(u.code==="KeyS"&&tt(),u.code==="KeyV"&&et()):u.code==="Escape"&&j()});window.addEventListener("resize",()=>I.resizeToDisplay());
